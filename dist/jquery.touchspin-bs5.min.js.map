{"version":3,"file":"jquery.touchspin-bs5.min.js","sources":["../packages/core/src/index.js","../packages/renderers/bootstrap5/src/Bootstrap5Renderer.js","../packages/core/src/AbstractRenderer.js","../packages/renderers/bootstrap5/src/jquery-entry.js"],"sourcesContent":["// @ts-check\n\n/**\n * @fileoverview Framework-agnostic core scaffold for TouchSpin.\n * Phase A (A1): minimal public API surface to enable incremental extraction.\n * This is a placeholder; logic will be ported from TouchSpinCore.migrated.js in A2â€“A7.\n */\n\n/**\n * @typedef {'none'|'floor'|'round'|'ceil'} ForceStepDivisibility\n */\n\n/**\n * @callback TouchSpinCalcCallback\n * @param {string} value\n * @returns {string}\n */\n\n/**\n * @typedef {Object} TouchSpinCoreOptions\n * @property {number|null=} min\n * @property {number|null=} max\n * @property {number|null=} firstclickvalueifempty\n * @property {number=} step\n * @property {number=} decimals\n * @property {ForceStepDivisibility=} forcestepdivisibility\n * @property {number=} stepinterval\n * @property {number=} stepintervaldelay\n * @property {boolean=} booster\n * @property {number=} boostat\n * @property {number|false=} maxboostedstep\n * @property {TouchSpinCalcCallback=} callback_before_calculation\n * @property {TouchSpinCalcCallback=} callback_after_calculation\n * @property {Function} renderer - Renderer class (e.g., Bootstrap5Renderer) or null for no UI\n * @property {string=} initval - Initial value for the input\n * @property {string=} replacementval - Value to use when input is empty\n * @property {boolean=} mousewheel - Enable/disable mousewheel support\n * @property {boolean=} verticalbuttons - Enable vertical button layout\n * @property {string=} verticalup - Text for vertical up button\n * @property {string=} verticaldown - Text for vertical down button\n * @property {string=} verticalupclass - CSS classes for vertical up button (handled by renderer)\n * @property {string=} verticaldownclass - CSS classes for vertical down button (handled by renderer)\n * @property {string=} prefix - Text/HTML before input (handled by renderer)\n * @property {string=} postfix - Text/HTML after input (handled by renderer)\n * @property {string=} prefix_extraclass - Extra CSS classes for prefix element (handled by renderer)\n * @property {string=} postfix_extraclass - Extra CSS classes for postfix element (handled by renderer)\n * @property {string=} buttonup_class - CSS classes for up button (handled by renderer)\n * @property {string=} buttondown_class - CSS classes for down button (handled by renderer)\n * @property {string=} buttonup_txt - Content for up button (handled by renderer)\n * @property {string=} buttondown_txt - Content for down button (handled by renderer)\n */\n\nconst DEFAULTS = {\n  min: 0,\n  max: 100,\n  initval: '',\n  replacementval: '',\n  firstclickvalueifempty: null,\n  step: 1,\n  decimals: 0,\n  forcestepdivisibility: 'round',\n  stepinterval: 100,\n  stepintervaldelay: 500,\n  verticalbuttons: false,\n  verticalup: '+',\n  verticaldown: '-',\n  verticalupclass: null,\n  verticaldownclass: null,\n  focusablebuttons: false,\n  prefix: '',\n  postfix: '',\n  prefix_extraclass: '',\n  postfix_extraclass: '',\n  booster: true,\n  boostat: 10,\n  maxboostedstep: false,\n  mousewheel: true,\n  buttonup_class: null,\n  buttondown_class: null,\n  buttonup_txt: '+',\n  buttondown_txt: '-',\n  callback_before_calculation: (v) => v,\n  callback_after_calculation: (v) => v,\n};\n\nconst INSTANCE_KEY = '_touchSpinCore';\n\nexport class TouchSpinCore {\n  /**\n   * Sanitize a partial settings object BEFORE applying it.\n   * Returns a new object with only provided keys normalized.\n   * @param {Partial<TouchSpinCoreOptions>} partial\n   * @param {TouchSpinCoreOptions} current\n   * @returns {Partial<TouchSpinCoreOptions>}\n   */\n  static sanitizePartialSettings(partial, current) {\n    const out = { ...partial };\n\n    if (Object.prototype.hasOwnProperty.call(partial, 'step')) {\n      const n = Number(partial.step);\n      out.step = (isFinite(n) && n > 0) ? n : 1;\n    }\n\n    if (Object.prototype.hasOwnProperty.call(partial, 'decimals')) {\n      const n = Number(partial.decimals);\n      out.decimals = (isFinite(n) && n >= 0) ? Math.floor(n) : 0;\n    }\n\n    const hasMin = Object.prototype.hasOwnProperty.call(partial, 'min');\n    const hasMax = Object.prototype.hasOwnProperty.call(partial, 'max');\n    if (hasMin) {\n      if (partial.min === null || partial.min === undefined || partial.min === '') {\n        out.min = null;\n      } else {\n        const n = Number(partial.min);\n        out.min = isFinite(n) ? n : null;\n      }\n    }\n    if (hasMax) {\n      if (partial.max === null || partial.max === undefined || partial.max === '') {\n        out.max = null;\n      } else {\n        const n = Number(partial.max);\n        out.max = isFinite(n) ? n : null;\n      }\n    }\n    if (hasMin && hasMax && out.min !== null && out.max !== null && out.min > out.max) {\n      const tmp = out.min; out.min = out.max; out.max = tmp;\n    }\n\n    if (Object.prototype.hasOwnProperty.call(partial, 'stepinterval')) {\n      const n = Number(partial.stepinterval);\n      out.stepinterval = (isFinite(n) && n >= 0) ? n : DEFAULTS.stepinterval;\n    }\n    if (Object.prototype.hasOwnProperty.call(partial, 'stepintervaldelay')) {\n      const n = Number(partial.stepintervaldelay);\n      out.stepintervaldelay = (isFinite(n) && n >= 0) ? n : DEFAULTS.stepintervaldelay;\n    }\n\n    return out;\n  }\n  /**\n   * @param {HTMLInputElement} inputEl\n   * @param {Partial<TouchSpinCoreOptions>=} opts\n   */\n  constructor(inputEl, opts = {}) {\n    if (!inputEl || inputEl.nodeName !== 'INPUT') {\n      throw new Error('TouchSpinCore requires an <input> element');\n    }\n\n    /** @type {HTMLInputElement} */\n    this.input = inputEl;\n\n    // Parse data-bts-* attributes\n    const dataAttrs = this._parseDataAttributes(inputEl);\n\n    /** @type {TouchSpinCoreOptions} */\n    this.settings = Object.assign({}, DEFAULTS, dataAttrs, opts);\n    // Sanitize settings to ensure safe, predictable behavior\n    this._sanitizeSettings();\n\n    // Check for renderer: explicit option > global default > none\n    if (!this.settings.renderer) {\n      // Check for global default renderer\n      if (typeof globalThis !== 'undefined' && globalThis.TouchSpinDefaultRenderer) {\n        this.settings.renderer = globalThis.TouchSpinDefaultRenderer;\n      } else {\n        // Allow no renderer for keyboard/wheel-only functionality\n        console.warn('TouchSpin: No renderer specified (renderer: null). Only keyboard/wheel events will work. Consider using Bootstrap3/4/5Renderer or TailwindRenderer for UI.');\n      }\n    }\n\n    /** @type {boolean} */\n    this.spinning = false;\n    /** @type {number} */\n    this.spincount = 0;\n    /** @type {false|'up'|'down'} */\n    this.direction = false;\n    /** @type {Map<string, Set<Function>>} */\n    this._events = new Map();\n    /** @type {Array<Function>} */\n    this._teardownCallbacks = [];\n    /** @type {Map<string, Set<Function>>} */\n    this._settingObservers = new Map(); // For observer pattern\n\n    /** @type {ReturnType<typeof setTimeout>|null} */\n    this._spinDelayTimeout = null;\n    /** @type {ReturnType<typeof setInterval>|null} */\n    this._spinIntervalTimer = null;\n\n    /** @type {HTMLElement|null} */\n    this._upButton = null;\n    /** @type {HTMLElement|null} */\n    this._downButton = null;\n    /** @type {HTMLElement|null} */\n    this._wrapper = null;\n\n    // DOM event handlers (bound methods)\n    this._handleUpMouseDown = this._handleUpMouseDown.bind(this);\n    this._handleDownMouseDown = this._handleDownMouseDown.bind(this);\n    this._handleMouseUp = this._handleMouseUp.bind(this);\n    this._handleUpKeyDown = this._handleUpKeyDown.bind(this);\n    this._handleUpKeyUp = this._handleUpKeyUp.bind(this);\n    this._handleDownKeyDown = this._handleDownKeyDown.bind(this);\n    this._handleDownKeyUp = this._handleDownKeyUp.bind(this);\n    this._handleInputChange = this._handleInputChange.bind(this);\n    this._handleInputBlur = this._handleInputBlur.bind(this);\n    this._handleKeyDown = this._handleKeyDown.bind(this);\n    this._handleKeyUp = this._handleKeyUp.bind(this);\n    this._handleWheel = this._handleWheel.bind(this);\n\n    // Core always manages the input element\n    this._initializeInput();\n\n    // Initialize renderer with reference to core\n    if (this.settings.renderer) {\n      this.renderer = new this.settings.renderer(inputEl, this.settings, this);\n      this.renderer.init();\n    }\n\n    // Set up mutation observer to watch for disabled/readonly changes\n    this._setupMutationObserver();\n\n    // Finalize wrapper attributes after complete initialization\n    //\n    // The data-touchspin-injected attribute serves as a marker that the TouchSpin\n    // component is fully constructed - DOM is built, event handlers are attached,\n    // and mutation observer is active. Tests use this attribute to detect when\n    // components are ready for interaction.\n    //\n    // By setting these attributes as the final initialization step, we prevent race\n    // conditions where tests might try to interact with components before their DOM\n    // structure, event handlers, or internal monitoring are ready. This is especially\n    // important under high CPU load where DOM operations may take longer.\n    //\n    // Complete initialization sequence:\n    // 1. renderer.init() - Constructs DOM and attaches event handlers\n    // 2. _setupMutationObserver() - Starts monitoring input attribute changes\n    // 3. renderer.finalizeWrapperAttributes() - Marks component as ready:\n    //    - Adds data-testid for test element selection\n    //    - Adds data-touchspin-injected to signal component is fully ready\n    if (this.settings.renderer) {\n      this.renderer.finalizeWrapperAttributes();\n    }\n  }\n\n  /**\n   * Initialize input element (core always handles this)\n   * @private\n   */\n  _initializeInput() {\n    // Set initial value if specified and input is empty\n    if (this.settings.initval !== '' && this.input.value === '') {\n      this.input.value = this.settings.initval;\n    }\n\n    // Core always handles these for the input\n    this._updateAriaAttributes();\n    this._syncNativeAttributes();\n    this._checkValue(false);\n  }\n\n  /**\n   * Normalize and validate settings: coerce invalid values to safe defaults.\n   * - step: > 0 number, otherwise 1\n   * - decimals: integer >= 0, otherwise 0\n   * - min/max: finite numbers or null\n   * - stepinterval/stepintervaldelay: integers >= 0 (fallback to defaults if invalid)\n   * @private\n   */\n  _sanitizeSettings() {\n    // step\n    const stepNum = Number(this.settings.step);\n    if (!isFinite(stepNum) || stepNum <= 0) {\n      this.settings.step = 1;\n    } else {\n      this.settings.step = stepNum;\n    }\n\n    // decimals\n    const decNum = Number(this.settings.decimals);\n    if (!isFinite(decNum) || decNum < 0) {\n      this.settings.decimals = 0;\n    } else {\n      this.settings.decimals = Math.floor(decNum);\n    }\n\n    // min/max\n    // Preserve explicit nulls; coerce other values to numbers or null\n    if (this.settings.min === null || this.settings.min === undefined || this.settings.min === '') {\n      this.settings.min = null;\n    } else {\n      const minNum = Number(this.settings.min);\n      this.settings.min = isFinite(minNum) ? minNum : null;\n    }\n    if (this.settings.max === null || this.settings.max === undefined || this.settings.max === '') {\n      this.settings.max = null;\n    } else {\n      const maxNum = Number(this.settings.max);\n      this.settings.max = isFinite(maxNum) ? maxNum : null;\n    }\n\n    // Ensure min <= max when both present\n    if (this.settings.min !== null && this.settings.max !== null && this.settings.min > this.settings.max) {\n      // Swap to maintain logical bounds\n      const tmp = this.settings.min;\n      this.settings.min = this.settings.max;\n      this.settings.max = tmp;\n    }\n\n    // stepinterval\n    const si = Number(this.settings.stepinterval);\n    if (!isFinite(si) || si < 0) this.settings.stepinterval = DEFAULTS.stepinterval;\n\n    // stepintervaldelay\n    const sid = Number(this.settings.stepintervaldelay);\n    if (!isFinite(sid) || sid < 0) this.settings.stepintervaldelay = DEFAULTS.stepintervaldelay;\n  }\n\n  /**\n   * Parse data-bts-* attributes from the input element.\n   * @param {HTMLInputElement} inputEl\n   * @returns {Partial<TouchSpinCoreOptions>}\n   * @private\n   */\n  _parseDataAttributes(inputEl) {\n    const attributeMap = {\n      min: 'min',\n      max: 'max',\n      initval: 'init-val',\n      replacementval: 'replacement-val',\n      firstclickvalueifempty: 'first-click-value-if-empty',\n      step: 'step',\n      decimals: 'decimals',\n      stepinterval: 'step-interval',\n      verticalbuttons: 'vertical-buttons',\n      verticalup: 'vertical-up',\n      verticaldown: 'vertical-down',\n      verticalupclass: 'vertical-up-class',\n      verticaldownclass: 'vertical-down-class',\n      forcestepdivisibility: 'force-step-divisibility',\n      stepintervaldelay: 'step-interval-delay',\n      prefix: 'prefix',\n      postfix: 'postfix',\n      prefix_extraclass: 'prefix-extra-class',\n      postfix_extraclass: 'postfix-extra-class',\n      booster: 'booster',\n      boostat: 'boostat',\n      maxboostedstep: 'max-boosted-step',\n      mousewheel: 'mouse-wheel',\n      buttondown_class: 'button-down-class',\n      buttonup_class: 'button-up-class',\n      buttondown_txt: 'button-down-txt',\n      buttonup_txt: 'button-up-txt'\n    };\n\n    const parsed = {};\n\n    // Parse data-bts-* attributes\n    for (const [optionName, attrName] of Object.entries(attributeMap)) {\n      const fullAttrName = `data-bts-${attrName}`;\n      if (inputEl.hasAttribute(fullAttrName)) {\n        const rawValue = inputEl.getAttribute(fullAttrName);\n        parsed[optionName] = this._coerceAttributeValue(optionName, rawValue);\n      }\n    }\n\n    // Also handle native attributes with precedence (warn if both specified)\n    for (const nativeAttr of ['min', 'max', 'step']) {\n      if (inputEl.hasAttribute(nativeAttr)) {\n        const rawValue = inputEl.getAttribute(nativeAttr);\n        if (parsed[nativeAttr] !== undefined) {\n          console.warn(`Both \"data-bts-${nativeAttr}\" and \"${nativeAttr}\" attributes specified. Native attribute takes precedence.`, inputEl);\n        }\n        parsed[nativeAttr] = this._coerceAttributeValue(nativeAttr, rawValue);\n      }\n    }\n\n    return parsed;\n  }\n\n  /**\n   * Convert string attribute values to appropriate types.\n   * @param {string} optionName\n   * @param {string} rawValue\n   * @returns {any}\n   * @private\n   */\n  _coerceAttributeValue(optionName, rawValue) {\n    if (rawValue === null || rawValue === undefined) {\n      return rawValue;\n    }\n\n    // Boolean attributes\n    if (['booster', 'mousewheel', 'verticalbuttons'].includes(optionName)) {\n      return rawValue === 'true' || rawValue === '' || rawValue === optionName;\n    }\n\n    // Numeric attributes\n    if (['min', 'max', 'step', 'decimals', 'stepinterval', 'stepintervaldelay',\n         'boostat', 'maxboostedstep', 'firstclickvalueifempty'].includes(optionName)) {\n      const num = parseFloat(rawValue);\n      return isNaN(num) ? rawValue : num;\n    }\n\n    // String attributes - return as-is\n    return rawValue;\n  }\n\n  /** Increment once according to step */\n  upOnce() {\n    if (this.input.disabled || this.input.hasAttribute('readonly')) {\n      return;\n    }\n\n    const v = this.getValue();\n    const next = this._nextValue('up', v);\n\n    // Check if already at max boundary before incrementing\n    if (this.settings.max !== null && v === this.settings.max) {\n      this.emit('max');\n      if (this.spinning && this.direction === 'up') {\n        this.stopSpin();\n      }\n      return;\n    }\n\n    // Fire max event BEFORE setting display if we're reaching max\n    if (this.settings.max !== null && next === this.settings.max) {\n      this.emit('max');\n      if (this.spinning && this.direction === 'up') {\n        this.stopSpin();\n      }\n    }\n\n    this._setDisplay(next, true);\n  }\n\n  /** Decrement once according to step */\n  downOnce() {\n    if (this.input.disabled || this.input.hasAttribute('readonly')) {\n      return;\n    }\n\n    const v = this.getValue();\n    const next = this._nextValue('down', v);\n\n    // Check if already at min boundary before decrementing\n    if (this.settings.min !== null && v === this.settings.min) {\n      this.emit('min');\n      if (this.spinning && this.direction === 'down') {\n        this.stopSpin();\n      }\n      return;\n    }\n\n    // Fire min event BEFORE setting display if we're reaching min\n    if (this.settings.min !== null && next === this.settings.min) {\n      this.emit('min');\n      if (this.spinning && this.direction === 'down') {\n        this.stopSpin();\n      }\n    }\n\n    this._setDisplay(next, true);\n  }\n\n  /** Start increasing repeatedly; no immediate step here. */\n  startUpSpin() {\n    this._startSpin('up');\n  }\n\n  /** Start decreasing repeatedly; no immediate step here. */\n  startDownSpin() {\n    this._startSpin('down');\n  }\n\n  /** Stop spinning (placeholder) */\n  stopSpin() {\n    this._clearSpinTimers();\n    if (this.spinning) {\n      if (this.direction === 'up') {\n        this.emit('stopupspin');\n        this.emit('stopspin');\n      } else if (this.direction === 'down') {\n        this.emit('stopdownspin');\n        this.emit('stopspin');\n      }\n    }\n    this.spinning = false;\n    this.direction = false;\n    this.spincount = 0;\n  }\n\n  /**\n   * @param {Partial<TouchSpinCoreOptions>} opts\n   */\n  updateSettings(opts) {\n    const oldSettings = { ...this.settings };\n    const newSettings = opts || {};\n\n    // Sanitize the incoming partial BEFORE merge\n    const sanitizedPartial = TouchSpinCore.sanitizePartialSettings(newSettings, oldSettings);\n\n    // Apply incoming changes (sanitized) first\n    Object.assign(this.settings, sanitizedPartial);\n    // Extra safety: sanitize full settings after merge\n    this._sanitizeSettings();\n\n    // If step/min/max changed and step != 1, align bounds to step like the jQuery plugin\n    const step = Number(this.settings.step || 1);\n    if ((sanitizedPartial.step !== undefined || sanitizedPartial.min !== undefined || sanitizedPartial.max !== undefined) && step !== 1) {\n      if (this.settings.max !== null) {\n        this.settings.max = this._alignToStep(Number(this.settings.max), step, 'down');\n      }\n      if (this.settings.min !== null) {\n        this.settings.min = this._alignToStep(Number(this.settings.min), step, 'up');\n      }\n    }\n\n    // Notify observers of keys whose EFFECTIVE values changed after sanitization\n    Object.keys(this.settings).forEach(key => {\n      if (oldSettings[key] !== this.settings[key]) {\n        const observers = this._settingObservers.get(key);\n        if (observers) {\n          observers.forEach(callback => {\n            try {\n              callback(this.settings[key], oldSettings[key]);\n            } catch (error) {\n              console.error('TouchSpin: Error in setting observer callback:', error);\n            }\n          });\n        }\n      }\n    });\n\n    // Core handles its own setting changes\n    this._updateAriaAttributes();\n    this._syncNativeAttributes();\n    this._checkValue(false);\n  }\n\n  /** @returns {number} */\n  getValue() {\n    let raw = this.input.value;\n    if (raw === '' && this.settings.replacementval !== '') {\n      raw = this.settings.replacementval;\n    }\n    if (raw === '') return NaN;\n    const before = this.settings.callback_before_calculation || ((v) => v);\n    const num = parseFloat(before(String(raw)));\n    return isNaN(num) ? NaN : num;\n  }\n\n  /**\n   * @param {number|string} v\n   */\n  setValue(v) {\n    if (this.input.disabled || this.input.hasAttribute('readonly')) return;\n    const parsed = Number(v);\n    if (!isFinite(parsed)) return;\n    const adjusted = this._applyConstraints(parsed);\n    this._setDisplay(adjusted, true);\n  }\n\n  /**\n   * Initialize DOM event handling by finding elements and attaching listeners.\n   * Must be called after the renderer has created the DOM structure.\n   */\n  initDOMEventHandling() {\n    // Find DOM elements and attach listeners\n    this._findDOMElements();\n    this._attachDOMEventListeners();\n  }\n\n  /**\n   * Register a teardown callback that will be called when the instance is destroyed.\n   * This allows wrapper libraries to register cleanup logic.\n   * @param {Function} callback - Function to call on destroy\n   * @returns {Function} - Unregister function\n   */\n  registerTeardown(callback) {\n    if (typeof callback !== 'function') {\n      throw new Error('Teardown callback must be a function');\n    }\n    this._teardownCallbacks.push(callback);\n\n    // Return unregister function\n    return () => {\n      const index = this._teardownCallbacks.indexOf(callback);\n      if (index > -1) {\n        this._teardownCallbacks.splice(index, 1);\n      }\n    };\n  }\n\n  /** Cleanup and destroy the TouchSpin instance */\n  destroy() {\n    this.stopSpin();\n\n    // Renderer cleans up its added elements\n    if (this.renderer && this.renderer.teardown) {\n      this.renderer.teardown();\n    }\n\n    // Core cleans up input events only\n    this._detachDOMEventListeners();\n\n    // Call all registered teardown callbacks (for wrapper cleanup)\n    this._teardownCallbacks.forEach(callback => {\n      try {\n        callback();\n      } catch (error) {\n        console.error('TouchSpin teardown callback error:', error);\n      }\n    });\n    this._teardownCallbacks.length = 0; // Clear the array\n\n    // Clear setting observers\n    this._settingObservers.clear();\n\n    // Clean up mutation observer\n    if (this._mutationObserver) {\n      this._mutationObserver.disconnect();\n      this._mutationObserver = null;\n    }\n\n    // Clear button references\n    this._upButton = null;\n    this._downButton = null;\n\n    // Remove instance from element\n    if (this.input[INSTANCE_KEY] === this) {\n      delete this.input[INSTANCE_KEY];\n    }\n  }\n\n  /**\n   * Create a plain public API object with bound methods for wrappers.\n   * @returns {TouchSpinCorePublicAPI}\n   */\n  toPublicApi() {\n    return {\n      upOnce: this.upOnce.bind(this),\n      downOnce: this.downOnce.bind(this),\n      startUpSpin: this.startUpSpin.bind(this),\n      startDownSpin: this.startDownSpin.bind(this),\n      stopSpin: this.stopSpin.bind(this),\n      updateSettings: this.updateSettings.bind(this),\n      getValue: this.getValue.bind(this),\n      setValue: this.setValue.bind(this),\n      destroy: this.destroy.bind(this),\n      on: this.on.bind(this),\n      off: this.off.bind(this),\n      initDOMEventHandling: this.initDOMEventHandling.bind(this),\n      registerTeardown: this.registerTeardown.bind(this),\n      attachUpEvents: this.attachUpEvents.bind(this),\n      attachDownEvents: this.attachDownEvents.bind(this),\n      observeSetting: this.observeSetting.bind(this),\n    };\n  }\n\n  // --- Renderer Event Attachment Methods ---\n  /**\n   * Attach up button events to an element\n   * Called by renderers after creating up button\n   * @param {HTMLElement|null} element - The element to attach events to\n   */\n  attachUpEvents(element) {\n    if (!element) {\n      console.warn('TouchSpin: attachUpEvents called with null element');\n      return;\n    }\n\n    this._upButton = element;\n    element.addEventListener('mousedown', this._handleUpMouseDown);\n    element.addEventListener('touchstart', this._handleUpMouseDown, {passive: false});\n\n    // Add keyboard event listeners if focusable buttons are enabled\n    if (this.settings.focusablebuttons) {\n      element.addEventListener('keydown', this._handleUpKeyDown);\n      element.addEventListener('keyup', this._handleUpKeyUp);\n    }\n\n    // Update disabled state immediately after attaching\n    this._updateButtonDisabledState();\n  }\n\n  /**\n   * Attach down button events to an element\n   * Called by renderers after creating down button\n   * @param {HTMLElement|null} element - The element to attach events to\n   */\n  attachDownEvents(element) {\n    if (!element) {\n      console.warn('TouchSpin: attachDownEvents called with null element');\n      return;\n    }\n\n    this._downButton = element;\n    element.addEventListener('mousedown', this._handleDownMouseDown);\n    element.addEventListener('touchstart', this._handleDownMouseDown, {passive: false});\n\n    // Add keyboard event listeners if focusable buttons are enabled\n    if (this.settings.focusablebuttons) {\n      element.addEventListener('keydown', this._handleDownKeyDown);\n      element.addEventListener('keyup', this._handleDownKeyUp);\n    }\n\n    // Update disabled state immediately after attaching\n    this._updateButtonDisabledState();\n  }\n\n  // --- Settings Observer Pattern ---\n  /**\n   * Allow renderers to observe setting changes\n   * @param {string} settingName - Name of setting to observe\n   * @param {Function} callback - Function to call when setting changes (newValue, oldValue)\n   * @returns {Function} Unsubscribe function\n   */\n  observeSetting(settingName, callback) {\n    if (!this._settingObservers.has(settingName)) {\n      this._settingObservers.set(settingName, new Set());\n    }\n\n    const observers = this._settingObservers.get(settingName);\n    observers.add(callback);\n\n    // Return unsubscribe function\n    return () => observers.delete(callback);\n  }\n\n  // --- Minimal internal emitter API ---\n  /**\n   * Subscribe to a core event.\n   * Events: 'min', 'max', 'startspin', 'startupspin', 'startdownspin', 'stopspin', 'stopupspin', 'stopdownspin'\n   * @param {string} event\n   * @param {(detail?: any) => void} handler\n   */\n  on(event, handler) {\n    const set = this._events.get(event) || new Set();\n    set.add(handler);\n    this._events.set(event, set);\n    return () => this.off(event, handler);\n  }\n\n  /**\n   * Unsubscribe from a core event.\n   * @param {string} event\n   * @param {(detail?: any) => void=} handler\n   */\n  off(event, handler) {\n    const set = this._events.get(event);\n    if (!set) return;\n    if (!handler) {\n      this._events.delete(event);\n      return;\n    }\n    set.delete(handler);\n    if (set.size === 0) this._events.delete(event);\n  }\n\n  /**\n   * Emit a core event to subscribers.\n   * @param {string} event\n   * @param {any=} detail\n   */\n  emit(event, detail) {\n    const set = this._events.get(event);\n    if (!set || set.size === 0) return;\n    for (const fn of [...set]) {\n      try { fn(detail); } catch {\n        // Silently ignore callback errors to prevent one bad callback from breaking others\n      }\n    }\n  }\n\n  /**\n   * Internal: start timed spin in a direction with initial step, delay, then interval.\n   * @param {'up'|'down'} dir\n   */\n  _startSpin(dir) {\n    if (this.input.disabled || this.input.hasAttribute('readonly')) return;\n\n    // If already spinning in the same direction, do nothing (idempotent)\n    if (this.spinning && this.direction === dir) {\n      return;\n    }\n    // If switching direction while spinning, stop first\n    if (this.spinning && this.direction !== dir) {\n      this.stopSpin();\n    }\n\n    // Perform an immediate single step before starting timers (parity with jQuery plugin UX)\n    if (dir === 'up') this.upOnce(); else this.downOnce();\n\n    // If we reached a boundary after the initial step, don't start continuous spin\n    const v = this.getValue();\n    if (dir === 'up' && this.settings.max !== null && v === this.settings.max) {\n      return;\n    }\n    if (dir === 'down' && this.settings.min !== null && v === this.settings.min) {\n      return;\n    }\n\n    // If changing direction, reset counters\n    const direction_changed = (!this.spinning || this.direction !== dir);\n    if (direction_changed) {\n      this.spinning = true;\n      this.direction = dir;\n      this.spincount = 0;\n      // Match jQuery plugin event order: startspin then direction-specific\n      this.emit('startspin');\n      if (dir === 'up') this.emit('startupspin'); else this.emit('startdownspin');\n    }\n\n    // Clear previous timers\n    this._clearSpinTimers();\n    // Schedule repeat after delay, then at interval\n    const delay = this.settings.stepintervaldelay || 500;\n    const interval = this.settings.stepinterval || 100;\n    this._spinDelayTimeout = setTimeout(() => {\n      this._spinDelayTimeout = null;\n      this._spinIntervalTimer = setInterval(() => {\n        if (!this.spinning || this.direction !== dir) return; // safety\n        this._spinStep(dir);\n      }, interval);\n    }, delay);\n  }\n\n  _clearSpinTimers() {\n    try { if (this._spinDelayTimeout) { clearTimeout(this._spinDelayTimeout); } } catch {\n      // Ignore timer cleanup errors\n    }\n    try { if (this._spinIntervalTimer) { clearInterval(this._spinIntervalTimer); } } catch {\n      // Ignore timer cleanup errors\n    }\n    this._spinDelayTimeout = null;\n    this._spinIntervalTimer = null;\n  }\n\n  /**\n   * Compute the next numeric value for a direction, respecting step, booster and bounds.\n   * @param {'up'|'down'} dir\n   * @param {number} current\n   */\n  _nextValue(dir, current) {\n    let v = current;\n    if (isNaN(v)) {\n      v = this._valueIfIsNaN();\n    } else {\n      const base = this.settings.step || 1;\n      const mbs = this.settings.maxboostedstep;\n      let stepCandidate = base;\n      // Apply booster only if enabled\n      if (this.settings.booster) {\n        const boostat = Math.max(1, parseInt(String(this.settings.boostat || 10), 10));\n        stepCandidate = Math.pow(2, Math.floor(this.spincount / boostat)) * base;\n      }\n      let step = stepCandidate;\n      if (mbs && isFinite(mbs) && stepCandidate > Number(mbs)) {\n        step = Number(mbs);\n        // Align current value to the boosted step grid when clamped (parity with jQuery plugin)\n        v = Math.round(v / step) * step;\n      }\n      step = Math.max(base, step);\n      v = dir === 'up' ? v + step : v - step;\n    }\n    return this._applyConstraints(v);\n  }\n\n  /** Returns a reasonable value to use when current is NaN. */\n  _valueIfIsNaN() {\n    if (typeof this.settings.firstclickvalueifempty === 'number') {\n      return this.settings.firstclickvalueifempty;\n    }\n    const min = (typeof this.settings.min === 'number') ? this.settings.min : 0;\n    const max = (typeof this.settings.max === 'number') ? this.settings.max : min;\n    return (min + max) / 2;\n  }\n\n  /** Apply step divisibility and clamp to min/max. */\n  _applyConstraints(v) {\n    const aligned = this._forcestepdivisibility(v);\n    const min = this.settings.min;\n    const max = this.settings.max;\n    let clamped = aligned;\n    if (min !== null && clamped < min) clamped = min;\n    if (max !== null && clamped > max) clamped = max;\n    return clamped;\n  }\n\n  /** Determine the effective step with booster if enabled. */\n  _getBoostedStep() {\n    const base = this.settings.step || 1;\n    if (!this.settings.booster) return base;\n    const boostat = Math.max(1, parseInt(String(this.settings.boostat || 10), 10));\n    let boosted = Math.pow(2, Math.floor(this.spincount / boostat)) * base;\n    const mbs = this.settings.maxboostedstep;\n    if (mbs && isFinite(mbs)) {\n      const cap = Number(mbs);\n      if (boosted > cap) boosted = cap;\n    }\n    return Math.max(base, boosted);\n  }\n\n  /** Aligns value to step per forcestepdivisibility. */\n  _forcestepdivisibility(val) {\n    const mode = this.settings.forcestepdivisibility || 'round';\n    const step = this.settings.step || 1;\n    const dec = this.settings.decimals || 0;\n    let out;\n    switch (mode) {\n      case 'floor':\n        out = Math.floor(val / step) * step; break;\n      case 'ceil':\n        out = Math.ceil(val / step) * step; break;\n      case 'none':\n        out = val; break;\n      case 'round':\n      default:\n        out = Math.round(val / step) * step; break;\n    }\n    // Normalize to configured decimals without string pipeline; formatting applies later\n    return Number(out.toFixed(dec));\n  }\n\n  /** Aligns a value to nearest step boundary using integer arithmetic. */\n  _alignToStep(val, step, dir) {\n    if (step === 0) return val;\n    let k = 1;\n    const s = step;\n    while (((s * k) % 1) !== 0 && k < 1e6) k *= 10;\n    const V = Math.round(val * k);\n    const S = Math.round(step * k);\n    const r = V % S;\n    if (r === 0) return val;\n    return (dir === 'down' ? (V - r) : (V + (S - r))) / k;\n  }\n\n  /** Format and write to input, optionally emit change if different. */\n  _setDisplay(num, mayTriggerChange) {\n    const prev = String(this.input.value ?? '');\n    const next = this._formatDisplay(num);\n    this.input.value = next;\n    this._updateAriaAttributes();\n    if (mayTriggerChange && prev !== next) {\n      // mirror plugin behavior: trigger a native change event\n      this.input.dispatchEvent(new Event('change', { bubbles: true }));\n    }\n    return next;\n  }\n\n  _formatDisplay(num) {\n    const dec = this.settings.decimals || 0;\n    const after = this.settings.callback_after_calculation || ((v) => v);\n    const s = Number(num).toFixed(dec);\n    return after(s);\n  }\n\n  /**\n   * Perform one spin step in a direction while tracking spincount for booster.\n   * @param {'up'|'down'} dir\n   */\n  _spinStep(dir) {\n    this.spincount++;\n    if (dir === 'up') this.upOnce(); else this.downOnce();\n  }\n\n  /** Sanitize current input value and update display; optionally emits change. */\n  _checkValue(mayTriggerChange) {\n    const v = this.getValue();\n    if (!isFinite(v)) return;\n    const adjusted = this._applyConstraints(v);\n    this._setDisplay(adjusted, !!mayTriggerChange);\n  }\n\n  _updateAriaAttributes() {\n    const el = this.input;\n    if (el.getAttribute('role') !== 'spinbutton') {\n      el.setAttribute('role', 'spinbutton');\n    }\n    const min = this.settings.min;\n    const max = this.settings.max;\n    if (min !== null) el.setAttribute('aria-valuemin', String(min)); else el.removeAttribute('aria-valuemin');\n    if (max !== null) el.setAttribute('aria-valuemax', String(max)); else el.removeAttribute('aria-valuemax');\n    const raw = el.value;\n    const before = this.settings.callback_before_calculation || ((v) => v);\n    const num = parseFloat(before(String(raw)));\n    if (isFinite(num)) el.setAttribute('aria-valuenow', String(num)); else el.removeAttribute('aria-valuenow');\n    el.setAttribute('aria-valuetext', String(raw));\n  }\n\n  /**\n   * Synchronize TouchSpin settings to native input attributes.\n   * Only applies to type=\"number\" inputs to maintain browser consistency.\n   * @private\n   */\n  _syncNativeAttributes() {\n    // Only set native attributes on number inputs\n    if (this.input.getAttribute('type') === 'number') {\n      // Sync min attribute\n      if (this.settings.min !== null && isFinite(this.settings.min)) {\n        this.input.setAttribute('min', String(this.settings.min));\n      } else {\n        this.input.removeAttribute('min');\n      }\n\n      // Sync max attribute\n      if (this.settings.max !== null && isFinite(this.settings.max)) {\n        this.input.setAttribute('max', String(this.settings.max));\n      } else {\n        this.input.removeAttribute('max');\n      }\n\n      // Sync step attribute\n      if (this.settings.step !== null && isFinite(this.settings.step) && this.settings.step > 0) {\n        this.input.setAttribute('step', String(this.settings.step));\n      } else {\n        this.input.removeAttribute('step');\n      }\n    }\n  }\n\n  /**\n   * Update TouchSpin settings from native attribute changes.\n   * Called by mutation observer when min/max/step attributes change.\n   * @private\n   */\n  _syncSettingsFromNativeAttributes() {\n    const nativeMin = this.input.getAttribute('min');\n    const nativeMax = this.input.getAttribute('max');\n    const nativeStep = this.input.getAttribute('step');\n    let needsUpdate = false;\n    const newSettings = {};\n\n    // Check min attribute\n    if (nativeMin !== null) {\n      const parsedMin = nativeMin === '' ? null : parseFloat(nativeMin);\n      const minNum = parsedMin !== null && isFinite(parsedMin) ? parsedMin : null;\n      if (minNum !== this.settings.min) {\n        newSettings.min = minNum;\n        needsUpdate = true;\n      }\n    } else if (this.settings.min !== null) {\n      // Attribute was removed\n      newSettings.min = null;\n      needsUpdate = true;\n    }\n\n    // Check max attribute\n    if (nativeMax !== null) {\n      const parsedMax = nativeMax === '' ? null : parseFloat(nativeMax);\n      const maxNum = parsedMax !== null && isFinite(parsedMax) ? parsedMax : null;\n      if (maxNum !== this.settings.max) {\n        newSettings.max = maxNum;\n        needsUpdate = true;\n      }\n    } else if (this.settings.max !== null) {\n      // Attribute was removed\n      newSettings.max = null;\n      needsUpdate = true;\n    }\n\n    // Check step attribute\n    if (nativeStep !== null) {\n      const parsedStep = nativeStep === '' ? null : parseFloat(nativeStep);\n      const stepNum = parsedStep !== null && isFinite(parsedStep) && parsedStep > 0 ? parsedStep : null;\n      if (stepNum !== this.settings.step) {\n        newSettings.step = stepNum;\n        needsUpdate = true;\n      }\n    } else if (this.settings.step !== 1) {\n      // Attribute was removed, reset to default\n      newSettings.step = 1;\n      needsUpdate = true;\n    }\n\n    // Apply updates if needed\n    if (needsUpdate) {\n      this.updateSettings(newSettings);\n    }\n  }\n\n  // --- DOM Event Handling Methods ---\n\n  /**\n   * Find and store references to DOM elements using data-touchspin-injected attributes.\n   * @private\n   */\n  _findDOMElements() {\n    // Core doesn't need to find buttons - renderers handle button events directly\n    // We only need to find the wrapper for potential future use\n    let wrapper = this.input.parentElement;\n    while (wrapper && !wrapper.hasAttribute('data-touchspin-injected')) {\n      wrapper = wrapper.parentElement;\n    }\n    this._wrapper = wrapper;\n  }\n\n  /**\n   * Attach DOM event listeners to elements.\n   * @private\n   */\n  _attachDOMEventListeners() {\n    // Core should NOT attach button events - renderers handle that via attachUpEvents/attachDownEvents\n\n    // Global mouseup/touchend to stop spinning\n    document.addEventListener('mouseup', this._handleMouseUp);\n    document.addEventListener('mouseleave', this._handleMouseUp);\n    document.addEventListener('touchend', this._handleMouseUp);\n\n    // Input events (always attach these - they work without renderer UI)\n    this.input.addEventListener('change', this._handleInputChange, true); // Capture phase to intercept\n    this.input.addEventListener('blur', this._handleInputBlur);\n    this.input.addEventListener('keydown', this._handleKeyDown);\n    this.input.addEventListener('keyup', this._handleKeyUp);\n    this.input.addEventListener('wheel', this._handleWheel);\n  }\n\n  /**\n   * Remove DOM event listeners.\n   * @private\n   */\n  _detachDOMEventListeners() {\n    // Core does not manage button events - renderers handle their own cleanup\n\n    // Global events\n    document.removeEventListener('mouseup', this._handleMouseUp);\n    document.removeEventListener('mouseleave', this._handleMouseUp);\n    document.removeEventListener('touchend', this._handleMouseUp);\n\n    // Input events\n    this.input.removeEventListener('change', this._handleInputChange, true);\n    this.input.removeEventListener('blur', this._handleInputBlur);\n    this.input.removeEventListener('keydown', this._handleKeyDown);\n    this.input.removeEventListener('keyup', this._handleKeyUp);\n    this.input.removeEventListener('wheel', this._handleWheel);\n  }\n\n  // --- DOM Event Handlers ---\n\n  /**\n   * Handle mousedown/touchstart on up button.\n   * @private\n   */\n  _handleUpMouseDown(e) {\n    e.preventDefault();\n    this.startUpSpin();\n  }\n\n  /**\n   * Handle mousedown/touchstart on down button.\n   * @private\n   */\n  _handleDownMouseDown(e) {\n    e.preventDefault();\n    this.startDownSpin();\n  }\n\n  /**\n   * Handle mouseup/touchend/mouseleave to stop spinning.\n   * @private\n   */\n  _handleMouseUp(e) {\n    this.stopSpin();\n  }\n\n  /**\n   * Handle keydown events on up button.\n   * @private\n   */\n  _handleUpKeyDown(e) {\n    // Only handle Enter and Space keys\n    if (e.keyCode === 13 || e.keyCode === 32) { // Enter or Space\n      e.preventDefault();\n      // Ignore auto-repeat while holding the key\n      if (e.repeat) return;\n      this.startUpSpin();\n    }\n  }\n\n  /**\n   * Handle keyup events on up button.\n   * @private\n   */\n  _handleUpKeyUp(e) {\n    // Only handle Enter and Space keys\n    if (e.keyCode === 13 || e.keyCode === 32) { // Enter or Space\n      this.stopSpin();\n    }\n  }\n\n  /**\n   * Handle keydown events on down button.\n   * @private\n   */\n  _handleDownKeyDown(e) {\n    // Only handle Enter and Space keys\n    if (e.keyCode === 13 || e.keyCode === 32) { // Enter or Space\n      e.preventDefault();\n      // Ignore auto-repeat while holding the key\n      if (e.repeat) return;\n      this.startDownSpin();\n    }\n  }\n\n  /**\n   * Handle keyup events on down button.\n   * @private\n   */\n  _handleDownKeyUp(e) {\n    // Only handle Enter and Space keys\n    if (e.keyCode === 13 || e.keyCode === 32) { // Enter or Space\n      this.stopSpin();\n    }\n  }\n\n  /**\n   * Intercept change events to prevent wrong values from propagating.\n   * @private\n   */\n  _handleInputChange(e) {\n    const currentValue = this.getValue();\n    const wouldBeSanitized = this._applyConstraints(currentValue);\n\n    if (isFinite(currentValue) && currentValue !== wouldBeSanitized) {\n      // This change event has wrong value - prevent it from propagating\n      e.stopImmediatePropagation();\n      // Don't sanitize here - blur handler will do it with correct change event\n    }\n    // If values match, let the change event through normally\n  }\n\n  /**\n   * Handle blur events on the input element for sanitization.\n   * @private\n   */\n  _handleInputBlur(e) {\n    this._checkValue(true);\n  }\n\n  /**\n   * Handle keydown events on the input element.\n   * @private\n   */\n  _handleKeyDown(e) {\n    switch (e.key) {\n      case 'ArrowUp':\n        e.preventDefault();\n        if (e.repeat) return; // ignore auto-repeat\n        this.startUpSpin();\n        break;\n      case 'ArrowDown':\n        e.preventDefault();\n        if (e.repeat) return; // ignore auto-repeat\n        this.startDownSpin();\n        break;\n      case 'Enter':\n        this._checkValue(false);\n        break;\n    }\n  }\n\n  /**\n   * Handle keyup events on the input element.\n   * @private\n   */\n  _handleKeyUp(e) {\n    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {\n      this.stopSpin();\n    }\n  }\n\n  /**\n   * Handle wheel events on the input element.\n   * @private\n   */\n  _handleWheel(e) {\n    if (!this.settings.mousewheel) {\n      return;\n    }\n\n    if (document.activeElement === this.input) {\n      e.preventDefault();\n      if (e.deltaY < 0) {\n        this.upOnce();\n      } else if (e.deltaY > 0) {\n        this.downOnce();\n      }\n    }\n  }\n\n  /**\n   * Set up mutation observer to watch for disabled/readonly attribute changes\n   * @private\n   */\n  _setupMutationObserver() {\n    if (typeof MutationObserver !== 'undefined') {\n      this._mutationObserver = new MutationObserver((mutations) => {\n        mutations.forEach((mutation) => {\n          if (mutation.type === 'attributes') {\n            if (mutation.attributeName === 'disabled' || mutation.attributeName === 'readonly') {\n              this._updateButtonDisabledState();\n            } else if (mutation.attributeName === 'min' || mutation.attributeName === 'max' || mutation.attributeName === 'step') {\n              this._syncSettingsFromNativeAttributes();\n            }\n          }\n        });\n      });\n\n      this._mutationObserver.observe(this.input, {\n        attributes: true,\n        attributeFilter: ['disabled', 'readonly', 'min', 'max', 'step']\n      });\n    }\n  }\n\n  /**\n   * Update button disabled state based on input disabled/readonly state\n   * @private\n   */\n  _updateButtonDisabledState() {\n    const isDisabled = this.input.disabled || this.input.hasAttribute('readonly');\n\n    if (this._upButton) {\n      this._upButton.disabled = isDisabled;\n    }\n    if (this._downButton) {\n      this._downButton.disabled = isDisabled;\n    }\n\n    if (isDisabled) {\n      this.stopSpin();\n    }\n  }\n}\n\n/**\n * @typedef {Object} TouchSpinCorePublicAPI\n * @property {() => void} upOnce\n * @property {() => void} downOnce\n * @property {() => void} startUpSpin\n * @property {() => void} startDownSpin\n * @property {() => void} stopSpin\n * @property {(opts: Partial<TouchSpinCoreOptions>) => void} updateSettings\n * @property {() => number} getValue\n * @property {(v: number|string) => void} setValue\n * @property {() => void} destroy\n * @property {(event: string, handler: (detail?: any) => void) => () => void} on\n * @property {(event: string, handler?: (detail?: any) => void) => void} off\n * @property {() => void} initDOMEventHandling\n * @property {(callback: Function) => () => void} registerTeardown\n */\n\n/**\n * Initialize TouchSpin on an input element or get existing instance.\n * @param {HTMLInputElement} inputEl\n * @param {Partial<TouchSpinCoreOptions>=} opts\n * @returns {TouchSpinCorePublicAPI|null}\n */\nexport function TouchSpin(inputEl, opts) {\n  // Check if element is an input (graceful handling for public API)\n  if (!inputEl || inputEl.nodeName !== 'INPUT') {\n    console.warn('Must be an input.');\n    return null;\n  }\n\n  // If options provided, initialize/reinitialize\n  if (opts !== undefined) {\n    // Destroy existing instance if it exists (destroy() removes itself from element)\n    if (inputEl[INSTANCE_KEY]) {\n      console.warn('TouchSpin: Destroying existing instance and reinitializing. Consider using updateSettings() instead.');\n      inputEl[INSTANCE_KEY].destroy();\n    }\n\n    // Create new instance and store on element\n    const core = new TouchSpinCore(inputEl, opts);\n    inputEl[INSTANCE_KEY] = core;\n\n    // Initialize DOM event handling\n    core.initDOMEventHandling();\n\n    return core.toPublicApi();\n  }\n\n  // No options - return existing instance or create with defaults\n  if (!inputEl[INSTANCE_KEY]) {\n    const core = new TouchSpinCore(inputEl, {});\n    inputEl[INSTANCE_KEY] = core;\n    core.initDOMEventHandling();\n    return core.toPublicApi();\n  }\n\n  return inputEl[INSTANCE_KEY].toPublicApi();\n}\n\n/**\n * Get existing TouchSpin instance from input element (without creating one).\n * @param {HTMLInputElement} inputEl\n * @returns {TouchSpinCorePublicAPI|null}\n */\nexport function getTouchSpin(inputEl) {\n  return inputEl[INSTANCE_KEY] ? inputEl[INSTANCE_KEY].toPublicApi() : null;\n}\n\n/**\n * Create and return a plain public API bound to a new core instance.\n * @param {HTMLInputElement} inputEl\n * @param {Partial<TouchSpinCoreOptions>=} opts\n * @returns {TouchSpinCorePublicAPI}\n * @deprecated Use TouchSpin() instead\n */\nexport function createPublicApi(inputEl, opts) {\n  return TouchSpin(inputEl, opts);\n}\n\n/** Event name constants for wrappers to map/bridge. */\nexport const CORE_EVENTS = Object.freeze({\n  MIN: 'min',\n  MAX: 'max',\n  START_SPIN: 'startspin',\n  START_UP: 'startupspin',\n  START_DOWN: 'startdownspin',\n  STOP_SPIN: 'stopspin',\n  STOP_UP: 'stopupspin',\n  STOP_DOWN: 'stopdownspin',\n});\n\n/**\n * Convenience helper to attach core to an input element.\n * @param {HTMLInputElement} inputEl\n * @param {Partial<TouchSpinCoreOptions>=} opts\n * @returns {TouchSpinCore}\n */\nexport function attach(inputEl, opts) {\n  return new TouchSpinCore(inputEl, opts);\n}\n\nexport default TouchSpinCore;\n\n// Note: AbstractRenderer is not exported as it's only needed by renderer implementations\n// Renderers should import it directly: import AbstractRenderer from '../../../core/src/AbstractRenderer.js';\n","/**\n * Bootstrap 5 Renderer - New Architecture\n * Builds Bootstrap 5 UI elements around TouchSpin input\n */\nimport AbstractRenderer from '../../../core/src/AbstractRenderer.js';\n\nclass Bootstrap5Renderer extends AbstractRenderer {\n\n  init() {\n    // Initialize internal element references\n    this.prefixEl = null;\n    this.postfixEl = null;\n\n    // Add form-control class if not present (Bootstrap requirement)\n    if (!this.input.classList.contains('form-control')) {\n      this.input.classList.add('form-control');\n      this._formControlAdded = true; // Track if we added it\n    }\n\n    // Build DOM structure and attach events\n    this.buildAndAttachDOM();\n\n    // 4. Register for setting changes we care about\n    this.core.observeSetting('prefix', (newValue) => this.updatePrefix(newValue));\n    this.core.observeSetting('postfix', (newValue) => this.updatePostfix(newValue));\n    this.core.observeSetting('buttonup_class', (newValue) => this.updateButtonClass('up', newValue));\n    this.core.observeSetting('buttondown_class', (newValue) => this.updateButtonClass('down', newValue));\n    this.core.observeSetting('verticalupclass', (newValue) => this.updateVerticalButtonClass('up', newValue));\n    this.core.observeSetting('verticaldownclass', (newValue) => this.updateVerticalButtonClass('down', newValue));\n    this.core.observeSetting('verticalup', (newValue) => this.updateVerticalButtonText('up', newValue));\n    this.core.observeSetting('verticaldown', (newValue) => this.updateVerticalButtonText('down', newValue));\n    this.core.observeSetting('buttonup_txt', (newValue) => this.updateButtonText('up', newValue));\n    this.core.observeSetting('buttondown_txt', (newValue) => this.updateButtonText('down', newValue));\n    this.core.observeSetting('prefix_extraclass', (newValue) => this.updatePrefixClasses());\n    this.core.observeSetting('postfix_extraclass', (newValue) => this.updatePostfixClasses());\n    this.core.observeSetting('verticalbuttons', (newValue) => this.handleVerticalButtonsChange(newValue));\n    this.core.observeSetting('focusablebuttons', (newValue) => this.updateButtonFocusability(newValue));\n  }\n\n  teardown() {\n    // Remove form-control class only if we added it\n    if (this._formControlAdded) {\n      this.input.classList.remove('form-control');\n      this._formControlAdded = false;\n    }\n\n    // Call parent teardown to handle DOM cleanup\n    super.teardown();\n  }\n\n  buildInputGroup() {\n    // Check if input is already inside an input-group\n    const existingInputGroup = this.input.closest('.input-group');\n\n    if (existingInputGroup) {\n      return this.buildAdvancedInputGroup(existingInputGroup);\n    } else {\n      return this.buildBasicInputGroup();\n    }\n  }\n\n  buildBasicInputGroup() {\n    const inputGroupSize = this._detectInputGroupSize();\n\n    let html;\n    if (this.settings.verticalbuttons) {\n      html = `\n        <div class=\"input-group ${inputGroupSize} bootstrap-touchspin\">\n          ${this.settings.prefix ? `<span class=\"input-group-text bootstrap-touchspin-prefix ${this.settings.prefix_extraclass || ''}\" data-touchspin-injected=\"prefix\"${this.getPrefixTestId()}>${this.settings.prefix}</span>` : ''}\n          ${this.settings.postfix ? `<span class=\"input-group-text bootstrap-touchspin-postfix ${this.settings.postfix_extraclass || ''}\" data-touchspin-injected=\"postfix\"${this.getPostfixTestId()}>${this.settings.postfix}</span>` : ''}\n          ${this.buildVerticalButtons()}\n        </div>\n      `;\n    } else {\n      html = `\n        <div class=\"input-group ${inputGroupSize} bootstrap-touchspin\">\n          <button tabindex=\"${this.settings.focusablebuttons ? '0' : '-1'}\" class=\"${this.settings.buttondown_class || 'btn btn-outline-secondary'} bootstrap-touchspin-down\" data-touchspin-injected=\"down\"${this.getDownButtonTestId()} type=\"button\" aria-label=\"Decrease value\">${this.settings.buttondown_txt || 'âˆ’'}</button>\n          ${this.settings.prefix ? `<span class=\"input-group-text bootstrap-touchspin-prefix ${this.settings.prefix_extraclass || ''}\" data-touchspin-injected=\"prefix\"${this.getPrefixTestId()}>${this.settings.prefix}</span>` : ''}\n          ${this.settings.postfix ? `<span class=\"input-group-text bootstrap-touchspin-postfix ${this.settings.postfix_extraclass || ''}\" data-touchspin-injected=\"postfix\"${this.getPostfixTestId()}>${this.settings.postfix}</span>` : ''}\n          <button tabindex=\"${this.settings.focusablebuttons ? '0' : '-1'}\" class=\"${this.settings.buttonup_class || 'btn btn-outline-secondary'} bootstrap-touchspin-up\" data-touchspin-injected=\"up\"${this.getUpButtonTestId()} type=\"button\" aria-label=\"Increase value\">${this.settings.buttonup_txt || '+'}</button>\n        </div>\n      `;\n    }\n\n    // Create wrapper and wrap the input\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = html.trim();\n    const wrapper = tempDiv.firstChild;\n\n    // Insert wrapper and move input into it\n    this.input.parentElement.insertBefore(wrapper, this.input);\n\n    // Find the position to insert input\n    if (this.settings.verticalbuttons) {\n      // For vertical buttons: prefix -> input -> postfix -> vertical-buttons\n      const prefixEl = wrapper.querySelector('[data-touchspin-injected=\"prefix\"]');\n      const postfixEl = wrapper.querySelector('[data-touchspin-injected=\"postfix\"]');\n      \n      if (prefixEl) {\n        // Insert after prefix\n        wrapper.insertBefore(this.input, prefixEl.nextSibling);\n      } else if (postfixEl) {\n        // No prefix, insert before postfix\n        wrapper.insertBefore(this.input, postfixEl);\n      } else {\n        // No prefix or postfix, insert before vertical wrapper\n        const verticalWrapper = wrapper.querySelector('[data-touchspin-injected=\"vertical-wrapper\"]');\n        wrapper.insertBefore(this.input, verticalWrapper);\n      }\n    } else {\n      // For horizontal buttons: down -> prefix -> input -> postfix -> up\n      const prefixEl = wrapper.querySelector('[data-touchspin-injected=\"prefix\"]');\n      const postfixEl = wrapper.querySelector('[data-touchspin-injected=\"postfix\"]');\n      \n      if (prefixEl) {\n        // Insert after prefix\n        wrapper.insertBefore(this.input, prefixEl.nextSibling);\n      } else if (postfixEl) {\n        // No prefix, insert before postfix\n        wrapper.insertBefore(this.input, postfixEl);\n      } else {\n        // No prefix or postfix, insert before up button\n        const upButton = wrapper.querySelector('[data-touchspin-injected=\"up\"]');\n        wrapper.insertBefore(this.input, upButton);\n      }\n    }\n\n    return wrapper;\n  }\n\n  buildAdvancedInputGroup(existingInputGroup) {\n    // Add bootstrap-touchspin class to existing input-group\n    existingInputGroup.classList.add('bootstrap-touchspin');\n    \n    // Mark this as an advanced wrapper\n    this.wrapperType = 'wrapper-advanced';\n\n    // Create elements based on vertical or horizontal layout\n    let elementsHtml;\n    if (this.settings.verticalbuttons) {\n      elementsHtml = `\n        ${this.settings.prefix ? `<span class=\"input-group-text bootstrap-touchspin-prefix ${this.settings.prefix_extraclass || ''}\" data-touchspin-injected=\"prefix\"${this.getPrefixTestId()}>${this.settings.prefix}</span>` : ''}\n        ${this.settings.postfix ? `<span class=\"input-group-text bootstrap-touchspin-postfix ${this.settings.postfix_extraclass || ''}\" data-touchspin-injected=\"postfix\"${this.getPostfixTestId()}>${this.settings.postfix}</span>` : ''}\n        ${this.buildVerticalButtons()}\n      `;\n    } else {\n      elementsHtml = `\n        <button tabindex=\"${this.settings.focusablebuttons ? '0' : '-1'}\" class=\"${this.settings.buttondown_class || 'btn btn-outline-secondary'} bootstrap-touchspin-down\" data-touchspin-injected=\"down\"${this.getDownButtonTestId()} type=\"button\" aria-label=\"Decrease value\">${this.settings.buttondown_txt || 'âˆ’'}</button>\n        ${this.settings.prefix ? `<span class=\"input-group-text bootstrap-touchspin-prefix ${this.settings.prefix_extraclass || ''}\" data-touchspin-injected=\"prefix\"${this.getPrefixTestId()}>${this.settings.prefix}</span>` : ''}\n        ${this.settings.postfix ? `<span class=\"input-group-text bootstrap-touchspin-postfix ${this.settings.postfix_extraclass || ''}\" data-touchspin-injected=\"postfix\"${this.getPostfixTestId()}>${this.settings.postfix}</span>` : ''}\n        <button tabindex=\"${this.settings.focusablebuttons ? '0' : '-1'}\" class=\"${this.settings.buttonup_class || 'btn btn-outline-secondary'} bootstrap-touchspin-up\" data-touchspin-injected=\"up\"${this.getUpButtonTestId()} type=\"button\" aria-label=\"Increase value\">${this.settings.buttonup_txt || '+'}</button>\n      `;\n    }\n\n    const tempDiv = document.createElement('div');\n    tempDiv.innerHTML = elementsHtml;\n\n    // Declare element references at function scope\n    let prefixEl;\n    let postfixEl;\n\n    if (this.settings.verticalbuttons) {\n      // For vertical buttons: prefix -> input -> postfix -> vertical-buttons\n      prefixEl = tempDiv.querySelector('[data-touchspin-injected=\"prefix\"]');\n      if (prefixEl) {\n        existingInputGroup.insertBefore(prefixEl, this.input);\n      }\n\n      postfixEl = tempDiv.querySelector('[data-touchspin-injected=\"postfix\"]');\n      if (postfixEl) {\n        existingInputGroup.insertBefore(postfixEl, this.input.nextSibling);\n      }\n\n      const verticalWrapper = tempDiv.querySelector('[data-touchspin-injected=\"vertical-wrapper\"]');\n      if (verticalWrapper) {\n        existingInputGroup.insertBefore(verticalWrapper, postfixEl ? postfixEl.nextSibling : this.input.nextSibling);\n      }\n    } else {\n      // For horizontal buttons: down -> prefix -> input -> postfix -> up\n      const downButton = tempDiv.querySelector('[data-touchspin-injected=\"down\"]');\n      if (downButton) {\n        existingInputGroup.insertBefore(downButton, this.input);\n      }\n\n      prefixEl = tempDiv.querySelector('[data-touchspin-injected=\"prefix\"]');\n      if (prefixEl) {\n        existingInputGroup.insertBefore(prefixEl, this.input);\n      }\n\n      postfixEl = tempDiv.querySelector('[data-touchspin-injected=\"postfix\"]');\n      if (postfixEl) {\n        existingInputGroup.insertBefore(postfixEl, this.input.nextSibling);\n      }\n\n      const upButton = tempDiv.querySelector('[data-touchspin-injected=\"up\"]');\n      if (upButton) {\n        existingInputGroup.insertBefore(upButton, postfixEl ? postfixEl.nextSibling : this.input.nextSibling);\n      }\n    }\n\n    // Store internal references for advanced mode too\n    this.prefixEl = prefixEl;\n    this.postfixEl = postfixEl;\n\n    return existingInputGroup;\n  }\n\n  _detectInputGroupSize() {\n    const classList = this.input.className;\n    if (classList.includes('form-control-sm')) {\n      return 'input-group-sm';\n    } else if (classList.includes('form-control-lg')) {\n      return 'input-group-lg';\n    }\n    return '';\n  }\n\n  buildAndAttachDOM() {\n    // 1. Build and inject DOM structure around input\n    this.wrapper = this.buildInputGroup();\n\n    // 2. Find created buttons and store prefix/postfix references\n    const upButton = this.wrapper.querySelector('[data-touchspin-injected=\"up\"]');\n    const downButton = this.wrapper.querySelector('[data-touchspin-injected=\"down\"]');\n    this.prefixEl = this.wrapper.querySelector('[data-touchspin-injected=\"prefix\"]');\n    this.postfixEl = this.wrapper.querySelector('[data-touchspin-injected=\"postfix\"]');\n\n    // 3. Tell core to attach its event handlers\n    this.core.attachUpEvents(upButton);\n    this.core.attachDownEvents(downButton);\n  }\n\n  updatePrefix(value) {\n    // Use internal reference\n    const prefixEl = this.prefixEl;\n\n    if (value && value !== '') {\n      if (prefixEl) {\n        prefixEl.textContent = value;\n        prefixEl.style.display = '';\n        // Update classes in case prefix_extraclass changed\n        prefixEl.className = `input-group-text bootstrap-touchspin-prefix ${this.settings.prefix_extraclass || ''}`.trim();\n      } else {\n        // Element doesn't exist, need to rebuild DOM\n        this.rebuildDOM();\n      }\n    } else if (prefixEl) {\n      // Remove element if value is empty\n      this.rebuildDOM();\n    }\n  }\n\n  updatePostfix(value) {\n    // Use internal reference\n    const postfixEl = this.postfixEl;\n\n    if (value && value !== '') {\n      if (postfixEl) {\n        postfixEl.textContent = value;\n        postfixEl.style.display = '';\n        // Update classes in case postfix_extraclass changed\n        postfixEl.className = `input-group-text bootstrap-touchspin-postfix ${this.settings.postfix_extraclass || ''}`.trim();\n      } else {\n        // Element doesn't exist, need to rebuild DOM\n        this.rebuildDOM();\n      }\n    } else if (postfixEl) {\n      // Remove element if value is empty\n      this.rebuildDOM();\n    }\n  }\n\n  updateButtonClass(type, className) {\n    const button = this.wrapper.querySelector(`[data-touchspin-injected=\"${type}\"]`);\n    if (button) {\n      button.className = `${className || 'btn btn-outline-secondary'} bootstrap-touchspin-${type}`;\n    }\n  }\n\n  buildVerticalButtons() {\n    // Bootstrap 5: Return complete wrapper since there's no outer wrapper in the calling code\n    return `\n      <span class=\"input-group-text bootstrap-touchspin-vertical-button-wrapper\" data-touchspin-injected=\"vertical-wrapper\">\n        <span class=\"input-group-btn-vertical\">\n          <button tabindex=\"${this.settings.focusablebuttons ? '0' : '-1'}\" class=\"${this.settings.buttonup_class || 'btn btn-outline-secondary'} ${this.settings.verticalupclass || 'btn btn-outline-secondary'} bootstrap-touchspin-up\" data-touchspin-injected=\"up\"${this.getUpButtonTestId()} type=\"button\" aria-label=\"Increase value\">${this.settings.verticalup || '+'}</button>\n          <button tabindex=\"${this.settings.focusablebuttons ? '0' : '-1'}\" class=\"${this.settings.buttondown_class || 'btn btn-outline-secondary'} ${this.settings.verticaldownclass || 'btn btn-outline-secondary'} bootstrap-touchspin-down\" data-touchspin-injected=\"down\"${this.getDownButtonTestId()} type=\"button\" aria-label=\"Decrease value\">${this.settings.verticaldown || 'âˆ’'}</button>\n        </span>\n      </span>\n    `;\n  }\n\n  updateVerticalButtonClass(type, className) {\n    const verticalWrapper = this.wrapper.querySelector('[data-touchspin-injected=\"vertical-wrapper\"]');\n    if (verticalWrapper) {\n      const button = verticalWrapper.querySelector(`[data-touchspin-injected=\"${type}\"]`);\n      if (button) {\n        // Update the vertical-specific class while preserving base classes\n        const baseClasses = this.settings.buttonup_class || this.settings.buttondown_class || 'btn btn-outline-secondary';\n        button.className = `${baseClasses} ${className || 'btn btn-outline-secondary'} bootstrap-touchspin-${type}`;\n      }\n    }\n  }\n\n  updateVerticalButtonText(type, text) {\n    const verticalWrapper = this.wrapper.querySelector('[data-touchspin-injected=\"vertical-wrapper\"]');\n    if (verticalWrapper) {\n      const button = verticalWrapper.querySelector(`[data-touchspin-injected=\"${type}\"]`);\n      if (button) {\n        button.textContent = text || (type === 'up' ? '+' : 'âˆ’');\n      }\n    }\n  }\n\n  updateButtonText(type, text) {\n    const button = this.wrapper.querySelector(`[data-touchspin-injected=\"${type}\"]`);\n    if (button) {\n      button.textContent = text || (type === 'up' ? '+' : 'âˆ’');\n    }\n  }\n\n  updatePrefixClasses() {\n    const prefixEl = this.prefixEl;\n    if (prefixEl) {\n      prefixEl.className = `input-group-text bootstrap-touchspin-prefix ${this.settings.prefix_extraclass || ''}`.trim();\n    }\n  }\n\n  updatePostfixClasses() {\n    const postfixEl = this.postfixEl;\n    if (postfixEl) {\n      postfixEl.className = `input-group-text bootstrap-touchspin-postfix ${this.settings.postfix_extraclass || ''}`.trim();\n    }\n  }\n\n  handleVerticalButtonsChange(newValue) {\n    // Remove old DOM and rebuild with new layout\n    this.rebuildDOM();\n  }\n\n  rebuildDOM() {\n    // Remove old DOM and rebuild with current settings\n    this.removeInjectedElements();\n    // Reset wrapper reference since it was removed\n    this.wrapper = null;\n    this.prefixEl = null;\n    this.postfixEl = null;\n    this.buildAndAttachDOM();\n  }\n\n  updateButtonFocusability(newValue) {\n    // Find all buttons and update their tabindex\n    const buttons = this.wrapper.querySelectorAll('[data-touchspin-injected=\"up\"], [data-touchspin-injected=\"down\"]');\n    const tabindex = newValue ? '0' : '-1';\n    buttons.forEach(button => {\n      button.setAttribute('tabindex', tabindex);\n    });\n  }\n}\n\nexport default Bootstrap5Renderer;\n","/**\n * AbstractRenderer - Base class for TouchSpin renderers\n * Part of @touchspin/core package to avoid duplication across renderer packages\n *\n * @example\n * class CustomRenderer extends AbstractRenderer {\n *   init() {\n *     this.wrapper = this.buildUI();\n *     const upBtn = this.wrapper.querySelector('[data-touchspin-injected=\"up\"]');\n *     const downBtn = this.wrapper.querySelector('[data-touchspin-injected=\"down\"]');\n *     this.core.attachUpEvents(upBtn);\n *     this.core.attachDownEvents(downBtn);\n *     this.core.observeSetting('prefix', (value) => this.updatePrefix(value));\n *   }\n * }\n */\nclass AbstractRenderer {\n  /**\n   * @param {HTMLInputElement} inputEl - The input element to render around\n   * @param {Object} settings - TouchSpin settings (read-only)\n   * @param {Object} core - TouchSpin core instance for event delegation\n   */\n  constructor(inputEl, settings, core) {\n    // New renderer architecture\n    /** @type {HTMLInputElement} */\n    this.input = inputEl;\n    /** @type {Object} */\n    this.settings = settings; // Read-only access to settings\n    /** @type {Object} */\n    this.core = core; // Reference to core for calling attachment methods\n    /** @type {HTMLElement|null} */\n    this.wrapper = null; // Set by subclasses during init()\n    /** @type {string} */\n    this.wrapperType = 'wrapper'; // Default wrapper type, set to 'wrapper-advanced' by buildAdvancedInputGroup\n\n    // No legacy properties needed in modern architecture\n  }\n\n  /**\n   * Initialize the renderer - build DOM structure and attach events\n   * Must be implemented by subclasses\n   * @abstract\n   */\n  init() {\n    throw new Error('init() must be implemented by renderer');\n  }\n\n  /**\n   * Cleanup renderer - remove injected elements and restore original state\n   * Default implementation removes all injected elements\n   * Subclasses can override for custom teardown\n   */\n  teardown() {\n    // Default implementation - remove all injected elements\n    this.removeInjectedElements();\n    // Subclasses can override for custom teardown\n  }\n\n  /**\n   * Utility method to remove all injected TouchSpin elements\n   * Handles both regular wrappers and advanced input groups\n   * Called automatically by teardown()\n   */\n  removeInjectedElements() {\n    // Find and remove all elements with data-touchspin-injected attribute\n    if (this.wrapper) {\n      const injected = this.wrapper.querySelectorAll('[data-touchspin-injected]');\n      injected.forEach(el => el.remove());\n\n      // If wrapper itself was injected and is not the original parent\n      if (this.wrapper.hasAttribute('data-touchspin-injected') && this.wrapper.parentElement) {\n        const injectedType = this.wrapper.getAttribute('data-touchspin-injected');\n\n        if (injectedType === 'wrapper-advanced') {\n          // For advanced input groups, just remove the TouchSpin classes and attribute\n          // but keep the original input-group structure intact\n          this.wrapper.classList.remove('bootstrap-touchspin');\n          this.wrapper.removeAttribute('data-touchspin-injected');\n        } else {\n          // For regular wrappers, unwrap the input element\n          const parent = this.wrapper.parentElement;\n          parent.insertBefore(this.input, this.wrapper);\n          this.wrapper.remove();\n        }\n      }\n    }\n\n    // Also find any injected elements that might be siblings or elsewhere\n    const allInjected = document.querySelectorAll('[data-touchspin-injected]');\n    allInjected.forEach(el => {\n      // Only remove if it's related to this input (check if input is descendant or sibling)\n      if (el.contains(this.input) ||\n          (el.parentElement && el.parentElement.contains(this.input)) ||\n          this.input.parentElement?.contains(el)) {\n        // Don't remove the input itself\n        if (el !== this.input) {\n          el.remove();\n        }\n      }\n    });\n  }\n\n  // All legacy jQuery-based methods have been removed\n  // Modern renderers implement their own init() method and use vanilla JS\n\n  /**\n   * Get testid attribute for up button\n   * @returns {string} Testid attribute or empty string\n   */\n  getUpButtonTestId() {\n    const inputTestId = this.input.getAttribute('data-testid');\n    if (inputTestId) return ` data-testid=\"${inputTestId}-up\"`;\n    return '';\n  }\n\n  /**\n   * Get testid attribute for down button\n   * @returns {string} Testid attribute or empty string\n   */\n  getDownButtonTestId() {\n    const inputTestId = this.input.getAttribute('data-testid');\n    if (inputTestId) return ` data-testid=\"${inputTestId}-down\"`;\n    return '';\n  }\n\n  /**\n   * Get testid attribute for prefix element\n   * @returns {string} Testid attribute or empty string\n   */\n  getPrefixTestId() {\n    const inputTestId = this.input.getAttribute('data-testid');\n    if (inputTestId) return ` data-testid=\"${inputTestId}-prefix\"`;\n    return '';\n  }\n\n  /**\n   * Get testid attribute for postfix element\n   * @returns {string} Testid attribute or empty string\n   */\n  getPostfixTestId() {\n    const inputTestId = this.input.getAttribute('data-testid');\n    if (inputTestId) return ` data-testid=\"${inputTestId}-postfix\"`;\n    return '';\n  }\n\n  /**\n   * Finalize wrapper attributes after DOM construction and event attachment.\n   * Sets both data-testid and data-touchspin-injected attributes.\n   * Called by core as the final initialization step.\n   */\n  finalizeWrapperAttributes() {\n    if (this.wrapper) {\n      // Set test ID if input has one and wrapper doesn't already have one\n      const testid = this.input.getAttribute('data-testid');\n      if (testid && !this.wrapper.hasAttribute('data-testid')) {\n        this.wrapper.setAttribute('data-testid', testid + '-wrapper');\n      }\n      \n      // Mark component as ready (DOM built, events attached)\n      this.wrapper.setAttribute('data-touchspin-injected', this.wrapperType);\n    }\n  }\n}\n\nexport default AbstractRenderer;","// jQuery Bootstrap 5 build entry point\nimport { TouchSpin as CoreTouchSpin, TouchSpinCore, getTouchSpin, CORE_EVENTS } from '../../../core/src/index.js';\nimport Bootstrap5Renderer from './Bootstrap5Renderer.js';\n\n// Wrapper function for standalone use (when jQuery is not available)\nfunction TouchSpin(element, options = {}) {\n  if (!(element instanceof Element)) {\n    throw new TypeError('TouchSpin expects an HTMLElement');\n  }\n\n  // Set the baked-in renderer for this build\n  options.renderer = options.renderer || Bootstrap5Renderer;\n\n  // Use the core TouchSpin function which properly handles initDOMEventHandling\n  return CoreTouchSpin(element, options);\n}\n\n// Custom jQuery plugin installer with baked-in Bootstrap5Renderer\nfunction installJqueryTouchSpin($) {\n  $.fn.TouchSpin = function(options, arg) {\n    // Command API - forward to core (core manages instance lifecycle)\n    if (typeof options === 'string') {\n      const cmd = String(options).toLowerCase();\n      let ret;\n      this.each(function() {\n        const inputEl = /** @type {HTMLInputElement} */ (this);\n        const api = getTouchSpin(inputEl);\n\n        // Handle get/getvalue specially - fall back to raw input value if no instance\n        if ((cmd === 'getvalue' || cmd === 'get') && ret === undefined) {\n          if (api) {\n            ret = api.getValue();\n          } else {\n            // No TouchSpin instance - return raw input value\n            ret = inputEl.value;\n          }\n          return; // Skip other commands if no instance\n        }\n\n        if (!api) return; // No instance exists - other commands ignored\n\n        switch (cmd) {\n          case 'destroy': api.destroy(); break; // Core removes instance from element\n          case 'uponce': api.upOnce(); break;\n          case 'downonce': api.downOnce(); break;\n          case 'startupspin': api.startUpSpin(); break;\n          case 'startdownspin': api.startDownSpin(); break;\n          case 'stopspin': api.stopSpin(); break;\n          case 'updatesettings': api.updateSettings(arg || {}); break;\n          case 'setvalue': case 'set': api.setValue(arg); break;\n        }\n      });\n      return ret === undefined ? this : ret;\n    }\n\n    // Initialize - use TouchSpin wrapper with baked-in renderer\n    return this.each(function() {\n      const $input = $(this);\n      const inputEl = /** @type {HTMLInputElement} */ (this);\n\n      // Create TouchSpin instance with baked-in Bootstrap5Renderer\n      const opts = options || {};\n      opts.renderer = opts.renderer || Bootstrap5Renderer;\n      const inst = CoreTouchSpin(inputEl, opts);\n\n      // Bridge core events to jQuery events (minimal event forwarding only)\n      const evMap = {\n        [CORE_EVENTS.MIN]: 'touchspin.on.min',\n        [CORE_EVENTS.MAX]: 'touchspin.on.max',\n        [CORE_EVENTS.START_SPIN]: 'touchspin.on.startspin',\n        [CORE_EVENTS.START_UP]: 'touchspin.on.startupspin',\n        [CORE_EVENTS.START_DOWN]: 'touchspin.on.startdownspin',\n        [CORE_EVENTS.STOP_SPIN]: 'touchspin.on.stopspin',\n        [CORE_EVENTS.STOP_UP]: 'touchspin.on.stopupspin',\n        [CORE_EVENTS.STOP_DOWN]: 'touchspin.on.stopdownspin',\n      };\n\n      // Store unsubscribe functions for cleanup\n      const unsubs = [];\n      Object.keys(evMap).forEach(k => {\n        unsubs.push(inst.on(k, () => $input.trigger(evMap[k])));\n      });\n\n      // Define jQuery teardown function that cleans up jQuery-specific resources\n      const jqueryTeardown = () => {\n        // Clean up event subscriptions to core\n        unsubs.forEach(unsub => {\n          try { unsub(); } catch {\n            // Ignore unsubscribe errors during cleanup\n          }\n        });\n        // Clean up jQuery events\n        $input.off('touchspin.uponce touchspin.downonce touchspin.startupspin touchspin.startdownspin touchspin.stopspin touchspin.updatesettings touchspin.destroy');\n      };\n\n      // Register teardown with core so it's called on core destroy too\n      inst.registerTeardown(jqueryTeardown);\n\n      // Callable events - forward to core (core manages lifecycle)\n      $input.on('touchspin.uponce', () => {\n        const api = getTouchSpin(inputEl);\n        if (api) api.upOnce();\n      });\n      $input.on('touchspin.downonce', () => {\n        const api = getTouchSpin(inputEl);\n        if (api) api.downOnce();\n      });\n      $input.on('touchspin.startupspin', () => {\n        const api = getTouchSpin(inputEl);\n        if (api) api.startUpSpin();\n      });\n      $input.on('touchspin.startdownspin', () => {\n        const api = getTouchSpin(inputEl);\n        if (api) api.startDownSpin();\n      });\n      $input.on('touchspin.stopspin', () => {\n        const api = getTouchSpin(inputEl);\n        if (api) api.stopSpin();\n      });\n      $input.on('touchspin.updatesettings', (e, o) => {\n        const api = getTouchSpin(inputEl);\n        if (api) api.updateSettings(o || {});\n      });\n      $input.on('touchspin.destroy', () => {\n        // Forward destroy to core (core will call registered teardown callbacks)\n        const api = getTouchSpin(inputEl);\n        if (api) api.destroy();\n      });\n    });\n  };\n}\n\n// Install jQuery plugin if jQuery is available\nif (typeof window !== 'undefined' && window.jQuery) {\n  installJqueryTouchSpin(window.jQuery);\n}\n\n// For jQuery builds, ensure globals are properly exposed for direct access\nif (typeof window !== 'undefined') {\n  window.TouchSpin = TouchSpin;\n  window.TouchSpinCore = TouchSpinCore;\n  window.getTouchSpin = getTouchSpin;\n  window.Bootstrap5Renderer = Bootstrap5Renderer;\n  window.installJqueryTouchSpin = installJqueryTouchSpin;\n}\n\n// Export for module systems only (no default export)\nexport { TouchSpin, TouchSpinCore, getTouchSpin, Bootstrap5Renderer, installJqueryTouchSpin };"],"names":["DEFAULTS","min","max","initval","replacementval","firstclickvalueifempty","step","decimals","forcestepdivisibility","stepinterval","stepintervaldelay","verticalbuttons","verticalup","verticaldown","verticalupclass","verticaldownclass","focusablebuttons","prefix","postfix","prefix_extraclass","postfix_extraclass","booster","boostat","maxboostedstep","mousewheel","buttonup_class","buttondown_class","buttonup_txt","buttondown_txt","callback_before_calculation","v","callback_after_calculation","INSTANCE_KEY","TouchSpinCore","inputEl","opts","arguments","length","undefined","_classCallCheck","nodeName","Error","this","input","dataAttrs","_parseDataAttributes","settings","Object","assign","_sanitizeSettings","renderer","globalThis","TouchSpinDefaultRenderer","console","warn","spinning","spincount","direction","_events","Map","_teardownCallbacks","_settingObservers","_spinDelayTimeout","_spinIntervalTimer","_upButton","_downButton","_wrapper","_handleUpMouseDown","bind","_handleDownMouseDown","_handleMouseUp","_handleUpKeyDown","_handleUpKeyUp","_handleDownKeyDown","_handleDownKeyUp","_handleInputChange","_handleInputBlur","_handleKeyDown","_handleKeyUp","_handleWheel","_initializeInput","init","_setupMutationObserver","finalizeWrapperAttributes","_createClass","key","value","_updateAriaAttributes","_syncNativeAttributes","_checkValue","stepNum","Number","isFinite","decNum","Math","floor","minNum","maxNum","tmp","si","sid","parsed","_i","_Object$entries","entries","_Object$entries$_i","_slicedToArray","optionName","attrName","fullAttrName","concat","hasAttribute","rawValue","getAttribute","_coerceAttributeValue","_i2","_arr","nativeAttr","includes","num","parseFloat","isNaN","disabled","getValue","next","_nextValue","emit","stopSpin","_setDisplay","_startSpin","_clearSpinTimers","_this","oldSettings","_objectSpread","newSettings","sanitizedPartial","sanitizePartialSettings","_alignToStep","keys","forEach","observers","get","callback","error","raw","NaN","before","String","adjusted","_applyConstraints","_findDOMElements","_attachDOMEventListeners","_this2","push","index","indexOf","splice","teardown","_detachDOMEventListeners","clear","_mutationObserver","disconnect","upOnce","downOnce","startUpSpin","startDownSpin","updateSettings","setValue","destroy","on","off","initDOMEventHandling","registerTeardown","attachUpEvents","attachDownEvents","observeSetting","element","addEventListener","passive","_updateButtonDisabledState","settingName","has","set","Set","add","delete","event","handler","_this3","size","detail","_i3","_arr2","_toConsumableArray","fn","_unused","dir","_this4","delay","interval","setTimeout","setInterval","_spinStep","clearTimeout","_unused2","clearInterval","_unused3","current","_valueIfIsNaN","base","mbs","stepCandidate","parseInt","pow","round","aligned","_forcestepdivisibility","clamped","boosted","cap","val","out","mode","dec","ceil","toFixed","k","s","V","S","r","mayTriggerChange","_this$input$value","prev","_formatDisplay","dispatchEvent","Event","bubbles","el","setAttribute","removeAttribute","nativeMin","nativeMax","nativeStep","needsUpdate","parsedMin","parsedMax","parsedStep","wrapper","parentElement","document","removeEventListener","e","preventDefault","keyCode","repeat","currentValue","wouldBeSanitized","stopImmediatePropagation","activeElement","deltaY","_this5","MutationObserver","mutations","mutation","type","attributeName","_syncSettingsFromNativeAttributes","observe","attributes","attributeFilter","isDisabled","partial","prototype","hasOwnProperty","call","n","hasMin","hasMax","TouchSpin","core","toPublicApi","getTouchSpin","CORE_EVENTS","freeze","MIN","MAX","START_SPIN","START_UP","START_DOWN","STOP_SPIN","STOP_UP","STOP_DOWN","Bootstrap5Renderer","_AbstractRenderer","_callSuper","_inherits","prefixEl","postfixEl","classList","contains","_formControlAdded","buildAndAttachDOM","newValue","updatePrefix","updatePostfix","updateButtonClass","updateVerticalButtonClass","updateVerticalButtonText","updateButtonText","updatePrefixClasses","updatePostfixClasses","handleVerticalButtonsChange","updateButtonFocusability","remove","existingInputGroup","closest","buildAdvancedInputGroup","buildBasicInputGroup","html","inputGroupSize","_detectInputGroupSize","getPrefixTestId","getPostfixTestId","buildVerticalButtons","getDownButtonTestId","getUpButtonTestId","tempDiv","createElement","innerHTML","trim","firstChild","insertBefore","querySelector","nextSibling","verticalWrapper","upButton","elementsHtml","wrapperType","downButton","className","buildInputGroup","textContent","style","display","rebuildDOM","button","baseClasses","text","removeInjectedElements","buttons","querySelectorAll","tabindex","AbstractRenderer","_this$input$parentEle","inputTestId","testid","options","Element","TypeError","CoreTouchSpin","installJqueryTouchSpin","$","arg","ret","cmd","toLowerCase","each","api","$input","inst","evMap","_defineProperty","unsubs","trigger","unsub","o","window","jQuery"],"mappings":";;;;;;;;2/HAoDA,IAAMA,EAAW,CACfC,IAAK,EACLC,IAAK,IACLC,QAAS,GACTC,eAAgB,GAChBC,uBAAwB,KACxBC,KAAM,EACNC,SAAU,EACVC,sBAAuB,QACvBC,aAAc,IACdC,kBAAmB,IACnBC,iBAAiB,EACjBC,WAAY,IACZC,aAAc,IACdC,gBAAiB,KACjBC,kBAAmB,KACnBC,kBAAkB,EAClBC,OAAQ,GACRC,QAAS,GACTC,kBAAmB,GACnBC,mBAAoB,GACpBC,SAAS,EACTC,QAAS,GACTC,gBAAgB,EAChBC,YAAY,EACZC,eAAgB,KAChBC,iBAAkB,KAClBC,aAAc,IACdC,eAAgB,IAChBC,4BAA6B,SAACC,GAAC,OAAKA,CAAC,EACrCC,2BAA4B,SAACD,GAAC,OAAKA,CAAC,GAGhCE,EAAe,iBAERC,EAAa,WA0DxB,SAAAA,EAAYC,GAAoB,IAAXC,EAAIC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAA,EAC1B,GAD4BG,OAAAN,IACvBC,GAAgC,UAArBA,EAAQM,SACtB,MAAM,IAAIC,MAAM,6CAIlBC,KAAKC,MAAQT,EAGb,IAAMU,EAAYF,KAAKG,qBAAqBX,GAG5CQ,KAAKI,SAAWC,OAAOC,OAAO,CAAA,EAAIhD,EAAU4C,EAAWT,GAEvDO,KAAKO,oBAGAP,KAAKI,SAASI,WAES,oBAAfC,YAA8BA,WAAWC,yBAClDV,KAAKI,SAASI,SAAWC,WAAWC,yBAGpCC,QAAQC,KAAK,+JAKjBZ,KAAKa,UAAW,EAEhBb,KAAKc,UAAY,EAEjBd,KAAKe,WAAY,EAEjBf,KAAKgB,QAAU,IAAIC,IAEnBjB,KAAKkB,mBAAqB,GAE1BlB,KAAKmB,kBAAoB,IAAIF,IAG7BjB,KAAKoB,kBAAoB,KAEzBpB,KAAKqB,mBAAqB,KAG1BrB,KAAKsB,UAAY,KAEjBtB,KAAKuB,YAAc,KAEnBvB,KAAKwB,SAAW,KAGhBxB,KAAKyB,mBAAqBzB,KAAKyB,mBAAmBC,KAAK1B,MACvDA,KAAK2B,qBAAuB3B,KAAK2B,qBAAqBD,KAAK1B,MAC3DA,KAAK4B,eAAiB5B,KAAK4B,eAAeF,KAAK1B,MAC/CA,KAAK6B,iBAAmB7B,KAAK6B,iBAAiBH,KAAK1B,MACnDA,KAAK8B,eAAiB9B,KAAK8B,eAAeJ,KAAK1B,MAC/CA,KAAK+B,mBAAqB/B,KAAK+B,mBAAmBL,KAAK1B,MACvDA,KAAKgC,iBAAmBhC,KAAKgC,iBAAiBN,KAAK1B,MACnDA,KAAKiC,mBAAqBjC,KAAKiC,mBAAmBP,KAAK1B,MACvDA,KAAKkC,iBAAmBlC,KAAKkC,iBAAiBR,KAAK1B,MACnDA,KAAKmC,eAAiBnC,KAAKmC,eAAeT,KAAK1B,MAC/CA,KAAKoC,aAAepC,KAAKoC,aAAaV,KAAK1B,MAC3CA,KAAKqC,aAAerC,KAAKqC,aAAaX,KAAK1B,MAG3CA,KAAKsC,mBAGDtC,KAAKI,SAASI,WAChBR,KAAKQ,SAAW,IAAIR,KAAKI,SAASI,SAAShB,EAASQ,KAAKI,SAAUJ,MACnEA,KAAKQ,SAAS+B,QAIhBvC,KAAKwC,yBAoBDxC,KAAKI,SAASI,UAChBR,KAAKQ,SAASiC,2BAElB,CAEA,OAAAC,EAAAnD,EAAA,CAAA,CAAAoD,IAAA,mBAAAC,MAIA,WAEgC,KAA1B5C,KAAKI,SAAS3C,SAAuC,KAArBuC,KAAKC,MAAM2C,QAC7C5C,KAAKC,MAAM2C,MAAQ5C,KAAKI,SAAS3C,SAInCuC,KAAK6C,wBACL7C,KAAK8C,wBACL9C,KAAK+C,aAAY,EACnB,GAEA,CAAAJ,IAAA,oBAAAC,MAQA,WAEE,IAAMI,EAAUC,OAAOjD,KAAKI,SAASxC,OAChCsF,SAASF,IAAYA,GAAW,EACnChD,KAAKI,SAASxC,KAAO,EAErBoC,KAAKI,SAASxC,KAAOoF,EAIvB,IAAMG,EAASF,OAAOjD,KAAKI,SAASvC,UASpC,IARKqF,SAASC,IAAWA,EAAS,EAChCnD,KAAKI,SAASvC,SAAW,EAEzBmC,KAAKI,SAASvC,SAAWuF,KAAKC,MAAMF,GAKZ,OAAtBnD,KAAKI,SAAS7C,UAAsCqC,IAAtBI,KAAKI,SAAS7C,KAA2C,KAAtByC,KAAKI,SAAS7C,IACjFyC,KAAKI,SAAS7C,IAAM,SACf,CACL,IAAM+F,EAASL,OAAOjD,KAAKI,SAAS7C,KACpCyC,KAAKI,SAAS7C,IAAM2F,SAASI,GAAUA,EAAS,IAClD,CACA,GAA0B,OAAtBtD,KAAKI,SAAS5C,UAAsCoC,IAAtBI,KAAKI,SAAS5C,KAA2C,KAAtBwC,KAAKI,SAAS5C,IACjFwC,KAAKI,SAAS5C,IAAM,SACf,CACL,IAAM+F,EAASN,OAAOjD,KAAKI,SAAS5C,KACpCwC,KAAKI,SAAS5C,IAAM0F,SAASK,GAAUA,EAAS,IAClD,CAGA,GAA0B,OAAtBvD,KAAKI,SAAS7C,KAAsC,OAAtByC,KAAKI,SAAS5C,KAAgBwC,KAAKI,SAAS7C,IAAMyC,KAAKI,SAAS5C,IAAK,CAErG,IAAMgG,EAAMxD,KAAKI,SAAS7C,IAC1ByC,KAAKI,SAAS7C,IAAMyC,KAAKI,SAAS5C,IAClCwC,KAAKI,SAAS5C,IAAMgG,CACtB,CAGA,IAAMC,EAAKR,OAAOjD,KAAKI,SAASrC,gBAC3BmF,SAASO,IAAOA,EAAK,KAAGzD,KAAKI,SAASrC,aAAeT,EAASS,cAGnE,IAAM2F,EAAMT,OAAOjD,KAAKI,SAASpC,qBAC5BkF,SAASQ,IAAQA,EAAM,KAAG1D,KAAKI,SAASpC,kBAAoBV,EAASU,kBAC5E,GAEA,CAAA2E,IAAA,uBAAAC,MAMA,SAAqBpD,GAkCnB,IAjCA,IA8BMmE,EAAS,CAAA,EAGfC,EAAA,EAAAC,EAAqCxD,OAAOyD,QAjCvB,CACnBvG,IAAK,MACLC,IAAK,MACLC,QAAS,WACTC,eAAgB,kBAChBC,uBAAwB,6BACxBC,KAAM,OACNC,SAAU,WACVE,aAAc,gBACdE,gBAAiB,mBACjBC,WAAY,cACZC,aAAc,gBACdC,gBAAiB,oBACjBC,kBAAmB,sBACnBP,sBAAuB,0BACvBE,kBAAmB,sBACnBO,OAAQ,SACRC,QAAS,UACTC,kBAAmB,qBACnBC,mBAAoB,sBACpBC,QAAS,UACTC,QAAS,UACTC,eAAgB,mBAChBC,WAAY,cACZE,iBAAkB,oBAClBD,eAAgB,kBAChBG,eAAgB,kBAChBD,aAAc,kBAMiD2E,EAAAC,EAAAlE,OAAAiE,IAAE,CAA9D,IAAAG,EAAAC,EAAAH,EAAAD,GAAA,GAAOK,EAAUF,EAAA,GAAEG,EAAQH,EAAA,GACxBI,EAAY,YAAAC,OAAeF,GACjC,GAAI1E,EAAQ6E,aAAaF,GAAe,CACtC,IAAMG,EAAW9E,EAAQ+E,aAAaJ,GACtCR,EAAOM,GAAcjE,KAAKwE,sBAAsBP,EAAYK,EAC9D,CACF,CAGA,IAAA,IAAAG,EAAA,EAAAC,EAAyB,CAAC,MAAO,MAAO,QAAOD,EAAAC,EAAA/E,OAAA8E,IAAE,CAA5C,IAAME,EAAUD,EAAAD,GACnB,GAAIjF,EAAQ6E,aAAaM,GAAa,CACpC,IAAML,EAAW9E,EAAQ+E,aAAaI,QACX/E,IAAvB+D,EAAOgB,IACThE,QAAQC,KAAI,kBAAAwD,OAAmBO,EAAU,WAAAP,OAAUO,EAAU,8DAA8DnF,GAE7HmE,EAAOgB,GAAc3E,KAAKwE,sBAAsBG,EAAYL,EAC9D,CACF,CAEA,OAAOX,CACT,GAEA,CAAAhB,IAAA,wBAAAC,MAOA,SAAsBqB,EAAYK,GAChC,GAAIA,QACF,OAAOA,EAIT,GAAI,CAAC,UAAW,aAAc,mBAAmBM,SAASX,GACxD,MAAoB,SAAbK,GAAoC,KAAbA,GAAmBA,IAAaL,EAIhE,GAAI,CAAC,MAAO,MAAO,OAAQ,WAAY,eAAgB,oBAClD,UAAW,iBAAkB,0BAA0BW,SAASX,GAAa,CAChF,IAAMY,EAAMC,WAAWR,GACvB,OAAOS,MAAMF,GAAOP,EAAWO,CACjC,CAGA,OAAOP,CACT,GAEA,CAAA3B,IAAA,SAAAC,MACA,WACE,IAAI5C,KAAKC,MAAM+E,WAAYhF,KAAKC,MAAMoE,aAAa,YAAnD,CAIA,IAAMjF,EAAIY,KAAKiF,WACTC,EAAOlF,KAAKmF,WAAW,KAAM/F,GAGnC,GAA0B,OAAtBY,KAAKI,SAAS5C,KAAgB4B,IAAMY,KAAKI,SAAS5C,IAKpD,OAJAwC,KAAKoF,KAAK,YACNpF,KAAKa,UAA+B,OAAnBb,KAAKe,WACxBf,KAAKqF,YAMiB,OAAtBrF,KAAKI,SAAS5C,KAAgB0H,IAASlF,KAAKI,SAAS5C,MACvDwC,KAAKoF,KAAK,OACNpF,KAAKa,UAA+B,OAAnBb,KAAKe,WACxBf,KAAKqF,YAITrF,KAAKsF,YAAYJ,GAAM,EAtBvB,CAuBF,GAEA,CAAAvC,IAAA,WAAAC,MACA,WACE,IAAI5C,KAAKC,MAAM+E,WAAYhF,KAAKC,MAAMoE,aAAa,YAAnD,CAIA,IAAMjF,EAAIY,KAAKiF,WACTC,EAAOlF,KAAKmF,WAAW,OAAQ/F,GAGrC,GAA0B,OAAtBY,KAAKI,SAAS7C,KAAgB6B,IAAMY,KAAKI,SAAS7C,IAKpD,OAJAyC,KAAKoF,KAAK,YACNpF,KAAKa,UAA+B,SAAnBb,KAAKe,WACxBf,KAAKqF,YAMiB,OAAtBrF,KAAKI,SAAS7C,KAAgB2H,IAASlF,KAAKI,SAAS7C,MACvDyC,KAAKoF,KAAK,OACNpF,KAAKa,UAA+B,SAAnBb,KAAKe,WACxBf,KAAKqF,YAITrF,KAAKsF,YAAYJ,GAAM,EAtBvB,CAuBF,GAEA,CAAAvC,IAAA,cAAAC,MACA,WACE5C,KAAKuF,WAAW,KAClB,GAEA,CAAA5C,IAAA,gBAAAC,MACA,WACE5C,KAAKuF,WAAW,OAClB,GAEA,CAAA5C,IAAA,WAAAC,MACA,WACE5C,KAAKwF,mBACDxF,KAAKa,WACgB,OAAnBb,KAAKe,WACPf,KAAKoF,KAAK,cACVpF,KAAKoF,KAAK,aACkB,SAAnBpF,KAAKe,YACdf,KAAKoF,KAAK,gBACVpF,KAAKoF,KAAK,cAGdpF,KAAKa,UAAW,EAChBb,KAAKe,WAAY,EACjBf,KAAKc,UAAY,CACnB,GAEA,CAAA6B,IAAA,iBAAAC,MAGA,SAAenD,GAAM,IAAAgG,EAAAzF,KACb0F,EAAWC,KAAQ3F,KAAKI,UACxBwF,EAAcnG,GAAQ,CAAA,EAGtBoG,EAAmBtG,EAAcuG,wBAAwBF,EAAaF,GAG5ErF,OAAOC,OAAON,KAAKI,SAAUyF,GAE7B7F,KAAKO,oBAGL,IAAM3C,EAAOqF,OAAOjD,KAAKI,SAASxC,MAAQ,QACXgC,IAA1BiG,EAAiBjI,WAA+CgC,IAAzBiG,EAAiBtI,UAA8CqC,IAAzBiG,EAAiBrI,KAA+B,IAATI,IAC7F,OAAtBoC,KAAKI,SAAS5C,MAChBwC,KAAKI,SAAS5C,IAAMwC,KAAK+F,aAAa9C,OAAOjD,KAAKI,SAAS5C,KAAMI,EAAM,SAE/C,OAAtBoC,KAAKI,SAAS7C,MAChByC,KAAKI,SAAS7C,IAAMyC,KAAK+F,aAAa9C,OAAOjD,KAAKI,SAAS7C,KAAMK,EAAM,QAK3EyC,OAAO2F,KAAKhG,KAAKI,UAAU6F,QAAQ,SAAAtD,GACjC,GAAI+C,EAAY/C,KAAS8C,EAAKrF,SAASuC,GAAM,CAC3C,IAAMuD,EAAYT,EAAKtE,kBAAkBgF,IAAIxD,GACzCuD,GACFA,EAAUD,QAAQ,SAAAG,GAChB,IACEA,EAASX,EAAKrF,SAASuC,GAAM+C,EAAY/C,GAC3C,CAAE,MAAO0D,GACP1F,QAAQ0F,MAAM,iDAAkDA,EAClE,CACF,EAEJ,CACF,GAGArG,KAAK6C,wBACL7C,KAAK8C,wBACL9C,KAAK+C,aAAY,EACnB,GAEA,CAAAJ,IAAA,WAAAC,MACA,WACE,IAAI0D,EAAMtG,KAAKC,MAAM2C,MAIrB,GAHY,KAAR0D,GAA+C,KAAjCtG,KAAKI,SAAS1C,iBAC9B4I,EAAMtG,KAAKI,SAAS1C,gBAEV,KAAR4I,EAAY,OAAOC,IACvB,IAAMC,EAASxG,KAAKI,SAASjB,6BAAgC,SAACC,GAAC,OAAKA,CAAC,EAC/DyF,EAAMC,WAAW0B,EAAOC,OAAOH,KACrC,OAAOvB,MAAMF,GAAO0B,IAAM1B,CAC5B,GAEA,CAAAlC,IAAA,WAAAC,MAGA,SAASxD,GACP,IAAIY,KAAKC,MAAM+E,WAAYhF,KAAKC,MAAMoE,aAAa,YAAnD,CACA,IAAMV,EAASV,OAAO7D,GACtB,GAAK8D,SAASS,GAAd,CACA,IAAM+C,EAAW1G,KAAK2G,kBAAkBhD,GACxC3D,KAAKsF,YAAYoB,GAAU,EAFJ,CAFyC,CAKlE,GAEA,CAAA/D,IAAA,uBAAAC,MAIA,WAEE5C,KAAK4G,mBACL5G,KAAK6G,0BACP,GAEA,CAAAlE,IAAA,mBAAAC,MAMA,SAAiBwD,GAAU,IAAAU,EAAA9G,KACzB,GAAwB,mBAAboG,EACT,MAAM,IAAIrG,MAAM,wCAKlB,OAHAC,KAAKkB,mBAAmB6F,KAAKX,GAGtB,WACL,IAAMY,EAAQF,EAAK5F,mBAAmB+F,QAAQb,GAC1CY,GAAQ,GACVF,EAAK5F,mBAAmBgG,OAAOF,EAAO,EAE1C,CACF,GAEA,CAAArE,IAAA,UAAAC,MACA,WACE5C,KAAKqF,WAGDrF,KAAKQ,UAAYR,KAAKQ,SAAS2G,UACjCnH,KAAKQ,SAAS2G,WAIhBnH,KAAKoH,2BAGLpH,KAAKkB,mBAAmB+E,QAAQ,SAAAG,GAC9B,IACEA,GACF,CAAE,MAAOC,GACP1F,QAAQ0F,MAAM,qCAAsCA,EACtD,CACF,GACArG,KAAKkB,mBAAmBvB,OAAS,EAGjCK,KAAKmB,kBAAkBkG,QAGnBrH,KAAKsH,oBACPtH,KAAKsH,kBAAkBC,aACvBvH,KAAKsH,kBAAoB,MAI3BtH,KAAKsB,UAAY,KACjBtB,KAAKuB,YAAc,KAGfvB,KAAKC,MAAMX,KAAkBU,aACxBA,KAAKC,MAAMX,EAEtB,GAEA,CAAAqD,IAAA,cAAAC,MAIA,WACE,MAAO,CACL4E,OAAQxH,KAAKwH,OAAO9F,KAAK1B,MACzByH,SAAUzH,KAAKyH,SAAS/F,KAAK1B,MAC7B0H,YAAa1H,KAAK0H,YAAYhG,KAAK1B,MACnC2H,cAAe3H,KAAK2H,cAAcjG,KAAK1B,MACvCqF,SAAUrF,KAAKqF,SAAS3D,KAAK1B,MAC7B4H,eAAgB5H,KAAK4H,eAAelG,KAAK1B,MACzCiF,SAAUjF,KAAKiF,SAASvD,KAAK1B,MAC7B6H,SAAU7H,KAAK6H,SAASnG,KAAK1B,MAC7B8H,QAAS9H,KAAK8H,QAAQpG,KAAK1B,MAC3B+H,GAAI/H,KAAK+H,GAAGrG,KAAK1B,MACjBgI,IAAKhI,KAAKgI,IAAItG,KAAK1B,MACnBiI,qBAAsBjI,KAAKiI,qBAAqBvG,KAAK1B,MACrDkI,iBAAkBlI,KAAKkI,iBAAiBxG,KAAK1B,MAC7CmI,eAAgBnI,KAAKmI,eAAezG,KAAK1B,MACzCoI,iBAAkBpI,KAAKoI,iBAAiB1G,KAAK1B,MAC7CqI,eAAgBrI,KAAKqI,eAAe3G,KAAK1B,MAE7C,GAGA,CAAA2C,IAAA,iBAAAC,MAKA,SAAe0F,GACRA,GAKLtI,KAAKsB,UAAYgH,EACjBA,EAAQC,iBAAiB,YAAavI,KAAKyB,oBAC3C6G,EAAQC,iBAAiB,aAAcvI,KAAKyB,mBAAoB,CAAC+G,SAAS,IAGtExI,KAAKI,SAAS9B,mBAChBgK,EAAQC,iBAAiB,UAAWvI,KAAK6B,kBACzCyG,EAAQC,iBAAiB,QAASvI,KAAK8B,iBAIzC9B,KAAKyI,8BAfH9H,QAAQC,KAAK,qDAgBjB,GAEA,CAAA+B,IAAA,mBAAAC,MAKA,SAAiB0F,GACVA,GAKLtI,KAAKuB,YAAc+G,EACnBA,EAAQC,iBAAiB,YAAavI,KAAK2B,sBAC3C2G,EAAQC,iBAAiB,aAAcvI,KAAK2B,qBAAsB,CAAC6G,SAAS,IAGxExI,KAAKI,SAAS9B,mBAChBgK,EAAQC,iBAAiB,UAAWvI,KAAK+B,oBACzCuG,EAAQC,iBAAiB,QAASvI,KAAKgC,mBAIzChC,KAAKyI,8BAfH9H,QAAQC,KAAK,uDAgBjB,GAGA,CAAA+B,IAAA,iBAAAC,MAMA,SAAe8F,EAAatC,GACrBpG,KAAKmB,kBAAkBwH,IAAID,IAC9B1I,KAAKmB,kBAAkByH,IAAIF,EAAa,IAAIG,KAG9C,IAAM3C,EAAYlG,KAAKmB,kBAAkBgF,IAAIuC,GAI7C,OAHAxC,EAAU4C,IAAI1C,GAGP,WAAA,OAAMF,EAAU6C,OAAO3C,EAAS,CACzC,GAGA,CAAAzD,IAAA,KAAAC,MAMA,SAAGoG,EAAOC,GAAS,IAAAC,EAAAlJ,KACX4I,EAAM5I,KAAKgB,QAAQmF,IAAI6C,IAAU,IAAIH,IAG3C,OAFAD,EAAIE,IAAIG,GACRjJ,KAAKgB,QAAQ4H,IAAII,EAAOJ,GACjB,WAAA,OAAMM,EAAKlB,IAAIgB,EAAOC,EAAQ,CACvC,GAEA,CAAAtG,IAAA,MAAAC,MAKA,SAAIoG,EAAOC,GACT,IAAML,EAAM5I,KAAKgB,QAAQmF,IAAI6C,GACxBJ,IACAK,GAILL,EAAIG,OAAOE,GACM,IAAbL,EAAIO,MAAYnJ,KAAKgB,QAAQ+H,OAAOC,IAJtChJ,KAAKgB,QAAQ+H,OAAOC,GAKxB,GAEA,CAAArG,IAAA,OAAAC,MAKA,SAAKoG,EAAOI,GACV,IAAMR,EAAM5I,KAAKgB,QAAQmF,IAAI6C,GAC7B,GAAKJ,GAAoB,IAAbA,EAAIO,KAChB,IAAA,IAAAE,EAAA,EAAAC,EAAAC,EAAqBX,GAAGS,EAAAC,EAAA3J,OAAA0J,IAAG,CAAtB,IAAMG,EAAEF,EAAAD,GACX,IAAMG,EAAGJ,EAAS,CAAE,MAAAK,GAClB,CAEJ,CACF,GAEA,CAAA9G,IAAA,aAAAC,MAIA,SAAW8G,GAAK,IAAAC,EAAA3J,KACd,KAAIA,KAAKC,MAAM+E,UAAYhF,KAAKC,MAAMoE,aAAa,aAG/CrE,KAAKa,UAAYb,KAAKe,YAAc2I,GAAxC,CAII1J,KAAKa,UAAYb,KAAKe,YAAc2I,GACtC1J,KAAKqF,WAIK,OAARqE,EAAc1J,KAAKwH,SAAexH,KAAKyH,WAG3C,IAAMrI,EAAIY,KAAKiF,WACf,KAAY,OAARyE,GAAsC,OAAtB1J,KAAKI,SAAS5C,KAAgB4B,IAAMY,KAAKI,SAAS5C,KAG1D,SAARkM,GAAwC,OAAtB1J,KAAKI,SAAS7C,KAAgB6B,IAAMY,KAAKI,SAAS7C,KAAxE,GAK4ByC,KAAKa,UAAYb,KAAKe,YAAc2I,KAE9D1J,KAAKa,UAAW,EAChBb,KAAKe,UAAY2I,EACjB1J,KAAKc,UAAY,EAEjBd,KAAKoF,KAAK,aACE,OAARsE,EAAc1J,KAAKoF,KAAK,eAAqBpF,KAAKoF,KAAK,kBAI7DpF,KAAKwF,mBAEL,IAAMoE,EAAQ5J,KAAKI,SAASpC,mBAAqB,IAC3C6L,EAAW7J,KAAKI,SAASrC,cAAgB,IAC/CiC,KAAKoB,kBAAoB0I,WAAW,WAClCH,EAAKvI,kBAAoB,KACzBuI,EAAKtI,mBAAqB0I,YAAY,WAC/BJ,EAAK9I,UAAY8I,EAAK5I,YAAc2I,GACzCC,EAAKK,UAAUN,EACjB,EAAGG,EACL,EAAGD,EAxBH,CAhBA,CAyCF,GAAC,CAAAjH,IAAA,mBAAAC,MAED,WACE,IAAU5C,KAAKoB,mBAAqB6I,aAAajK,KAAKoB,kBAAsB,CAAE,MAAA8I,GAC5E,CAEF,IAAUlK,KAAKqB,oBAAsB8I,cAAcnK,KAAKqB,mBAAuB,CAAE,MAAA+I,GAC/E,CAEFpK,KAAKoB,kBAAoB,KACzBpB,KAAKqB,mBAAqB,IAC5B,GAEA,CAAAsB,IAAA,aAAAC,MAKA,SAAW8G,EAAKW,GACd,IAAIjL,EAAIiL,EACR,GAAItF,MAAM3F,GACRA,EAAIY,KAAKsK,oBACJ,CACL,IAAMC,EAAOvK,KAAKI,SAASxC,MAAQ,EAC7B4M,EAAMxK,KAAKI,SAASvB,eACtB4L,EAAgBF,EAEpB,GAAIvK,KAAKI,SAASzB,QAAS,CACzB,IAAMC,EAAUwE,KAAK5F,IAAI,EAAGkN,SAASjE,OAAOzG,KAAKI,SAASxB,SAAW,IAAK,KAC1E6L,EAAgBrH,KAAKuH,IAAI,EAAGvH,KAAKC,MAAMrD,KAAKc,UAAYlC,IAAY2L,CACtE,CACA,IAAI3M,EAAO6M,EACPD,GAAOtH,SAASsH,IAAQC,EAAgBxH,OAAOuH,KACjD5M,EAAOqF,OAAOuH,GAEdpL,EAAIgE,KAAKwH,MAAMxL,EAAIxB,GAAQA,GAE7BA,EAAOwF,KAAK5F,IAAI+M,EAAM3M,GACtBwB,EAAY,OAARsK,EAAetK,EAAIxB,EAAOwB,EAAIxB,CACpC,CACA,OAAOoC,KAAK2G,kBAAkBvH,EAChC,GAEA,CAAAuD,IAAA,gBAAAC,MACA,WACE,GAAoD,iBAAzC5C,KAAKI,SAASzC,uBACvB,OAAOqC,KAAKI,SAASzC,uBAEvB,IAAMJ,EAAoC,iBAAtByC,KAAKI,SAAS7C,IAAoByC,KAAKI,SAAS7C,IAAM,EAE1E,OAAQA,GADkC,iBAAtByC,KAAKI,SAAS5C,IAAoBwC,KAAKI,SAAS5C,IAAMD,IACrD,CACvB,GAEA,CAAAoF,IAAA,oBAAAC,MACA,SAAkBxD,GAChB,IAAMyL,EAAU7K,KAAK8K,uBAAuB1L,GACtC7B,EAAMyC,KAAKI,SAAS7C,IACpBC,EAAMwC,KAAKI,SAAS5C,IACtBuN,EAAUF,EAGd,OAFY,OAARtN,GAAgBwN,EAAUxN,IAAKwN,EAAUxN,GACjC,OAARC,GAAgBuN,EAAUvN,IAAKuN,EAAUvN,GACtCuN,CACT,GAEA,CAAApI,IAAA,kBAAAC,MACA,WACE,IAAM2H,EAAOvK,KAAKI,SAASxC,MAAQ,EACnC,IAAKoC,KAAKI,SAASzB,QAAS,OAAO4L,EACnC,IAAM3L,EAAUwE,KAAK5F,IAAI,EAAGkN,SAASjE,OAAOzG,KAAKI,SAASxB,SAAW,IAAK,KACtEoM,EAAU5H,KAAKuH,IAAI,EAAGvH,KAAKC,MAAMrD,KAAKc,UAAYlC,IAAY2L,EAC5DC,EAAMxK,KAAKI,SAASvB,eAC1B,GAAI2L,GAAOtH,SAASsH,GAAM,CACxB,IAAMS,EAAMhI,OAAOuH,GACfQ,EAAUC,IAAKD,EAAUC,EAC/B,CACA,OAAO7H,KAAK5F,IAAI+M,EAAMS,EACxB,GAEA,CAAArI,IAAA,yBAAAC,MACA,SAAuBsI,GACrB,IAGIC,EAHEC,EAAOpL,KAAKI,SAAStC,uBAAyB,QAC9CF,EAAOoC,KAAKI,SAASxC,MAAQ,EAC7ByN,EAAMrL,KAAKI,SAASvC,UAAY,EAEtC,OAAQuN,GACN,IAAK,QACHD,EAAM/H,KAAKC,MAAM6H,EAAMtN,GAAQA,EAAM,MACvC,IAAK,OACHuN,EAAM/H,KAAKkI,KAAKJ,EAAMtN,GAAQA,EAAM,MACtC,IAAK,OACHuN,EAAMD,EAAK,MAEb,QACEC,EAAM/H,KAAKwH,MAAMM,EAAMtN,GAAQA,EAGnC,OAAOqF,OAAOkI,EAAII,QAAQF,GAC5B,GAEA,CAAA1I,IAAA,eAAAC,MACA,SAAasI,EAAKtN,EAAM8L,GACtB,GAAa,IAAT9L,EAAY,OAAOsN,EAGvB,IAFA,IAAIM,EAAI,EACFC,EAAI7N,EACD6N,EAAID,EAAK,GAAO,GAAKA,EAAI,KAAKA,GAAK,GAC5C,IAAME,EAAItI,KAAKwH,MAAMM,EAAMM,GACrBG,EAAIvI,KAAKwH,MAAMhN,EAAO4N,GACtBI,EAAIF,EAAIC,EACd,OAAU,IAANC,EAAgBV,GACJ,SAARxB,EAAkBgC,EAAIE,EAAMF,GAAKC,EAAIC,IAAOJ,CACtD,GAEA,CAAA7I,IAAA,cAAAC,MACA,SAAYiC,EAAKgH,GAAkB,IAAAC,EAC3BC,EAAOtF,OAAuB,QAAjBqF,EAAC9L,KAAKC,MAAM2C,iBAAKkJ,EAAAA,EAAI,IAClC5G,EAAOlF,KAAKgM,eAAenH,GAOjC,OANA7E,KAAKC,MAAM2C,MAAQsC,EACnBlF,KAAK6C,wBACDgJ,GAAoBE,IAAS7G,GAE/BlF,KAAKC,MAAMgM,cAAc,IAAIC,MAAM,SAAU,CAAEC,SAAS,KAEnDjH,CACT,GAAC,CAAAvC,IAAA,iBAAAC,MAED,SAAeiC,GACb,IAAMwG,EAAMrL,KAAKI,SAASvC,UAAY,EAGtC,OAFcmC,KAAKI,SAASf,4BAA+B,SAACD,GAAC,OAAKA,CAAC,GACzD6D,OAAO4B,GAAK0G,QAAQF,GAEhC,GAEA,CAAA1I,IAAA,YAAAC,MAIA,SAAU8G,GACR1J,KAAKc,YACO,OAAR4I,EAAc1J,KAAKwH,SAAexH,KAAKyH,UAC7C,GAEA,CAAA9E,IAAA,cAAAC,MACA,SAAYiJ,GACV,IAAMzM,EAAIY,KAAKiF,WACf,GAAK/B,SAAS9D,GAAd,CACA,IAAMsH,EAAW1G,KAAK2G,kBAAkBvH,GACxCY,KAAKsF,YAAYoB,IAAYmF,EAFX,CAGpB,GAAC,CAAAlJ,IAAA,wBAAAC,MAED,WACE,IAAMwJ,EAAKpM,KAAKC,MACgB,eAA5BmM,EAAG7H,aAAa,SAClB6H,EAAGC,aAAa,OAAQ,cAE1B,IAAM9O,EAAMyC,KAAKI,SAAS7C,IACpBC,EAAMwC,KAAKI,SAAS5C,IACd,OAARD,EAAc6O,EAAGC,aAAa,gBAAiB5F,OAAOlJ,IAAY6O,EAAGE,gBAAgB,iBAC7E,OAAR9O,EAAc4O,EAAGC,aAAa,gBAAiB5F,OAAOjJ,IAAY4O,EAAGE,gBAAgB,iBACzF,IAAMhG,EAAM8F,EAAGxJ,MACT4D,EAASxG,KAAKI,SAASjB,6BAAgC,SAACC,GAAC,OAAKA,CAAC,EAC/DyF,EAAMC,WAAW0B,EAAOC,OAAOH,KACjCpD,SAAS2B,GAAMuH,EAAGC,aAAa,gBAAiB5F,OAAO5B,IAAYuH,EAAGE,gBAAgB,iBAC1FF,EAAGC,aAAa,iBAAkB5F,OAAOH,GAC3C,GAEA,CAAA3D,IAAA,wBAAAC,MAKA,WAE0C,WAApC5C,KAAKC,MAAMsE,aAAa,UAEA,OAAtBvE,KAAKI,SAAS7C,KAAgB2F,SAASlD,KAAKI,SAAS7C,KACvDyC,KAAKC,MAAMoM,aAAa,MAAO5F,OAAOzG,KAAKI,SAAS7C,MAEpDyC,KAAKC,MAAMqM,gBAAgB,OAIH,OAAtBtM,KAAKI,SAAS5C,KAAgB0F,SAASlD,KAAKI,SAAS5C,KACvDwC,KAAKC,MAAMoM,aAAa,MAAO5F,OAAOzG,KAAKI,SAAS5C,MAEpDwC,KAAKC,MAAMqM,gBAAgB,OAIF,OAAvBtM,KAAKI,SAASxC,MAAiBsF,SAASlD,KAAKI,SAASxC,OAASoC,KAAKI,SAASxC,KAAO,EACtFoC,KAAKC,MAAMoM,aAAa,OAAQ5F,OAAOzG,KAAKI,SAASxC,OAErDoC,KAAKC,MAAMqM,gBAAgB,QAGjC,GAEA,CAAA3J,IAAA,oCAAAC,MAKA,WACE,IAAM2J,EAAYvM,KAAKC,MAAMsE,aAAa,OACpCiI,EAAYxM,KAAKC,MAAMsE,aAAa,OACpCkI,EAAazM,KAAKC,MAAMsE,aAAa,QACvCmI,GAAc,EACZ9G,EAAc,CAAA,EAGpB,GAAkB,OAAd2G,EAAoB,CACtB,IAAMI,EAA0B,KAAdJ,EAAmB,KAAOzH,WAAWyH,GACjDjJ,EAAuB,OAAdqJ,GAAsBzJ,SAASyJ,GAAaA,EAAY,KACnErJ,IAAWtD,KAAKI,SAAS7C,MAC3BqI,EAAYrI,IAAM+F,EAClBoJ,GAAc,EAElB,MAAiC,OAAtB1M,KAAKI,SAAS7C,MAEvBqI,EAAYrI,IAAM,KAClBmP,GAAc,GAIhB,GAAkB,OAAdF,EAAoB,CACtB,IAAMI,EAA0B,KAAdJ,EAAmB,KAAO1H,WAAW0H,GACjDjJ,EAAuB,OAAdqJ,GAAsB1J,SAAS0J,GAAaA,EAAY,KACnErJ,IAAWvD,KAAKI,SAAS5C,MAC3BoI,EAAYpI,IAAM+F,EAClBmJ,GAAc,EAElB,MAAiC,OAAtB1M,KAAKI,SAAS5C,MAEvBoI,EAAYpI,IAAM,KAClBkP,GAAc,GAIhB,GAAmB,OAAfD,EAAqB,CACvB,IAAMI,EAA4B,KAAfJ,EAAoB,KAAO3H,WAAW2H,GACnDzJ,EAAyB,OAAf6J,GAAuB3J,SAAS2J,IAAeA,EAAa,EAAIA,EAAa,KACzF7J,IAAYhD,KAAKI,SAASxC,OAC5BgI,EAAYhI,KAAOoF,EACnB0J,GAAc,EAElB,MAAkC,IAAvB1M,KAAKI,SAASxC,OAEvBgI,EAAYhI,KAAO,EACnB8O,GAAc,GAIZA,GACF1M,KAAK4H,eAAehC,EAExB,GAIA,CAAAjD,IAAA,mBAAAC,MAIA,WAIE,IADA,IAAIkK,EAAU9M,KAAKC,MAAM8M,cAClBD,IAAYA,EAAQzI,aAAa,4BACtCyI,EAAUA,EAAQC,cAEpB/M,KAAKwB,SAAWsL,CAClB,GAEA,CAAAnK,IAAA,2BAAAC,MAIA,WAIEoK,SAASzE,iBAAiB,UAAWvI,KAAK4B,gBAC1CoL,SAASzE,iBAAiB,aAAcvI,KAAK4B,gBAC7CoL,SAASzE,iBAAiB,WAAYvI,KAAK4B,gBAG3C5B,KAAKC,MAAMsI,iBAAiB,SAAUvI,KAAKiC,oBAAoB,GAC/DjC,KAAKC,MAAMsI,iBAAiB,OAAQvI,KAAKkC,kBACzClC,KAAKC,MAAMsI,iBAAiB,UAAWvI,KAAKmC,gBAC5CnC,KAAKC,MAAMsI,iBAAiB,QAASvI,KAAKoC,cAC1CpC,KAAKC,MAAMsI,iBAAiB,QAASvI,KAAKqC,aAC5C,GAEA,CAAAM,IAAA,2BAAAC,MAIA,WAIEoK,SAASC,oBAAoB,UAAWjN,KAAK4B,gBAC7CoL,SAASC,oBAAoB,aAAcjN,KAAK4B,gBAChDoL,SAASC,oBAAoB,WAAYjN,KAAK4B,gBAG9C5B,KAAKC,MAAMgN,oBAAoB,SAAUjN,KAAKiC,oBAAoB,GAClEjC,KAAKC,MAAMgN,oBAAoB,OAAQjN,KAAKkC,kBAC5ClC,KAAKC,MAAMgN,oBAAoB,UAAWjN,KAAKmC,gBAC/CnC,KAAKC,MAAMgN,oBAAoB,QAASjN,KAAKoC,cAC7CpC,KAAKC,MAAMgN,oBAAoB,QAASjN,KAAKqC,aAC/C,GAIA,CAAAM,IAAA,qBAAAC,MAIA,SAAmBsK,GACjBA,EAAEC,iBACFnN,KAAK0H,aACP,GAEA,CAAA/E,IAAA,uBAAAC,MAIA,SAAqBsK,GACnBA,EAAEC,iBACFnN,KAAK2H,eACP,GAEA,CAAAhF,IAAA,iBAAAC,MAIA,SAAesK,GACblN,KAAKqF,UACP,GAEA,CAAA1C,IAAA,mBAAAC,MAIA,SAAiBsK,GAEf,GAAkB,KAAdA,EAAEE,SAAgC,KAAdF,EAAEE,QAAgB,CAGxC,GAFAF,EAAEC,iBAEED,EAAEG,OAAQ,OACdrN,KAAK0H,aACP,CACF,GAEA,CAAA/E,IAAA,iBAAAC,MAIA,SAAesK,GAEK,KAAdA,EAAEE,SAAgC,KAAdF,EAAEE,SACxBpN,KAAKqF,UAET,GAEA,CAAA1C,IAAA,qBAAAC,MAIA,SAAmBsK,GAEjB,GAAkB,KAAdA,EAAEE,SAAgC,KAAdF,EAAEE,QAAgB,CAGxC,GAFAF,EAAEC,iBAEED,EAAEG,OAAQ,OACdrN,KAAK2H,eACP,CACF,GAEA,CAAAhF,IAAA,mBAAAC,MAIA,SAAiBsK,GAEG,KAAdA,EAAEE,SAAgC,KAAdF,EAAEE,SACxBpN,KAAKqF,UAET,GAEA,CAAA1C,IAAA,qBAAAC,MAIA,SAAmBsK,GACjB,IAAMI,EAAetN,KAAKiF,WACpBsI,EAAmBvN,KAAK2G,kBAAkB2G,GAE5CpK,SAASoK,IAAiBA,IAAiBC,GAE7CL,EAAEM,0BAIN,GAEA,CAAA7K,IAAA,mBAAAC,MAIA,SAAiBsK,GACflN,KAAK+C,aAAY,EACnB,GAEA,CAAAJ,IAAA,iBAAAC,MAIA,SAAesK,GACb,OAAQA,EAAEvK,KACR,IAAK,UAEH,GADAuK,EAAEC,iBACED,EAAEG,OAAQ,OACdrN,KAAK0H,cACL,MACF,IAAK,YAEH,GADAwF,EAAEC,iBACED,EAAEG,OAAQ,OACdrN,KAAK2H,gBACL,MACF,IAAK,QACH3H,KAAK+C,aAAY,GAGvB,GAEA,CAAAJ,IAAA,eAAAC,MAIA,SAAasK,GACG,YAAVA,EAAEvK,KAA+B,cAAVuK,EAAEvK,KAC3B3C,KAAKqF,UAET,GAEA,CAAA1C,IAAA,eAAAC,MAIA,SAAasK,GACNlN,KAAKI,SAAStB,YAIfkO,SAASS,gBAAkBzN,KAAKC,QAClCiN,EAAEC,iBACED,EAAEQ,OAAS,EACb1N,KAAKwH,SACI0F,EAAEQ,OAAS,GACpB1N,KAAKyH,WAGX,GAEA,CAAA9E,IAAA,yBAAAC,MAIA,WAAyB,IAAA+K,EAAA3N,KACS,oBAArB4N,mBACT5N,KAAKsH,kBAAoB,IAAIsG,iBAAiB,SAACC,GAC7CA,EAAU5H,QAAQ,SAAC6H,GACK,eAAlBA,EAASC,OACoB,aAA3BD,EAASE,eAA2D,aAA3BF,EAASE,cACpDL,EAAKlF,6BAC+B,QAA3BqF,EAASE,eAAsD,QAA3BF,EAASE,eAAsD,SAA3BF,EAASE,eAC1FL,EAAKM,oCAGX,EACF,GAEAjO,KAAKsH,kBAAkB4G,QAAQlO,KAAKC,MAAO,CACzCkO,YAAY,EACZC,gBAAiB,CAAC,WAAY,WAAY,MAAO,MAAO,UAG9D,GAEA,CAAAzL,IAAA,6BAAAC,MAIA,WACE,IAAMyL,EAAarO,KAAKC,MAAM+E,UAAYhF,KAAKC,MAAMoE,aAAa,YAE9DrE,KAAKsB,YACPtB,KAAKsB,UAAU0D,SAAWqJ,GAExBrO,KAAKuB,cACPvB,KAAKuB,YAAYyD,SAAWqJ,GAG1BA,GACFrO,KAAKqF,UAET,IAAC,CAAA,CAAA1C,IAAA,0BAAAC,MAxtCD,SAA+B0L,EAASjE,GACtC,IAAMc,EAAGxF,EAAA,CAAA,EAAQ2I,GAEjB,GAAIjO,OAAOkO,UAAUC,eAAeC,KAAKH,EAAS,QAAS,CACzD,IAAMI,EAAIzL,OAAOqL,EAAQ1Q,MACzBuN,EAAIvN,KAAQsF,SAASwL,IAAMA,EAAI,EAAKA,EAAI,CAC1C,CAEA,GAAIrO,OAAOkO,UAAUC,eAAeC,KAAKH,EAAS,YAAa,CAC7D,IAAMI,EAAIzL,OAAOqL,EAAQzQ,UACzBsN,EAAItN,SAAYqF,SAASwL,IAAMA,GAAK,EAAKtL,KAAKC,MAAMqL,GAAK,CAC3D,CAEA,IAAMC,EAAStO,OAAOkO,UAAUC,eAAeC,KAAKH,EAAS,OACvDM,EAASvO,OAAOkO,UAAUC,eAAeC,KAAKH,EAAS,OAC7D,GAAIK,EACF,GAAoB,OAAhBL,EAAQ/Q,UAAgCqC,IAAhB0O,EAAQ/Q,KAAqC,KAAhB+Q,EAAQ/Q,IAC/D4N,EAAI5N,IAAM,SACL,CACL,IAAMmR,EAAIzL,OAAOqL,EAAQ/Q,KACzB4N,EAAI5N,IAAM2F,SAASwL,GAAKA,EAAI,IAC9B,CAEF,GAAIE,EACF,GAAoB,OAAhBN,EAAQ9Q,UAAgCoC,IAAhB0O,EAAQ9Q,KAAqC,KAAhB8Q,EAAQ9Q,IAC/D2N,EAAI3N,IAAM,SACL,CACL,IAAMkR,EAAIzL,OAAOqL,EAAQ9Q,KACzB2N,EAAI3N,IAAM0F,SAASwL,GAAKA,EAAI,IAC9B,CAEF,GAAIC,GAAUC,GAAsB,OAAZzD,EAAI5N,KAA4B,OAAZ4N,EAAI3N,KAAgB2N,EAAI5N,IAAM4N,EAAI3N,IAAK,CACjF,IAAMgG,EAAM2H,EAAI5N,IAAK4N,EAAI5N,IAAM4N,EAAI3N,IAAK2N,EAAI3N,IAAMgG,CACpD,CAEA,GAAInD,OAAOkO,UAAUC,eAAeC,KAAKH,EAAS,gBAAiB,CACjE,IAAMI,EAAIzL,OAAOqL,EAAQvQ,cACzBoN,EAAIpN,aAAgBmF,SAASwL,IAAMA,GAAK,EAAKA,EAAIpR,EAASS,YAC5D,CACA,GAAIsC,OAAOkO,UAAUC,eAAeC,KAAKH,EAAS,qBAAsB,CACtE,IAAMI,EAAIzL,OAAOqL,EAAQtQ,mBACzBmN,EAAInN,kBAAqBkF,SAASwL,IAAMA,GAAK,EAAKA,EAAIpR,EAASU,iBACjE,CAEA,OAAOmN,CACT,IAAC,CArDuB,GA0vCnB,SAAS0D,EAAUrP,EAASC,GAEjC,IAAKD,GAAgC,UAArBA,EAAQM,SAEtB,OADAa,QAAQC,KAAK,qBACN,KAIT,QAAahB,IAATH,EAAoB,CAElBD,EAAQF,KACVqB,QAAQC,KAAK,wGACbpB,EAAQF,GAAcwI,WAIxB,IAAMgH,EAAO,IAAIvP,EAAcC,EAASC,GAMxC,OALAD,EAAQF,GAAgBwP,EAGxBA,EAAK7G,uBAEE6G,EAAKC,aACd,CAGA,IAAKvP,EAAQF,GAAe,CAC1B,IAAMwP,EAAO,IAAIvP,EAAcC,EAAS,CAAA,GAGxC,OAFAA,EAAQF,GAAgBwP,EACxBA,EAAK7G,uBACE6G,EAAKC,aACd,CAEA,OAAOvP,EAAQF,GAAcyP,aAC/B,CAOO,SAASC,EAAaxP,GAC3B,OAAOA,EAAQF,GAAgBE,EAAQF,GAAcyP,cAAgB,IACvE,CAcO,IAAME,EAAc5O,OAAO6O,OAAO,CACvCC,IAAK,MACLC,IAAK,MACLC,WAAY,YACZC,SAAU,cACVC,WAAY,gBACZC,UAAW,WACXC,QAAS,aACTC,UAAW,iBC54CPC,WAAkBC,GAAA,SAAAD,IAAA,OAAA9P,OAAA8P,GAAAE,EAAA7P,KAAA2P,EAAAjQ,UAAA,CAAA,4RAAAoQ,CAAAH,EAAAC,GAAAlN,EAAAiN,EAAA,CAAA,CAAAhN,IAAA,OAAAC,MAEtB,WAAO,IAAA6C,EAAAzF,KAELA,KAAK+P,SAAW,KAChB/P,KAAKgQ,UAAY,KAGZhQ,KAAKC,MAAMgQ,UAAUC,SAAS,kBACjClQ,KAAKC,MAAMgQ,UAAUnH,IAAI,gBACzB9I,KAAKmQ,mBAAoB,GAI3BnQ,KAAKoQ,oBAGLpQ,KAAK8O,KAAKzG,eAAe,SAAU,SAACgI,GAAQ,OAAK5K,EAAK6K,aAAaD,EAAS,GAC5ErQ,KAAK8O,KAAKzG,eAAe,UAAW,SAACgI,GAAQ,OAAK5K,EAAK8K,cAAcF,EAAS,GAC9ErQ,KAAK8O,KAAKzG,eAAe,iBAAkB,SAACgI,GAAQ,OAAK5K,EAAK+K,kBAAkB,KAAMH,EAAS,GAC/FrQ,KAAK8O,KAAKzG,eAAe,mBAAoB,SAACgI,GAAQ,OAAK5K,EAAK+K,kBAAkB,OAAQH,EAAS,GACnGrQ,KAAK8O,KAAKzG,eAAe,kBAAmB,SAACgI,GAAQ,OAAK5K,EAAKgL,0BAA0B,KAAMJ,EAAS,GACxGrQ,KAAK8O,KAAKzG,eAAe,oBAAqB,SAACgI,GAAQ,OAAK5K,EAAKgL,0BAA0B,OAAQJ,EAAS,GAC5GrQ,KAAK8O,KAAKzG,eAAe,aAAc,SAACgI,GAAQ,OAAK5K,EAAKiL,yBAAyB,KAAML,EAAS,GAClGrQ,KAAK8O,KAAKzG,eAAe,eAAgB,SAACgI,GAAQ,OAAK5K,EAAKiL,yBAAyB,OAAQL,EAAS,GACtGrQ,KAAK8O,KAAKzG,eAAe,eAAgB,SAACgI,GAAQ,OAAK5K,EAAKkL,iBAAiB,KAAMN,EAAS,GAC5FrQ,KAAK8O,KAAKzG,eAAe,iBAAkB,SAACgI,GAAQ,OAAK5K,EAAKkL,iBAAiB,OAAQN,EAAS,GAChGrQ,KAAK8O,KAAKzG,eAAe,oBAAqB,SAACgI,GAAQ,OAAK5K,EAAKmL,qBAAqB,GACtF5Q,KAAK8O,KAAKzG,eAAe,qBAAsB,SAACgI,GAAQ,OAAK5K,EAAKoL,sBAAsB,GACxF7Q,KAAK8O,KAAKzG,eAAe,kBAAmB,SAACgI,GAAQ,OAAK5K,EAAKqL,4BAA4BT,EAAS,GACpGrQ,KAAK8O,KAAKzG,eAAe,mBAAoB,SAACgI,GAAQ,OAAK5K,EAAKsL,yBAAyBV,EAAS,EACpG,GAAC,CAAA1N,IAAA,WAAAC,MAED,qBAEM5C,KAAKmQ,oBACPnQ,KAAKC,MAAMgQ,UAAUe,OAAO,gBAC5BhR,KAAKmQ,mBAAoB,MAI3B,aAAAnQ,8BAAA2P,uDAAA,GACF,GAAC,CAAAhN,IAAA,kBAAAC,MAED,WAEE,IAAMqO,EAAqBjR,KAAKC,MAAMiR,QAAQ,gBAE9C,OAAID,EACKjR,KAAKmR,wBAAwBF,GAE7BjR,KAAKoR,sBAEhB,GAAC,CAAAzO,IAAA,uBAAAC,MAED,WACE,IAEIyO,EAFEC,EAAiBtR,KAAKuR,wBAI1BF,EADErR,KAAKI,SAASnC,qDACZmG,OACwBkN,EAAc,sCAAAlN,OACpCpE,KAAKI,SAAS7B,OAAM,4DAAA6F,OAA+DpE,KAAKI,SAAS3B,mBAAqB,yCAAE2F,OAAqCpE,KAAKwR,kBAAiB,KAAApN,OAAIpE,KAAKI,SAAS7B,OAAM,WAAY,GAAE,gBAAA6F,OACzNpE,KAAKI,SAAS5B,QAAO,6DAAA4F,OAAgEpE,KAAKI,SAAS1B,oBAAsB,0CAAE0F,OAAsCpE,KAAKyR,wBAAkBrN,OAAIpE,KAAKI,SAAS5B,QAAO,WAAY,GAAE,gBAAA4F,OAC/NpE,KAAK0R,uBAAsB,iEAI7BtN,OACwBkN,EAAc,wDAAAlN,OAClBpE,KAAKI,SAAS9B,iBAAmB,IAAM,KAAI,aAAA8F,OAAYpE,KAAKI,SAASpB,kBAAoB,4BAA2B,6DAAAoF,OAA4DpE,KAAK2R,sBAAqB,+CAAAvN,OAA8CpE,KAAKI,SAASlB,gBAAkB,IAAG,yBAAAkF,OAC7SpE,KAAKI,SAAS7B,OAAM,4DAAA6F,OAA+DpE,KAAKI,SAAS3B,mBAAqB,GAAE,sCAAA2F,OAAqCpE,KAAKwR,uBAAiBpN,OAAIpE,KAAKI,SAAS7B,OAAM,WAAY,mBAAE6F,OACzNpE,KAAKI,SAAS5B,QAAO,6DAAA4F,OAAgEpE,KAAKI,SAAS1B,oBAAsB,GAAE,uCAAA0F,OAAsCpE,KAAKyR,mBAAkB,KAAArN,OAAIpE,KAAKI,SAAS5B,QAAO,WAAY,GAAE,kCAAA4F,OAC7MpE,KAAKI,SAAS9B,iBAAmB,IAAM,KAAI,aAAA8F,OAAYpE,KAAKI,SAASrB,gBAAkB,4BAA2B,yDAAAqF,OAAwDpE,KAAK4R,oBAAmB,+CAAAxN,OAA8CpE,KAAKI,SAASnB,cAAgB,IAAG,qCAM3S,IAAM4S,EAAU7E,SAAS8E,cAAc,OACvCD,EAAQE,UAAYV,EAAKW,OACzB,IAAMlF,EAAU+E,EAAQI,WAMxB,GAHAjS,KAAKC,MAAM8M,cAAcmF,aAAapF,EAAS9M,KAAKC,OAGhDD,KAAKI,SAASnC,gBAAiB,CAEjC,IAAM8R,EAAWjD,EAAQqF,cAAc,sCACjCnC,EAAYlD,EAAQqF,cAAc,uCAExC,GAAIpC,EAEFjD,EAAQoF,aAAalS,KAAKC,MAAO8P,EAASqC,kBACrC,GAAIpC,EAETlD,EAAQoF,aAAalS,KAAKC,MAAO+P,OAC5B,CAEL,IAAMqC,EAAkBvF,EAAQqF,cAAc,gDAC9CrF,EAAQoF,aAAalS,KAAKC,MAAOoS,EACnC,CACF,KAAO,CAEL,IAAMtC,EAAWjD,EAAQqF,cAAc,sCACjCnC,EAAYlD,EAAQqF,cAAc,uCAExC,GAAIpC,EAEFjD,EAAQoF,aAAalS,KAAKC,MAAO8P,EAASqC,kBACrC,GAAIpC,EAETlD,EAAQoF,aAAalS,KAAKC,MAAO+P,OAC5B,CAEL,IAAMsC,EAAWxF,EAAQqF,cAAc,kCACvCrF,EAAQoF,aAAalS,KAAKC,MAAOqS,EACnC,CACF,CAEA,OAAOxF,CACT,GAAC,CAAAnK,IAAA,0BAAAC,MAED,SAAwBqO,GAQtB,IAAIsB,EANJtB,EAAmBhB,UAAUnH,IAAI,uBAGjC9I,KAAKwS,YAAc,mBAKjBD,EADEvS,KAAKI,SAASnC,6BACJmG,OACRpE,KAAKI,SAAS7B,OAAM,4DAAA6F,OAA+DpE,KAAKI,SAAS3B,mBAAqB,GAAE,sCAAA2F,OAAqCpE,KAAKwR,uBAAiBpN,OAAIpE,KAAKI,SAAS7B,kBAAkB,GAAE,cAAA6F,OACzNpE,KAAKI,SAAS5B,QAAO,6DAAA4F,OAAgEpE,KAAKI,SAAS1B,oBAAsB,GAAE,uCAAA0F,OAAsCpE,KAAKyR,mBAAkB,KAAArN,OAAIpE,KAAKI,SAAS5B,QAAO,WAAY,GAAE,cAAA4F,OAC/NpE,KAAK0R,uBAAsB,YAGnB,+BAAAtN,OACUpE,KAAKI,SAAS9B,iBAAmB,IAAM,KAAI,aAAA8F,OAAYpE,KAAKI,SAASpB,kBAAoB,4BAA2B,6DAAAoF,OAA4DpE,KAAK2R,sBAAqB,+CAAAvN,OAA8CpE,KAAKI,SAASlB,gBAAkB,IAAG,uBAAAkF,OAC7SpE,KAAKI,SAAS7B,mEAAM6F,OAA+DpE,KAAKI,SAAS3B,mBAAqB,yCAAE2F,OAAqCpE,KAAKwR,kBAAiB,KAAApN,OAAIpE,KAAKI,SAAS7B,OAAM,WAAY,GAAE,cAAA6F,OACzNpE,KAAKI,SAAS5B,QAAO,6DAAA4F,OAAgEpE,KAAKI,SAAS1B,oBAAsB,GAAE,uCAAA0F,OAAsCpE,KAAKyR,wBAAkBrN,OAAIpE,KAAKI,SAAS5B,QAAO,WAAY,mCAAE4F,OAC7MpE,KAAKI,SAAS9B,iBAAmB,IAAM,KAAI,aAAA8F,OAAYpE,KAAKI,SAASrB,gBAAkB,4BAA2B,yDAAAqF,OAAwDpE,KAAK4R,oBAAmB,+CAAAxN,OAA8CpE,KAAKI,SAASnB,cAAgB,IAAG,qBAIzS,IAII8Q,EACAC,EALE6B,EAAU7E,SAAS8E,cAAc,OAOvC,GANAD,EAAQE,UAAYQ,EAMhBvS,KAAKI,SAASnC,gBAAiB,EAEjC8R,EAAW8B,EAAQM,cAAc,wCAE/BlB,EAAmBiB,aAAanC,EAAU/P,KAAKC,QAGjD+P,EAAY6B,EAAQM,cAAc,yCAEhClB,EAAmBiB,aAAalC,EAAWhQ,KAAKC,MAAMmS,aAGxD,IAAMC,EAAkBR,EAAQM,cAAc,gDAC1CE,GACFpB,EAAmBiB,aAAaG,EAAiBrC,EAAYA,EAAUoC,YAAcpS,KAAKC,MAAMmS,YAEpG,KAAO,CAEL,IAAMK,EAAaZ,EAAQM,cAAc,oCACrCM,GACFxB,EAAmBiB,aAAaO,EAAYzS,KAAKC,QAGnD8P,EAAW8B,EAAQM,cAAc,wCAE/BlB,EAAmBiB,aAAanC,EAAU/P,KAAKC,QAGjD+P,EAAY6B,EAAQM,cAAc,yCAEhClB,EAAmBiB,aAAalC,EAAWhQ,KAAKC,MAAMmS,aAGxD,IAAME,EAAWT,EAAQM,cAAc,kCACnCG,GACFrB,EAAmBiB,aAAaI,EAAUtC,EAAYA,EAAUoC,YAAcpS,KAAKC,MAAMmS,YAE7F,CAMA,OAHApS,KAAK+P,SAAWA,EAChB/P,KAAKgQ,UAAYA,EAEViB,CACT,GAAC,CAAAtO,IAAA,wBAAAC,MAED,WACE,IAAMqN,EAAYjQ,KAAKC,MAAMyS,UAC7B,OAAIzC,EAAUrL,SAAS,mBACd,iBACEqL,EAAUrL,SAAS,mBACrB,iBAEF,EACT,GAAC,CAAAjC,IAAA,oBAAAC,MAED,WAEE5C,KAAK8M,QAAU9M,KAAK2S,kBAGpB,IAAML,EAAWtS,KAAK8M,QAAQqF,cAAc,kCACtCM,EAAazS,KAAK8M,QAAQqF,cAAc,oCAC9CnS,KAAK+P,SAAW/P,KAAK8M,QAAQqF,cAAc,sCAC3CnS,KAAKgQ,UAAYhQ,KAAK8M,QAAQqF,cAAc,uCAG5CnS,KAAK8O,KAAK3G,eAAemK,GACzBtS,KAAK8O,KAAK1G,iBAAiBqK,EAC7B,GAAC,CAAA9P,IAAA,eAAAC,MAED,SAAaA,GAEX,IAAMmN,EAAW/P,KAAK+P,SAElBnN,GAAmB,KAAVA,EACPmN,GACFA,EAAS6C,YAAchQ,EACvBmN,EAAS8C,MAAMC,QAAU,GAEzB/C,EAAS2C,UAAY,+CAAAtO,OAA+CpE,KAAKI,SAAS3B,mBAAqB,IAAKuT,QAG5GhS,KAAK+S,aAEEhD,GAET/P,KAAK+S,YAET,GAAC,CAAApQ,IAAA,gBAAAC,MAED,SAAcA,GAEZ,IAAMoN,EAAYhQ,KAAKgQ,UAEnBpN,GAAmB,KAAVA,EACPoN,GACFA,EAAU4C,YAAchQ,EACxBoN,EAAU6C,MAAMC,QAAU,GAE1B9C,EAAU0C,UAAY,gDAAAtO,OAAgDpE,KAAKI,SAAS1B,oBAAsB,IAAKsT,QAG/GhS,KAAK+S,aAEE/C,GAEThQ,KAAK+S,YAET,GAAC,CAAApQ,IAAA,oBAAAC,MAED,SAAkBmL,EAAM2E,GACtB,IAAMM,EAAShT,KAAK8M,QAAQqF,cAAa,6BAAA/N,OAA8B2J,EAAI,OACvEiF,IACFA,EAAON,UAAS,GAAAtO,OAAMsO,GAAa,4BAA2B,yBAAAtO,OAAwB2J,GAE1F,GAAC,CAAApL,IAAA,uBAAAC,MAED,WAEE,MAAA,gNAAAwB,OAG0BpE,KAAKI,SAAS9B,iBAAmB,IAAM,KAAI,aAAA8F,OAAYpE,KAAKI,SAASrB,gBAAkB,4BAA2B,KAAAqF,OAAIpE,KAAKI,SAAShC,iBAAmB,4BAA2B,yDAAAgG,OAAwDpE,KAAK4R,mEAAmBxN,OAA8CpE,KAAKI,SAASlC,YAAc,+CAAGkG,OAC/UpE,KAAKI,SAAS9B,iBAAmB,IAAM,kBAAI8F,OAAYpE,KAAKI,SAASpB,kBAAoB,4BAA2B,KAAAoF,OAAIpE,KAAKI,SAAS/B,mBAAqB,4BAA2B,6DAAA+F,OAA4DpE,KAAK2R,sBAAqB,+CAAAvN,OAA8CpE,KAAKI,SAASjC,cAAgB,IAAG,kDAIvX,GAAC,CAAAwE,IAAA,4BAAAC,MAED,SAA0BmL,EAAM2E,GAC9B,IAAML,EAAkBrS,KAAK8M,QAAQqF,cAAc,gDACnD,GAAIE,EAAiB,CACnB,IAAMW,EAASX,EAAgBF,2CAAa/N,OAA8B2J,EAAI,OAC9E,GAAIiF,EAAQ,CAEV,IAAMC,EAAcjT,KAAKI,SAASrB,gBAAkBiB,KAAKI,SAASpB,kBAAoB,4BACtFgU,EAAON,UAAS,GAAAtO,OAAM6O,EAAW,KAAA7O,OAAIsO,GAAa,4BAA2B,yBAAAtO,OAAwB2J,EACvG,CACF,CACF,GAAC,CAAApL,IAAA,2BAAAC,MAED,SAAyBmL,EAAMmF,GAC7B,IAAMb,EAAkBrS,KAAK8M,QAAQqF,cAAc,gDACnD,GAAIE,EAAiB,CACnB,IAAMW,EAASX,EAAgBF,2CAAa/N,OAA8B2J,EAAI,OAC1EiF,IACFA,EAAOJ,YAAcM,IAAkB,OAATnF,EAAgB,IAAM,KAExD,CACF,GAAC,CAAApL,IAAA,mBAAAC,MAED,SAAiBmL,EAAMmF,GACrB,IAAMF,EAAShT,KAAK8M,QAAQqF,cAAa,6BAAA/N,OAA8B2J,EAAI,OACvEiF,IACFA,EAAOJ,YAAcM,IAAkB,OAATnF,EAAgB,IAAM,KAExD,GAAC,CAAApL,IAAA,sBAAAC,MAED,WACE,IAAMmN,EAAW/P,KAAK+P,SAClBA,IACFA,EAAS2C,UAAY,+CAAAtO,OAA+CpE,KAAKI,SAAS3B,mBAAqB,IAAKuT,OAEhH,GAAC,CAAArP,IAAA,uBAAAC,MAED,WACE,IAAMoN,EAAYhQ,KAAKgQ,UACnBA,IACFA,EAAU0C,UAAY,gDAAAtO,OAAgDpE,KAAKI,SAAS1B,oBAAsB,IAAKsT,OAEnH,GAAC,CAAArP,IAAA,8BAAAC,MAED,SAA4ByN,GAE1BrQ,KAAK+S,YACP,GAAC,CAAApQ,IAAA,aAAAC,MAED,WAEE5C,KAAKmT,yBAELnT,KAAK8M,QAAU,KACf9M,KAAK+P,SAAW,KAChB/P,KAAKgQ,UAAY,KACjBhQ,KAAKoQ,mBACP,GAAC,CAAAzN,IAAA,2BAAAC,MAED,SAAyByN,GAEvB,IAAM+C,EAAUpT,KAAK8M,QAAQuG,iBAAiB,oEACxCC,EAAWjD,EAAW,IAAM,KAClC+C,EAAQnN,QAAQ,SAAA+M,GACdA,EAAO3G,aAAa,WAAYiH,EAClC,EACF,IAAC,ECpVmB,WAsBpB,OAAA5Q,EAhBA,SAAA6Q,EAAY/T,EAASY,EAAU0O,GAAMjP,OAAA0T,GAGnCvT,KAAKC,MAAQT,EAEbQ,KAAKI,SAAWA,EAEhBJ,KAAK8O,KAAOA,EAEZ9O,KAAK8M,QAAU,KAEf9M,KAAKwS,YAAc,SAGrB,EAEA,CAAA,CAAA7P,IAAA,OAAAC,MAKA,WACE,MAAM,IAAI7C,MAAM,yCAClB,GAEA,CAAA4C,IAAA,WAAAC,MAKA,WAEE5C,KAAKmT,wBAEP,GAEA,CAAAxQ,IAAA,yBAAAC,MAKA,WAAyB,IAAA6C,EAAAzF,KAEnBA,KAAK8M,UACU9M,KAAK8M,QAAQuG,iBAAiB,6BACtCpN,QAAQ,SAAAmG,GAAE,OAAIA,EAAG4E,QAAQ,GAG9BhR,KAAK8M,QAAQzI,aAAa,4BAA8BrE,KAAK8M,QAAQC,gBAGlD,qBAFA/M,KAAK8M,QAAQvI,aAAa,4BAK7CvE,KAAK8M,QAAQmD,UAAUe,OAAO,uBAC9BhR,KAAK8M,QAAQR,gBAAgB,6BAGdtM,KAAK8M,QAAQC,cACrBmF,aAAalS,KAAKC,MAAOD,KAAK8M,SACrC9M,KAAK8M,QAAQkE,YAMChE,SAASqG,iBAAiB,6BAClCpN,QAAQ,SAAAmG,GAAM,IAAAoH,GAEpBpH,EAAG8D,SAASzK,EAAKxF,QAChBmM,EAAGW,eAAiBX,EAAGW,cAAcmD,SAASzK,EAAKxF,QAC5B,QADmCuT,EAC3D/N,EAAKxF,MAAM8M,yBAAayG,GAAxBA,EAA0BtD,SAAS9D,KAEjCA,IAAO3G,EAAKxF,OACdmM,EAAG4E,QAGT,EACF,GAKA,CAAArO,IAAA,oBAAAC,MAIA,WACE,IAAM6Q,EAAczT,KAAKC,MAAMsE,aAAa,eAC5C,OAAIkP,EAAa,iBAAArP,OAAwBqP,EAAW,QAC7C,EACT,GAEA,CAAA9Q,IAAA,sBAAAC,MAIA,WACE,IAAM6Q,EAAczT,KAAKC,MAAMsE,aAAa,eAC5C,OAAIkP,EAAa,iBAAArP,OAAwBqP,EAAW,UAC7C,EACT,GAEA,CAAA9Q,IAAA,kBAAAC,MAIA,WACE,IAAM6Q,EAAczT,KAAKC,MAAMsE,aAAa,eAC5C,OAAIkP,EAAa,iBAAArP,OAAwBqP,EAAW,YAC7C,EACT,GAEA,CAAA9Q,IAAA,mBAAAC,MAIA,WACE,IAAM6Q,EAAczT,KAAKC,MAAMsE,aAAa,eAC5C,OAAIkP,EAAa,iBAAArP,OAAwBqP,EAAW,aAC7C,EACT,GAEA,CAAA9Q,IAAA,4BAAAC,MAKA,WACE,GAAI5C,KAAK8M,QAAS,CAEhB,IAAM4G,EAAS1T,KAAKC,MAAMsE,aAAa,eACnCmP,IAAW1T,KAAK8M,QAAQzI,aAAa,gBACvCrE,KAAK8M,QAAQT,aAAa,cAAeqH,EAAS,YAIpD1T,KAAK8M,QAAQT,aAAa,0BAA2BrM,KAAKwS,YAC5D,CACF,IAAC,CAjJmB,ICXtB,SAAS3D,EAAUvG,GAAuB,IAAdqL,EAAOjU,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,CAAA,EACpC,KAAM4I,aAAmBsL,SACvB,MAAM,IAAIC,UAAU,oCAOtB,OAHAF,EAAQnT,SAAWmT,EAAQnT,UAAYmP,EAGhCmE,EAAcxL,EAASqL,EAChC,CAGA,SAASI,EAAuBC,GAC9BA,EAAExK,GAAGqF,UAAY,SAAS8E,EAASM,GAEjC,GAAuB,iBAAZN,EAAsB,CAC/B,IACIO,EADEC,EAAM1N,OAAOkN,GAASS,cA8B5B,OA5BApU,KAAKqU,KAAK,WACR,IACMC,EAAMtF,EADqChP,MAIjD,GAAa,aAARmU,GAA8B,QAARA,QAA0BvU,IAARsU,GAU7C,GAAKI,EAEL,OAAQH,GACN,IAAK,UAAWG,EAAIxM,UAAW,MAC/B,IAAK,SAAUwM,EAAI9M,SAAU,MAC7B,IAAK,WAAY8M,EAAI7M,WAAY,MACjC,IAAK,cAAe6M,EAAI5M,cAAe,MACvC,IAAK,gBAAiB4M,EAAI3M,gBAAiB,MAC3C,IAAK,WAAY2M,EAAIjP,WAAY,MACjC,IAAK,iBAAkBiP,EAAI1M,eAAeqM,GAAO,IAAK,MACtD,IAAK,WAAY,IAAK,MAAOK,EAAIzM,SAASoM,SAlBxCC,EADEI,EACIA,EAAIrP,WANmCjF,KAS/B4C,KAiBpB,QACehD,IAARsU,EAAoBlU,KAAOkU,CACpC,CAGA,OAAOlU,KAAKqU,KAAK,WACf,IAAME,EAASP,EAAEhU,MACXR,EAA2CQ,KAG3CP,EAAOkU,GAAW,CAAA,EACxBlU,EAAKe,SAAWf,EAAKe,UAAYmP,EACjC,IAAM6E,EAAOV,EAActU,EAASC,GAG9BgV,EAAKC,EAAAA,EAAAA,EAAAA,EAAAA,EAAAA,EAAAA,EAAAA,EAAA,GACRzF,EAAYE,IAAM,oBAClBF,EAAYG,IAAM,oBAClBH,EAAYI,WAAa,0BACzBJ,EAAYK,SAAW,4BACvBL,EAAYM,WAAa,8BACzBN,EAAYO,UAAY,yBACxBP,EAAYQ,QAAU,2BACtBR,EAAYS,UAAY,6BAIrBiF,EAAS,GACftU,OAAO2F,KAAKyO,GAAOxO,QAAQ,SAAAuF,GACzBmJ,EAAO5N,KAAKyN,EAAKzM,GAAGyD,EAAG,WAAA,OAAM+I,EAAOK,QAAQH,EAAMjJ,GAAG,GACvD,GAeAgJ,EAAKtM,iBAZkB,WAErByM,EAAO1O,QAAQ,SAAA4O,GACb,IAAMA,GAAS,CAAE,MAAApL,GACf,CAEJ,GAEA8K,EAAOvM,IAAI,kJACb,GAMAuM,EAAOxM,GAAG,mBAAoB,WAC5B,IAAMuM,EAAMtF,EAAaxP,GACrB8U,GAAKA,EAAI9M,QACf,GACA+M,EAAOxM,GAAG,qBAAsB,WAC9B,IAAMuM,EAAMtF,EAAaxP,GACrB8U,GAAKA,EAAI7M,UACf,GACA8M,EAAOxM,GAAG,wBAAyB,WACjC,IAAMuM,EAAMtF,EAAaxP,GACrB8U,GAAKA,EAAI5M,aACf,GACA6M,EAAOxM,GAAG,0BAA2B,WACnC,IAAMuM,EAAMtF,EAAaxP,GACrB8U,GAAKA,EAAI3M,eACf,GACA4M,EAAOxM,GAAG,qBAAsB,WAC9B,IAAMuM,EAAMtF,EAAaxP,GACrB8U,GAAKA,EAAIjP,UACf,GACAkP,EAAOxM,GAAG,2BAA4B,SAACmF,EAAG4H,GACxC,IAAMR,EAAMtF,EAAaxP,GACrB8U,GAAKA,EAAI1M,eAAekN,GAAK,CAAA,EACnC,GACAP,EAAOxM,GAAG,oBAAqB,WAE7B,IAAMuM,EAAMtF,EAAaxP,GACrB8U,GAAKA,EAAIxM,SACf,EACF,EACF,CACF,CAGsB,oBAAXiN,QAA0BA,OAAOC,QAC1CjB,EAAuBgB,OAAOC,QAIV,oBAAXD,SACTA,OAAOlG,UAAYA,EACnBkG,OAAOxV,cAAgBA,EACvBwV,OAAO/F,aAAeA,EACtB+F,OAAOpF,mBAAqBA,EAC5BoF,OAAOhB,uBAAyBA"}