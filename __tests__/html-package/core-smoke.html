<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TouchSpin Core Smoke Test (jQuery UMD Plugin)</title>
  <script src="../html/assets/tailwind/tailwind.min.js"></script>
  <script src="../html/assets/jquery/jquery-3.7.1.min.js"></script>
  <style>
    .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
    .control-buttons button { margin: 4px; }
    pre { background:#f8f9fa; padding:10px; }
  </style>
</head>
<body>
  <div class="max-w-3xl mx-auto mt-6">
    <h1 class="text-2xl font-semibold">TouchSpin Core Smoke Test</h1>
    <p class="text-gray-700">Using jQuery TouchSpin plugin to test core functionality via UMD build.</p>

    <div class="test-section">
      <div class="mb-2">
        <label for="core-input" class="block mb-1 font-medium">Numeric input:</label>
        <input id="core-input" type="text" value="10" class="w-full border rounded px-2 py-2" />
      </div>
      <div class="control-buttons">
        <button id="btn-init" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Init Core</button>
        <button id="btn-destroy" class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">Destroy</button>
        <button id="btn-reinit" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">Reinit (different)</button>
      </div>
      <div class="control-buttons">
        <button id="btn-uponce" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">upOnce()</button>
        <button id="btn-downonce" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">downOnce()</button>
        <button id="btn-startup" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">startUpSpin()</button>
        <button id="btn-startdown" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">startDownSpin()</button>
        <button id="btn-stop" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">stopSpin()</button>
        <button id="btn-get" class="px-3 py-2 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded">getValue()</button>
        <button id="btn-set" class="px-3 py-2 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded">setValue(64)</button>
        <button id="btn-update" class="px-3 py-2 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded">updateSettings({ step: 10 })</button>
      </div>
      <div class="mt-2"><strong>Status:</strong> <span id="status">Not initialized</span></div>
      <h5 class="mt-3 font-medium">Events</h5>
      <pre id="log"></pre>
    </div>
  </div>

  <script src="/packages/jquery-plugin/dist/jquery.touchspin-bootstrap5.umd.js"></script>

  <script>
    const input = document.getElementById('core-input');
    const status = document.getElementById('status');
    const log = document.getElementById('log');
    let isInitialized = false;
    const unsubs = [];

    function addLog(msg) {
      const ts = new Date().toISOString().split('T')[1].replace('Z','');
      log.textContent += `[${ts}] ${msg}\n`;
      log.scrollTop = log.scrollHeight;
    }

    function getCoreInstance() {
      return input._touchSpinCore;
    }

    function subEvents(core) {
      const events = [
        'min',
        'max',
        'startspin',
        'startupspin',
        'startdownspin',
        'stopspin',
        'stopupspin',
        'stopdownspin',
      ];
      for (const ev of events) {
        unsubs.push(core.on(ev, () => addLog(`core:${ev}`)));
      }
    }

    function init() {
      if (isInitialized) { try { destroy(); } catch {} }
      $(input).TouchSpin({ min: 0, max: 100, step: 1 });
      const core = getCoreInstance();
      if (core) {
        subEvents(core);
        isInitialized = true;
        status.textContent = 'Initialized (min 0, max 100, step 1)';
        // Log native change events explicitly
        input.addEventListener('change', () => addLog('change[' + input.value + ']'));
      }
    }

    function destroy() {
      if (!isInitialized) return;
      for (const u of unsubs.splice(0)) try { u(); } catch {}
      $(input).TouchSpin('destroy');
      isInitialized = false;
      status.textContent = 'Destroyed';
    }

    document.getElementById('btn-init').addEventListener('click', init);
    document.getElementById('btn-destroy').addEventListener('click', destroy);
    document.getElementById('btn-reinit').addEventListener('click', () => {
      destroy();
      $(input).TouchSpin({ min: 5, max: 50, step: 5 });
      const core = getCoreInstance();
      if (core) {
        subEvents(core);
        isInitialized = true;
        status.textContent = 'Reinitialized (min 5, max 50, step 5)';
      }
    });

    document.getElementById('btn-uponce').addEventListener('click', () => {
      const core = getCoreInstance();
      core && core.upOnce();
    });
    document.getElementById('btn-downonce').addEventListener('click', () => {
      const core = getCoreInstance();
      core && core.downOnce();
    });
    document.getElementById('btn-startup').addEventListener('click', () => {
      const core = getCoreInstance();
      core && core.startUpSpin();
    });
    document.getElementById('btn-startdown').addEventListener('click', () => {
      const core = getCoreInstance();
      core && core.startDownSpin();
    });
    document.getElementById('btn-stop').addEventListener('click', () => {
      const core = getCoreInstance();
      core && core.stopSpin();
    });
    document.getElementById('btn-get').addEventListener('click', () => {
      const core = getCoreInstance();
      core && addLog('getValue()=' + core.getValue());
    });
    document.getElementById('btn-set').addEventListener('click', () => {
      const core = getCoreInstance();
      core && core.setValue(64);
    });
    document.getElementById('btn-update').addEventListener('click', () => {
      const core = getCoreInstance();
      core && core.updateSettings({ step: 10 });
    });
  </script>
</body>
</html>
