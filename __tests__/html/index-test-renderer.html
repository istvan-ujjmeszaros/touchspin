<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>TouchSpin Test Renderer</title>
  <script src="assets/jquery/jquery-3.7.1.min.js"></script>
  <script type="module">
    import { installJqueryTouchSpin } from '/packages/jquery-plugin/dist/index.js';
    import AbstractRenderer from '/packages/core/dist/index.js';

    // Minimal custom renderer for targeted coverage
    class TestRenderer extends AbstractRenderer {
      init() {
        // Build simple structure
        const inputTestId = this.input.getAttribute('data-testid');
        const wrapperTestId = inputTestId ? ` data-testid="${inputTestId}-wrapper"` : '';
        const html = `
          <div class="test-container" data-touchspin-injected="wrapper"${wrapperTestId}>
            <span class="test-prefix" data-touchspin-injected="prefix"${this.getPrefixTestId()}>pre</span>
            <button type="button" class="test-btn-down" data-touchspin-injected="down"${this.getDownButtonTestId()} aria-label="Decrease value">-</button>
            <button type="button" class="test-btn-up" data-touchspin-injected="up"${this.getUpButtonTestId()} aria-label="Increase value">+</button>
            <span class="test-postfix" data-touchspin-injected="postfix"${this.getPostfixTestId()}>post</span>
          </div>
        `;

        // Inject after input and move input inside wrapper as first child
        const temp = document.createElement('div');
        temp.innerHTML = html;
        const wrapper = temp.firstElementChild;
        this.input.parentElement.insertBefore(wrapper, this.input.nextSibling);
        wrapper.insertBefore(this.input, wrapper.firstChild);
        this.wrapper = /** @type {HTMLElement} */ (wrapper);

        // Attach core events to buttons
        const up = this.wrapper.querySelector('[data-touchspin-injected="up"]');
        const down = this.wrapper.querySelector('[data-touchspin-injected="down"]');
        this.core.attachUpEvents(up);
        this.core.attachDownEvents(down);
      }
    }

    // Install plugin and set default renderer
    installJqueryTouchSpin(window.jQuery);
    window.TestRenderer = TestRenderer;

    // Initialize on DOMContentLoaded
    window.addEventListener('DOMContentLoaded', () => {
      // Explicitly pass the TestRenderer as the renderer option
      window.jQuery('#test-target').TouchSpin({
        renderer: TestRenderer
      });
    });
  </script>
</head>
<body>
  <div class="container">
    <input id="test-target" type="text" value="42" data-testid="test-target">
  </div>
</body>
</html>
