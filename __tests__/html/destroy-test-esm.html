<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TouchSpin Destroy/Reinitialize Test (ESM)</title>

  <!-- Bootstrap 4 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- TouchSpin CSS (source) -->
  <link href="../../src/jquery.bootstrap-touchspin.css" rel="stylesheet">

  <style>
    .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
    .control-buttons { margin: 15px 0; }
    .control-buttons button { margin: 5px; }
    .status { margin: 10px 0; padding: 10px; background-color: #f8f9fa; border-radius: 3px; }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>TouchSpin Destroy/Reinitialize Test (ESM)</h1>
    <p>Using the ESM twin loader to register the classic plugin.</p>

    <!-- Test 1: New Container Creation -->
    <div class="test-section">
      <h3>Test 1: New Container Creation (buildInputGroup)</h3>
      <div class="form-group">
        <label for="test-input-new">Test Input (New Container):</label>
        <input id="test-input-new" type="text" value="10" data-testid="test-input-new" class="form-control">
      </div>

      <div class="control-buttons">
        <button id="init-new-btn" class="btn btn-primary">Initialize TouchSpin</button>
        <button id="destroy-new-btn" class="btn btn-danger">Destroy TouchSpin</button>
        <button id="reinit-new-btn" class="btn btn-success">Reinitialize TouchSpin</button>
      </div>

      <div class="status" id="status-new">Status: Not initialized</div>
    </div>

    <!-- Test 2: Existing Container Enhancement -->
    <div class="test-section">
      <h3>Test 2: Existing Container Enhancement (buildAdvancedInputGroup)</h3>
      <div class="form-group">
        <label>Test Input (Existing Container):</label>
        <div class="input-group existing-container" id="existing-container">
          <div class="input-group-prepend"><span class="input-group-text">Pre</span></div>
          <input id="test-input-existing" type="text" value="42" data-testid="test-input-existing" class="form-control">
          <div class="input-group-append"><span class="input-group-text">Post</span></div>
        </div>
      </div>

      <div class="control-buttons">
        <button id="init-existing-btn" class="btn btn-primary">Initialize TouchSpin</button>
        <button id="destroy-existing-btn" class="btn btn-danger">Destroy TouchSpin</button>
        <button id="reinit-existing-btn" class="btn btn-success">Reinitialize TouchSpin</button>
      </div>

      <div class="status" id="status-existing">Status: Not initialized</div>
    </div>

    <!-- Test 3: Vertical Buttons -->
    <div class="test-section">
      <h3>Test 3: Vertical Buttons</h3>
      <div class="form-group">
        <label for="test-input-vertical">Test Input (Vertical Buttons):</label>
        <input id="test-input-vertical" type="text" value="15" data-testid="test-input-vertical" class="form-control">
      </div>

      <div class="control-buttons">
        <button id="init-vertical-btn" class="btn btn-primary">Initialize TouchSpin</button>
        <button id="destroy-vertical-btn" class="btn btn-danger">Destroy TouchSpin</button>
        <button id="reinit-vertical-btn" class="btn btn-success">Reinitialize TouchSpin</button>
      </div>

      <div class="status" id="status-vertical">Status: Not initialized</div>
    </div>
    
    <!-- Test 4: Modern API (Element.prototype.TouchSpin) -->
    <div class="test-section">
      <h3>Test 4: Modern API (no jQuery in user code)</h3>
      <div class="form-group">
        <label for="test-input-modern">Test Input (Modern API):</label>
        <input id="test-input-modern" type="text" value="25" class="form-control">
      </div>

      <div class="control-buttons">
        <button id="init-modern-btn" class="btn btn-primary">Initialize (modern)</button>
        <button id="destroy-modern-btn" class="btn btn-danger">Destroy (modern)</button>
        <button id="reinit-modern-btn" class="btn btn-success">Reinitialize (modern)</button>
      </div>

      <div class="control-buttons">
        <button id="modern-uponce" class="btn btn-outline-primary">up once</button>
        <button id="modern-downonce" class="btn btn-outline-primary">down once</button>
        <button id="modern-startup" class="btn btn-outline-primary">start up</button>
        <button id="modern-startdown" class="btn btn-outline-primary">start down</button>
        <button id="modern-stop" class="btn btn-outline-primary">stop</button>
        <button id="modern-get" class="btn btn-outline-secondary">getValue()</button>
        <button id="modern-set" class="btn btn-outline-secondary">setValue(64)</button>
        <button id="modern-update" class="btn btn-outline-secondary">updateSettings({ step: 10 })</button>
      </div>

      <div class="status" id="status-modern">Status: Not initialized</div>
    </div>
  </div>

  <!-- jQuery and Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Load source renderer files (classic) -->
  <script src="../../src/renderers/AbstractRenderer.js"></script>
  <script src="../../src/renderers/Bootstrap4Renderer.js"></script>

  <!-- Create Bootstrap 4 RendererFactory -->
  <script>
    window.RendererFactory = class {
      static createRenderer($, settings, originalinput) {
        return new Bootstrap4Renderer($, settings, originalinput);
      }
      static getVersion() { return 4; }
    };
  </script>

  <!-- Load ESM twin that registers the classic plugin -->
  <script type="module" src="../../src/jquery.bootstrap-touchspin.esm.js"></script>
  <!-- Install modern facade wrapper (LGTM-7a, manual pages only) -->
  <script type="module" src="../../src/wrappers/modern-facade.js"></script>

  <script>
    $(function() {
      function updateStatus(id, msg) { $(id).text('Status: ' + msg); }

      // Test 1
      $('#init-new-btn').click(function(){
        $('#test-input-new').TouchSpin({ min:0, max:100, prefix:'$', postfix:'.00' });
        updateStatus('#status-new', 'Initialized ($ prefix, .00 postfix)');
      });
      $('#destroy-new-btn').click(function(){
        $('#test-input-new').trigger('touchspin.destroy');
        updateStatus('#status-new', 'Destroyed');
      });
      $('#reinit-new-btn').click(function(){
        $('#test-input-new').TouchSpin({ min:5, max:50, step:5, prefix:'€', postfix:' EUR' });
        updateStatus('#status-new', 'Reinitialized (€ prefix, EUR postfix, step 5)');
      });

      // Test 2
      $('#init-existing-btn').click(function(){
        $('#test-input-existing').TouchSpin({ min:0, max:100, prefix:'$', postfix:'.00' });
        updateStatus('#status-existing', 'Enhanced existing input-group ($ prefix, .00 postfix)');
      });
      $('#destroy-existing-btn').click(function(){
        $('#test-input-existing').trigger('touchspin.destroy');
        updateStatus('#status-existing', 'Destroyed (restored original)');
      });
      $('#reinit-existing-btn').click(function(){
        $('#test-input-existing').TouchSpin({ min:10, max:200, step:10, prefix:'€', postfix:' EUR' });
        updateStatus('#status-existing', 'Reinitialized (€ prefix, EUR postfix, step 10)');
      });

      // Test 3
      $('#init-vertical-btn').click(function(){
        $('#test-input-vertical').TouchSpin({ min:0, max:100, verticalbuttons:true, verticalup:'▲', verticaldown:'▼' });
        updateStatus('#status-vertical', 'Initialized (vertical ▲/▼)');
      });
      $('#destroy-vertical-btn').click(function(){
        $('#test-input-vertical').trigger('touchspin.destroy');
        updateStatus('#status-vertical', 'Destroyed');
      });
      $('#reinit-vertical-btn').click(function(){
        $('#test-input-vertical').TouchSpin({ min:0, max:50, step:5, verticalbuttons:true, verticalup:'↑', verticaldown:'↓' });
        updateStatus('#status-vertical', 'Reinitialized (vertical ↑/↓, step 5)');
      });

      // Test 4: Modern API (no jQuery in user code)
      let modernInst;
      const modernEl = document.getElementById('test-input-modern');
      document.getElementById('init-modern-btn').addEventListener('click', function() {
        modernInst = modernEl.TouchSpin({ min: 0, max: 100, step: 1 });
        updateStatus('#status-modern', 'Initialized (modern facade)');
      });
      document.getElementById('destroy-modern-btn').addEventListener('click', function() {
        if (modernInst) modernInst.destroy();
        updateStatus('#status-modern', 'Destroyed (modern facade)');
      });
      document.getElementById('reinit-modern-btn').addEventListener('click', function() {
        modernInst = modernEl.TouchSpin({ min: 10, max: 90, step: 5 });
        updateStatus('#status-modern', 'Reinitialized (modern facade, step 5)');
      });
      document.getElementById('modern-uponce').addEventListener('click', function(){ if (modernInst) modernInst.upOnce(); });
      document.getElementById('modern-downonce').addEventListener('click', function(){ if (modernInst) modernInst.downOnce(); });
      document.getElementById('modern-startup').addEventListener('click', function(){ if (modernInst) modernInst.startUpSpin(); });
      document.getElementById('modern-startdown').addEventListener('click', function(){ if (modernInst) modernInst.startDownSpin(); });
      document.getElementById('modern-stop').addEventListener('click', function(){ if (modernInst) modernInst.stopSpin(); });
      document.getElementById('modern-get').addEventListener('click', function(){ if (modernInst) alert('getValue() = ' + modernInst.getValue()); });
      document.getElementById('modern-set').addEventListener('click', function(){ if (modernInst) modernInst.setValue(64); });
      document.getElementById('modern-update').addEventListener('click', function(){ if (modernInst) modernInst.updateSettings({ step: 10 }); });
    });
  </script>
</body>
</html>
