<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TouchSpin Tailwind Renderer + Core (no jQuery plugin)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="../../src/jquery.bootstrap-touchspin.css" rel="stylesheet">
  <style>
    .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
    .control-buttons button { margin: 4px; }
    pre { background:#f8f9fa; padding:10px; }
  </style>
  <!-- Renderer (Tailwind) requires jQuery internally -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="../../packages/renderers/tailwind/src/AbstractRenderer.js"></script>
  <script src="../../packages/renderers/tailwind/src/TailwindRenderer.js"></script>
  <script>
    window.RendererFactory = class {
      static createRenderer($, settings, originalinput) { return new TailwindRenderer($, settings, originalinput); }
      static getFrameworkId() { return 'tailwind'; }
    };
  </script>
</head>
<body>
  <div class="max-w-3xl mx-auto mt-6">
    <h1 class="text-2xl font-semibold">Tailwind Renderer + Core (no plugin)</h1>
    <p class="text-gray-700">Uses Tailwind renderer to build UI, then core API for behavior.</p>

    <div class="test-section">
      <div class="mb-2">
        <label for="tw-input" class="block mb-1 font-medium">Numeric input:</label>
        <input id="tw-input" type="text" value="10" class="w-full border rounded px-2 py-2" />
      </div>
      <div class="control-buttons">
        <button id="btn-init" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Init</button>
        <button id="btn-destroy" class="px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700">Destroy</button>
        <button id="btn-reinit" class="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700">Reinit (different)</button>
      </div>
      <div class="control-buttons">
        <button id="btn-uponce" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">upOnce()</button>
        <button id="btn-downonce" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">downOnce()</button>
        <button id="btn-startup" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">startUpSpin()</button>
        <button id="btn-startdown" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">startDownSpin()</button>
        <button id="btn-stop" class="px-3 py-2 border border-blue-300 text-blue-700 bg-white hover:bg-blue-50 rounded">stopSpin()</button>
        <button id="btn-get" class="px-3 py-2 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded">getValue()</button>
        <button id="btn-set" class="px-3 py-2 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded">setValue(64)</button>
        <button id="btn-update" class="px-3 py-2 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded">updateSettings({ step: 10 })</button>
      </div>
      <div class="control-buttons">
        <button id="btn-toggle-disabled" class="px-3 py-2 border border-amber-300 text-amber-800 bg-white hover:bg-amber-50 rounded">Toggle Disabled</button>
        <button id="btn-toggle-readonly" class="px-3 py-2 border border-amber-300 text-amber-800 bg-white hover:bg-amber-50 rounded">Toggle Readonly</button>
      </div>
      <div class="mt-2"><strong>Status:</strong> <span id="status">Not initialized</span></div>
      <h5 class="mt-3 font-medium">Events</h5>
      <pre id="log"></pre>
    </div>
  </div>

  <script type="module">
    import { createPublicApi, CORE_EVENTS } from '../../packages/core/src/index.js';

    const $ = window.jQuery;
    const input = document.getElementById('tw-input');
    const $input = $(input);
    const status = document.getElementById('status');
    const log = document.getElementById('log');
    let inst = null;
    let unsubs = [];
    let wiredButtons = false;

    function addLog(msg) {
      const ts = new Date().toISOString().split('T')[1].replace('Z','');
      log.textContent += `[${ts}] ${msg}\n`;
      log.scrollTop = log.scrollHeight;
    }

    function subscribeCore(api) {
      const events = [
        CORE_EVENTS.MIN,
        CORE_EVENTS.MAX,
        CORE_EVENTS.START_SPIN,
        CORE_EVENTS.START_UP,
        CORE_EVENTS.START_DOWN,
        CORE_EVENTS.STOP_SPIN,
        CORE_EVENTS.STOP_UP,
        CORE_EVENTS.STOP_DOWN,
      ];
      for (const ev of events) unsubs.push(api.on(ev, () => addLog(`core:${ev}`)));
    }

    function buildRenderer(opts) {
      // Build Tailwind UI around the input
      const renderer = window.RendererFactory.createRenderer($, opts, $input);
      const container = renderer.buildInputGroup();
      const elements = renderer.initElements(container);
      try { renderer.hideEmptyPrefixPostfix(); } catch {}
      return elements;
    }

    function destroy() {
      if (!inst) return;
      for (const u of unsubs.splice(0)) try { u(); } catch {}
      try { inst.destroy(); } catch {}
      inst = null;
      // unwrap input if wrapped by renderer
      const $wrap = $input.closest('[data-touchspin-injected="wrapper"]');
      if ($wrap.length) { $wrap.before($input); $wrap.remove(); }
      status.textContent = 'Destroyed';
    }

    function init(opts) {
      destroy();
      const elements = buildRenderer(opts);
      inst = createPublicApi(input, opts);
      subscribeCore(inst);
      // Log native change like other demos
      $input.on('change', function(){ addLog('change[' + this.value + ']'); });
      // Wire buttons once to call core
      if (elements && !wiredButtons) {
        wiredButtons = true;
        if (elements.up && elements.up[0]) elements.up[0].addEventListener('click', () => inst.upOnce());
        if (elements.down && elements.down[0]) elements.down[0].addEventListener('click', () => inst.downOnce());
      }
      status.textContent = `Initialized (min ${opts.min}, max ${opts.max}, step ${opts.step})`;
    }

    document.getElementById('btn-init').addEventListener('click', () => init({ min: 0, max: 100, step: 1, buttondown_txt: '\u2212', buttonup_txt: '+', prefix: '', postfix: '' }));
    document.getElementById('btn-destroy').addEventListener('click', destroy);
    document.getElementById('btn-reinit').addEventListener('click', () => init({ min: 5, max: 50, step: 5, buttondown_txt: '\u2212', buttonup_txt: '+', prefix: '', postfix: '' }));

    document.getElementById('btn-uponce').addEventListener('click', () => inst && inst.upOnce());
    document.getElementById('btn-downonce').addEventListener('click', () => inst && inst.downOnce());
    document.getElementById('btn-startup').addEventListener('click', () => inst && inst.startUpSpin());
    document.getElementById('btn-startdown').addEventListener('click', () => inst && inst.startDownSpin());
    document.getElementById('btn-stop').addEventListener('click', () => inst && inst.stopSpin());
    document.getElementById('btn-get').addEventListener('click', () => inst && addLog('getValue()=' + inst.getValue()));
    document.getElementById('btn-set').addEventListener('click', () => inst && inst.setValue(64));
    document.getElementById('btn-update').addEventListener('click', () => inst && inst.updateSettings({ step: 10 }));

    // Disable/Readonly toggles on the original input
    document.getElementById('btn-toggle-disabled').addEventListener('click', () => {
      const isDisabled = $input.is(':disabled');
      $input.prop('disabled', !isDisabled);
    });
    document.getElementById('btn-toggle-readonly').addEventListener('click', () => {
      const isReadonly = $input.is('[readonly]');
      $input.prop('readonly', !isReadonly);
    });
  </script>
</body>
</html>
