<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Bootstrap TouchSpin - Modern Core + jQuery Wrapper</title>

  <script src="assets/jquery/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="assets/fontawesome/fontawesome-5.15.4.min.css">

  <!-- BOOTSTRAP 4 -->
  <link href="assets/bootstrap/bootstrap-4.6.2.min.css" rel="stylesheet">
  <script src="assets/bootstrap/bootstrap-4.6.2.bundle.min.js"></script>

  <script src="assets/numeral/numeral-2.0.6.min.js"></script>

  <!-- Load source CSS -->
  <link href="../../src/jquery.bootstrap-touchspin.css" rel="stylesheet" type="text/css" media="all">

  <!-- Load renderer files -->
  <script src="../../src/renderers/AbstractRenderer.js"></script>
  <script src="../../src/renderers/Bootstrap4Renderer.js"></script>

  <!-- Create Bootstrap 4 RendererFactory -->
  <script>
    window.RendererFactory = class {
      static createRenderer($, settings, originalinput) {
        return new Bootstrap4Renderer($, settings, originalinput);
      }

      static getVersion() {
        return 4;
      }
    };
  </script>

  <!-- Load modern packages as ES modules -->
  <script type="module">
    import { installJqueryTouchSpin } from '../../packages/jquery-plugin/src/index.js';
    
    // Install the modern jQuery wrapper
    installJqueryTouchSpin(window.jQuery);
    
    // Make it available for tests
    window.modernTouchSpinInstalled = true;
  </script>

</head>

<body>
<div class="container">

  <div class="row">
    <div class="col-md-4">
      <div class="wrapper">
        <label for="testinput_default">#testinput_default:</label>
        <input id="testinput_default" type="text" value="50" name="testinput_default" data-testid="touchspin-default">
        <small class="text-muted">TouchSpin enabled with default settings: min=0, max=100, step=1.</small>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4">
      <div class="wrapper">
        <label for="testinput_vertical">#testinput_vertical:</label>
        <input id="testinput_vertical" type="text" value="35" name="testinput_vertical" data-testid="touchspin-vertical">
        <small class="text-muted">Vertical layout: buttons displayed vertically.</small>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4">
      <div class="wrapper">
        <label for="testinput_disabled">#testinput_disabled:</label>
        <input id="testinput_disabled" type="text" value="0" disabled name="testinput_disabled" data-testid="touchspin-disabled">
        <small class="text-muted">Input disabled.</small>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4">
      <div class="wrapper">
        <label for="testinput_readonly">#testinput_readonly:</label>
        <input id="testinput_readonly" type="text" value="0" readonly name="testinput_readonly" data-testid="touchspin-readonly">
        <small class="text-muted">Input readonly.</small>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4">
      <div class="wrapper">
        <label for="testinput_callbacks">#testinput_callbacks:</label>
        <input id="testinput_callbacks" type="text" value="5000" name="testinput_callbacks" data-testid="touchspin-callbacks">
        <small class="text-muted">With callback formatting.</small>
      </div>
    </div>
  </div>

</div>

<div id="events_log" style="width: 100%; height: 200px; margin-top: 20px; padding: 10px; border: 1px solid #ccc; overflow-y: auto; font-family: monospace; font-size: 12px; background-color: #f8f9fa;">
  <!-- Event log will be populated here -->
</div>

<script>
$(document).ready(function() {
  // Wait for modern TouchSpin to be available
  if (!window.modernTouchSpinInstalled) {
    console.error('Modern TouchSpin not loaded');
    return;
  }

  // Event logging
  function logEvent(type, target, data) {
    const log = document.getElementById('events_log');
    const timestamp = new Date().toLocaleTimeString();
    const entry = `[${timestamp}] ${type} on ${target}: ${JSON.stringify(data || {})}`;
    log.textContent += entry + '\n';
    log.scrollTop = log.scrollHeight;
  }

  // Initialize default TouchSpin
  $("#testinput_default").TouchSpin({
    min: 0,
    max: 100,
    step: 1
  });

  // Initialize vertical TouchSpin
  $("#testinput_vertical").TouchSpin({
    verticalbuttons: true,
    min: 0,
    max: 100,
    step: 5
  });

  // Initialize disabled TouchSpin
  $("#testinput_disabled").TouchSpin({
    min: 0,
    max: 100,
    step: 1
  });

  // Initialize readonly TouchSpin
  $("#testinput_readonly").TouchSpin({
    min: 0,
    max: 100,
    step: 1
  });

  // Initialize callbacks TouchSpin with currency formatting
  $("#testinput_callbacks").TouchSpin({
    min: 0,
    max: 1000,
    step: 25,
    decimals: 2,
    callback_after_calculation: function(value) {
      return '$' + numeral(value).format('0,0.00');
    },
    callback_before_calculation: function(value) {
      return value.replace(/[$,]/g, '');
    }
  });

  // Log all TouchSpin events for testing
  $('input[data-testid]').on('touchspin.on.min touchspin.on.max touchspin.on.startspin touchspin.on.stopspin', function(e) {
    logEvent(e.type, $(this).data('testid'), {});
  });

  $('input[data-testid]').on('change', function(e) {
    logEvent('change', $(this).data('testid'), { value: $(this).val() });
  });
});
</script>

</body>
</html>