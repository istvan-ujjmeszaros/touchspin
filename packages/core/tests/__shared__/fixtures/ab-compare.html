<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery TouchSpin A/B Compare (Original v4.7.3 vs New Wrapper)</title>
  <link rel="stylesheet" href="/__tests__/html/assets/bootstrap/bootstrap-4.6.2.min.css">
  <script src="/__tests__/html/assets/jquery/jquery-3.7.1.min.js"></script>
  <script type="importmap">
  {
    "imports": {
      "@touchspin/core": "/packages/core/devdist/index.js",
      "@touchspin/core/renderer": "/packages/core/devdist/renderer.js",
      "@touchspin/core/events": "/packages/core/devdist/events.js"
    }
  }
  </script>
  <style>
    body { padding: 20px; }
    .test-section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      background-color: #f8f9fa;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .event-log {
      background: #fff;
      border: 1px solid #dee2e6;
      padding: 10px;
      height: 200px;
      overflow: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }
    .controls {
      margin: 15px 0;
    }
    .controls button {
      margin-right: 5px;
      margin-bottom: 5px;
    }
    .status {
      margin: 10px 0;
      padding: 8px;
      background: #e9ecef;
      border-radius: 0.25rem;
      font-size: 14px;
    }
    .value-display {
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #0d6efd;
    }
    h2 { color: #495057; }
    .original-side { border-left: 4px solid #dc3545; }
    .wrapper-side { border-left: 4px solid #198754; }
  </style>

  <!-- Load original jQuery TouchSpin v4.7.3 -->
  <script src="/__tests__/html/assets/jquery.bootstrap-touchspin-v4.7.3-original.js"></script>
  <!-- Preserve original plugin under a different name before installing wrapper -->
  <script>
    (function($){
      if ($ && $.fn && $.fn.TouchSpin) {
        $.fn.OriginalTouchSpin = $.fn.TouchSpin;
        delete $.fn.TouchSpin; // Clear so new version can install
      }
    })(window.jQuery);
  </script>
</head>
<body class="container">
  <div class="row">
    <div class="col-12">
      <h1 class="h3 mb-4">jQuery TouchSpin A/B Comparison</h1>
      <div class="alert alert-info">
        <strong>Testing backwards compatibility:</strong> Original plugin (v4.7.3) vs New jQuery wrapper with Bootstrap4 renderer
      </div>
    </div>
  </div>

  <div class="grid">
    <!-- Original Plugin Side -->
    <div class="test-section original-side">
      <h2 class="h5" id="orig-title"><span id="orig-dot">ðŸ”´</span> Original TouchSpin v4.7.3</h2>

      <div class="mb-3">
        <label class="form-label">Test Input:</label>
        <input id="orig-input" type="number" value="50" class="form-control" data-testid="ab-orig">
      </div>

      <div class="status">
        Status: <span id="orig-status" class="value-display">Not initialized</span>
      </div>

      <div class="controls">
        <h6 class="mb-2"><strong>TouchSpin API Methods</strong></h6>
        <button onclick="$('#orig-input').OriginalTouchSpin({ min:0, max:100, step:5 })" class="btn btn-primary btn-sm" data-testid="orig-init">Init</button>
        <button onclick="$('#orig-input').trigger('touchspin.destroy')" class="btn btn-outline-danger btn-sm" data-testid="orig-destroy">Destroy</button>
        <button onclick="$('#orig-input').OriginalTouchSpin({ min:0, max:100, step:5, initval:75 })" class="btn btn-primary btn-sm" data-testid="orig-init-75">Init with initval: 75</button>
        <br>
        <button onclick="$('#orig-input').trigger('touchspin.uponce')" class="btn btn-outline-secondary btn-sm" data-testid="orig-up">Up Once</button>
        <button onclick="$('#orig-input').trigger('touchspin.downonce')" class="btn btn-outline-secondary btn-sm" data-testid="orig-down">Down Once</button>

        <h6 class="mb-2 mt-3"><strong>jQuery/Native Methods</strong></h6>
        <button onclick="$('#orig-input').val(75)" class="btn btn-info btn-sm" data-testid="orig-set">Set Value (75)</button>
        <button onclick="var v=$('#orig-input').val(); window.origLog.innerHTML+='[' + new Date().toISOString().split('T')[1].replace('Z','') + '] getValue: ' + JSON.stringify(v) + '\n'; window.origLog.scrollTop = window.origLog.scrollHeight;" class="btn btn-success btn-sm" data-testid="orig-get">Get Value</button>
        <button onclick="$('#orig-input').attr('type', 'text')" class="btn btn-secondary btn-sm" data-testid="orig-set-text">Set to type="text"</button>

        <h6 class="mb-2 mt-3"><strong>Callbacks</strong></h6>
        <button onclick="$('#orig-input').trigger('touchspin.updatesettings', [{ callback_before_calculation: function(v) { return v.replace(/[$\s]/g, '').replace('USD', ''); }, callback_after_calculation: function(v) { return '$' + v + ' USD'; } }])" class="btn btn-warning btn-sm" data-testid="orig-set-callback">Set $ USD Format</button>
        <button onclick="$('#orig-input').trigger('touchspin.updatesettings', [{ callback_before_calculation: function(v) { return String(parseFloat(v) * 2); } }])" class="btn btn-info btn-sm" data-testid="orig-double-callback">Double Value</button>
      </div>

      <h6 class="mt-3">Event Log:</h6>
      <div class="event-log" id="orig-log"></div>
    </div>

    <!-- New Wrapper Side -->
    <div class="test-section wrapper-side">
      <h2 class="h5" id="wrap-title"><span id="wrap-dot">ðŸ”´</span> New jQuery Wrapper</h2>

      <div class="mb-3">
        <label class="form-label">Test Input:</label>
        <input id="wrap-input" type="number" value="50" class="form-control" data-testid="ab-wrap">
      </div>

      <div class="status">
        Status: <span id="wrap-status" class="value-display">Not initialized</span>
      </div>

      <div class="controls">
        <h6 class="mb-2"><strong>TouchSpin API Methods</strong></h6>
        <button onclick="$('#wrap-input').TouchSpin({ min:0, max:100, step:5 })" class="btn btn-primary btn-sm" data-testid="wrap-init">Init</button>
        <button onclick="$('#wrap-input').trigger('touchspin.destroy')" class="btn btn-outline-danger btn-sm" data-testid="wrap-destroy">Destroy</button>
        <button onclick="$('#wrap-input').TouchSpin({ min:0, max:100, step:5, initval:75 })" class="btn btn-primary btn-sm" data-testid="wrap-init-75">Init with initval: 75</button>
        <br>
        <button onclick="$('#wrap-input').TouchSpin('uponce')" class="btn btn-outline-secondary btn-sm" data-testid="wrap-up">Up Once</button>
        <button onclick="$('#wrap-input').TouchSpin('downonce')" class="btn btn-outline-secondary btn-sm" data-testid="wrap-down">Down Once</button>
        <button onclick="$('#wrap-input').TouchSpin('set', 75)" class="btn btn-info btn-sm" data-testid="wrap-set-api">Set Value (75)</button>
        <button onclick="var v=$('#wrap-input').TouchSpin('get'); window.wrapLog.innerHTML+='[' + new Date().toISOString().split('T')[1].replace('Z','') + '] getValue: ' + JSON.stringify(v) + '\n'; window.wrapLog.scrollTop = window.wrapLog.scrollHeight;" class="btn btn-success btn-sm" data-testid="wrap-get-api">Get Value</button>

        <h6 class="mb-2 mt-3"><strong>jQuery/Native Methods</strong></h6>
        <button onclick="$('#wrap-input').val(75)" class="btn btn-info btn-sm" data-testid="wrap-set">Set Value (75)</button>
        <button onclick="var v=$('#wrap-input').val(); window.wrapLog.innerHTML+='[' + new Date().toISOString().split('T')[1].replace('Z','') + '] getValue: ' + JSON.stringify(v) + '\n'; window.wrapLog.scrollTop = window.wrapLog.scrollHeight;" class="btn btn-success btn-sm" data-testid="wrap-get">Get Value</button>

        <h6 class="mb-2 mt-3"><strong>Callbacks</strong></h6>
        <button onclick="$('#wrap-input').TouchSpin('updatesettings', { callback_before_calculation: function(v) { return v.replace(/[$\s]/g, '').replace('USD', ''); }, callback_after_calculation: function(v) { return '$' + v + ' USD'; } })" class="btn btn-warning btn-sm" data-testid="wrap-set-callback">Set $ USD Format</button>
        <button onclick="$('#wrap-input').TouchSpin('updatesettings', { callback_before_calculation: function(v) { return String(parseFloat(v) * 2); } })" class="btn btn-info btn-sm" data-testid="wrap-double-callback">Double Value</button>
      </div>

      <h6 class="mt-3">Event Log:</h6>
      <div class="event-log" id="wrap-log"></div>
    </div>
  </div>

  <!-- Load the new jQuery TouchSpin wrapper -->
  <script src="../../dist/jquery.touchspin-bootstrap4.umd.js"></script>

  <script>
    (function(){
      const $ = window.jQuery;
      const $orig = $('#orig-input');
      const $wrap = $('#wrap-input');

      // Make these globally accessible for inline onclick handlers
      window.origLog = document.getElementById('orig-log');
      window.wrapLog = document.getElementById('wrap-log');
      const origStatus = document.getElementById('orig-status');
      const wrapStatus = document.getElementById('wrap-status');
      const origDot = document.getElementById('orig-dot');
      const wrapDot = document.getElementById('wrap-dot');


      function bindLog($input, logEl) {
        function add(msg){ const ts = new Date().toISOString().split('T')[1].replace('Z',''); logEl.textContent += `[${ts}] ${msg}\n`; logEl.scrollTop = logEl.scrollHeight; }
        const evs = 'touchspin.on.min touchspin.on.max touchspin.on.startspin touchspin.on.stopspin touchspin.on.startupspin touchspin.on.startdownspin touchspin.on.stopupspin touchspin.on.stopdownspin';
        $input.on(evs, function(e){ const ns=(e.namespace||''); const sub = ns.replace(/^on\./,'')||e.type; add(sub); });
        $input.on('change', function(){ add('change[' + this.value + ']'); });
      }

      // Bind event logging for both inputs
      bindLog($orig, window.origLog);
      bindLog($wrap, window.wrapLog);

      // Update status functions
      function updateOriginalStatus() {
        const hasWrapper = $orig.parent().hasClass('bootstrap-touchspin');
        origStatus.textContent = hasWrapper ? 'Initialized' : 'Not initialized';
        origStatus.className = hasWrapper ? 'value-display text-success' : 'value-display text-muted';
        origDot.textContent = hasWrapper ? 'ðŸŸ¢' : 'ðŸ”´';
      }

      function updateWrapperStatus() {
        const hasWrapper = $wrap.parent().hasClass('bootstrap-touchspin') || $wrap.attr('data-touchspin-injected') !== undefined;
        wrapStatus.textContent = hasWrapper ? 'Initialized' : 'Not initialized';
        wrapStatus.className = hasWrapper ? 'value-display text-success' : 'value-display text-muted';
        wrapDot.textContent = hasWrapper ? 'ðŸŸ¢' : 'ðŸ”´';
      }

      // Check status periodically
      setInterval(() => {
        updateOriginalStatus();
        updateWrapperStatus();
      }, 500);

      // No global button handler functions needed - using inline JavaScript

      // Initial status update
      updateOriginalStatus();
      updateWrapperStatus();

      // All button functionality moved to inline onclick attributes

    })();
  </script>
</body>
</html>