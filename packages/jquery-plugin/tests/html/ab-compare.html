<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery TouchSpin A/B Compare (Original v4.7.3 vs New Wrapper)</title>
  <link rel="stylesheet" href="/__tests__/html/assets/bootstrap/bootstrap-3.4.1.min.css">
  <script src="/__tests__/html/assets/jquery/jquery-3.7.1.min.js"></script>
  <style>
    body { padding: 20px; }
    .test-section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      background-color: #f8f9fa;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .event-log {
      background: #fff;
      border: 1px solid #dee2e6;
      padding: 10px;
      height: 200px;
      overflow: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }
    .controls {
      margin: 15px 0;
    }
    .controls button {
      margin-right: 5px;
      margin-bottom: 5px;
    }
    .status {
      margin: 10px 0;
      padding: 8px;
      background: #e9ecef;
      border-radius: 0.25rem;
      font-size: 14px;
    }
    .value-display {
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #0d6efd;
    }
    h2 { color: #495057; }
    .original-side { border-left: 4px solid #dc3545; }
    .wrapper-side { border-left: 4px solid #198754; }
  </style>

  <!-- Load original jQuery TouchSpin v4.7.3 -->
  <script src="/__tests__/html/assets/jquery.bootstrap-touchspin-v4.7.3-original.js"></script>
  <!-- Preserve original plugin under a different name before installing wrapper -->
  <script>
    (function($){
      if ($ && $.fn && $.fn.TouchSpin) {
        $.fn.OriginalTouchSpin = $.fn.TouchSpin;
        delete $.fn.TouchSpin; // Clear so new version can install
      }
    })(window.jQuery);
  </script>
</head>
<body class="container">
  <div class="row">
    <div class="col-xs-12">
      <h1>jQuery TouchSpin A/B Comparison</h1>
      <div class="alert alert-info">
        <strong>Testing backwards compatibility:</strong> Original plugin (v4.7.3) vs New jQuery wrapper with Bootstrap3 renderer
      </div>
    </div>
  </div>

  <div class="grid">
    <!-- Original Plugin Side -->
    <div class="test-section original-side">
      <h2>ðŸ”´ Original TouchSpin v4.7.3</h2>

      <div class="form-group">
        <label class="control-label">Test Input:</label>
        <input id="orig-input" type="number" value="50" class="form-control" data-testid="ab-orig">
      </div>

      <div class="status">
        Status: <span id="orig-status" class="value-display">Not initialized</span>
      </div>

      <div class="controls">
        <button onclick="try { $('#orig-input').OriginalTouchSpin({ min: 0, max: 100, step: 5, decimals: 0 }); window.addLog(origLog, '[INIT] TouchSpin initialized with options: min=0, max=100, step=5'); } catch (e) { window.addLog(origLog, '[ERROR] Failed to initialize: ' + e.message); }" class="btn btn-primary btn-sm" data-testid="orig-init">Initialize</button>
        <button onclick="try { $('#orig-input').trigger('touchspin.destroy'); window.addLog(origLog, '[DESTROY] TouchSpin destroyed'); } catch (e) { window.addLog(origLog, '[ERROR] Failed to destroy: ' + e.message); }" class="btn btn-danger btn-sm" data-testid="orig-destroy">Destroy</button>
        <br>
        <button onclick="try { $('#orig-input').trigger('touchspin.uponce'); window.addLog(origLog, '[CMD] uponce triggered'); } catch (e) { window.addLog(origLog, '[ERROR] Failed to trigger uponce: ' + e.message); }" class="btn btn-default btn-sm" data-testid="orig-up">Up Once</button>
        <button onclick="try { $('#orig-input').trigger('touchspin.downonce'); window.addLog(origLog, '[CMD] downonce triggered'); } catch (e) { window.addLog(origLog, '[ERROR] Failed to trigger downonce: ' + e.message); }" class="btn btn-default btn-sm" data-testid="orig-down">Down Once</button>
        <button onclick="try { $('#orig-input').val(75); window.addLog(origLog, '[CMD] Set value to 75 via .val()'); } catch (e) { window.addLog(origLog, '[ERROR] Failed to set value: ' + e.message); }" class="btn btn-info btn-sm" data-testid="orig-set">Set Value (75)</button>
        <button onclick="try { var value = $('#orig-input').val(); window.addLog(origLog, '[CMD] Get value: ' + value); } catch (e) { window.addLog(origLog, '[ERROR] Failed to get value: ' + e.message); }" class="btn btn-success btn-sm" data-testid="orig-get">Get Value</button>
      </div>

      <h6 style="margin-top: 15px;">Event Log:</h6>
      <div class="event-log" id="orig-log"></div>
      <button onclick="document.getElementById('orig-log').textContent = ''; window.addLog(document.getElementById('orig-log'), 'Log cleared');" class="btn btn-warning btn-sm" style="margin-top: 10px;">Clear Log</button>
    </div>

    <!-- New Wrapper Side -->
    <div class="test-section wrapper-side">
      <h2>ðŸŸ¢ New jQuery Wrapper</h2>

      <div class="form-group">
        <label class="control-label">Test Input:</label>
        <input id="wrap-input" type="number" value="50" class="form-control" data-testid="ab-wrap">
      </div>

      <div class="status">
        Status: <span id="wrap-status" class="value-display">Not initialized</span>
      </div>

      <div class="controls">
        <button onclick="try { $('#wrap-input').TouchSpin({ min: 0, max: 100, step: 5, decimals: 0 }); window.addLog(wrapLog, '[INIT] TouchSpin initialized with options: min=0, max=100, step=5'); } catch (e) { window.addLog(wrapLog, '[ERROR] Failed to initialize: ' + e.message); }" class="btn btn-primary btn-sm" data-testid="wrap-init">Initialize</button>
        <button onclick="try { $('#wrap-input').TouchSpin('destroy'); window.addLog(wrapLog, '[DESTROY] TouchSpin destroyed'); } catch (e) { window.addLog(wrapLog, '[ERROR] Failed to destroy: ' + e.message); }" class="btn btn-danger btn-sm" data-testid="wrap-destroy">Destroy</button>
        <br>
        <button onclick="try { $('#wrap-input').TouchSpin('uponce'); window.addLog(wrapLog, '[CMD] uponce called'); } catch (e) { window.addLog(wrapLog, '[ERROR] Failed to call uponce: ' + e.message); }" class="btn btn-default btn-sm" data-testid="wrap-up">Up Once</button>
        <button onclick="try { $('#wrap-input').TouchSpin('downonce'); window.addLog(wrapLog, '[CMD] downonce called'); } catch (e) { window.addLog(wrapLog, '[ERROR] Failed to call downonce: ' + e.message); }" class="btn btn-default btn-sm" data-testid="wrap-down">Down Once</button>
        <button onclick="try { $('#wrap-input').val(75); window.addLog(wrapLog, '[CMD] Set value to 75 via .val()'); } catch (e) { window.addLog(wrapLog, '[ERROR] Failed to set value: ' + e.message); }" class="btn btn-info btn-sm" data-testid="wrap-set">Set Value (75)</button>
        <button onclick="try { var value = $('#wrap-input').val(); window.addLog(wrapLog, '[CMD] Get value: ' + value); } catch (e) { window.addLog(wrapLog, '[ERROR] Failed to get value: ' + e.message); }" class="btn btn-success btn-sm" data-testid="wrap-get">Get Value</button>
      </div>

      <h6 style="margin-top: 15px;">Event Log:</h6>
      <div class="event-log" id="wrap-log"></div>
      <button onclick="document.getElementById('wrap-log').textContent = ''; window.addLog(document.getElementById('wrap-log'), 'Log cleared');" class="btn btn-warning btn-sm" style="margin-top: 10px;">Clear Log</button>
    </div>
  </div>

  <!-- Load the new jQuery TouchSpin wrapper -->
  <script src="../../dist/jquery.touchspin-bootstrap3.umd.js"></script>

  <script>
    (function(){
      const $ = window.jQuery;
      const $orig = $('#orig-input');
      const $wrap = $('#wrap-input');

      // Make these globally accessible for inline onclick handlers
      window.origLog = document.getElementById('orig-log');
      window.wrapLog = document.getElementById('wrap-log');
      const origStatus = document.getElementById('orig-status');
      const wrapStatus = document.getElementById('wrap-status');

      // Make logging function globally accessible
      window.addLog = function addLog(logEl, msg) {
        const ts = new Date().toISOString().split('T')[1].replace('Z','').slice(0, -4);
        logEl.textContent += `[${ts}] ${msg}\n`;
        logEl.scrollTop = logEl.scrollHeight;
      }

      function bindEventLog($input, logEl, label) {
        const touchspinEvents = [
          'touchspin.on.min', 'touchspin.on.max', 'touchspin.on.startspin', 'touchspin.on.stopspin',
          'touchspin.on.startupspin', 'touchspin.on.startdownspin', 'touchspin.on.stopupspin', 'touchspin.on.stopdownspin'
        ];

        touchspinEvents.forEach(eventName => {
          $input.on(eventName, function(e) {
            window.addLog(logEl, `${label} ${eventName} (value: ${this.value})`);
          });
        });

        $input.on('change', function(e) {
          window.addLog(logEl, `${label} change (value: ${this.value})`);
        });

        $input.on('input', function(e) {
          window.addLog(logEl, `${label} input (value: ${this.value})`);
        });
      }

      // Bind event logging for both inputs
      bindEventLog($orig, window.origLog, '[ORIG]');
      bindEventLog($wrap, window.wrapLog, '[WRAP]');

      // Update status functions
      function updateOriginalStatus() {
        const hasWrapper = $orig.parent().hasClass('bootstrap-touchspin');
        origStatus.textContent = hasWrapper ? 'Initialized' : 'Not initialized';
        origStatus.className = hasWrapper ? 'value-display text-success' : 'value-display text-muted';
      }

      function updateWrapperStatus() {
        const hasWrapper = $wrap.parent().hasClass('bootstrap-touchspin') || $wrap.attr('data-touchspin-injected') !== undefined;
        wrapStatus.textContent = hasWrapper ? 'Initialized' : 'Not initialized';
        wrapStatus.className = hasWrapper ? 'value-display text-success' : 'value-display text-muted';
      }

      // Check status periodically
      setInterval(() => {
        updateOriginalStatus();
        updateWrapperStatus();
      }, 500);

      // No global button handler functions needed - using inline JavaScript

      // Initial status update
      updateOriginalStatus();
      updateWrapperStatus();

      // Add a welcome message
      window.addLog(window.origLog, 'Original TouchSpin v4.7.3 ready for testing');
      window.addLog(window.wrapLog, 'New jQuery wrapper ready for testing');

    })();
  </script>
</body>
</html>